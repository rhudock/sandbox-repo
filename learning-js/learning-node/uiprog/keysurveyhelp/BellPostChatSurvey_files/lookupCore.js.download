function LQ_Event(b,a,e,g,f,d,c){this.elementId=b;this.view=a;this.value=e;this.qid=g;this.row=f;this.selected=d;this.ignoreListeners=c;this.type=LQ_Utils.isFinalSelect(b)?1:2;this.toString=function(){return"[elementId="+b+", view= "+a+", value = "+e+", qid = "+g+", row="+f+", selected="+d+", type="+this.type+"]";};}if(window.LQ_Core){throw"There is another instance of LQ_Core! Check JS includes.";}var LQ_Core=(function(bQ,bX,J,o,b4,B,T,S,be){if(typeof be==="undefined"){throw"There is no ksConfig.";}var af=function(){return be.isOffline;};var ah=function(){return window.survData.surveyId;};var ap=function(){return window.survData.lookupEnv;};var p=function(b7){return window.survData.questionsMap[b7].lookup;};var g=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;var bl;var ad=null;var bR=null;var bG=null;var bI=false;var a0=[null,null];var y={};var bp={};var aU={};var ar={};var bB={};var az={};var b6={};var a={};var d={};var aO={};var aY={};var aa={};var bb={};var aZ={};var E={};var bV={};var ba={};var bK={};var aD=function(){if(ad==null){ad=bQ("#main_frame");}if(bQ("div[data-role='page']").length>0&&bQ("body").hasClass("mobile")){ad=bQ("div[data-role='page']:visible, .placeWrap:visible");}return ad;};var bn=function(){if(bR==null){bR=af()?bQ("body"):aD();}return bR;};var ae=function(b8){if(bG!=null&&d[b8]==null){return;}J.log("[ SUN ] Progress bar initialization: visibleSelect="+a0[1]+", loadingSelect="+bG);bG=b8;if(af()){if(!aU[b8]||aU[b8]>5000){bn().loadingOn(0);}}else{var b7=700;setTimeout(function(){J.log("[ SUN ] After "+b7+" ms. progress bar is checking for active loading... loadingSelect="+bG);if(bG!=null){bn().loadingOn(0);J.log("[ SUN ] Progress bar is ACTIVATED");}},b7);}};var aI=function(){bG=null;bn().loadingOff();J.log("[ SUN ] Progress bar is CLOSED");};var aQ=function(b7,b9){var ca=KS_Utils.currentTime();var b8=bQ("#"+b7+"_table");J.log("Seting HTML content to "+b7+" ... ");b8.empty();b8.append(b9);J.log("HTML model rendered in "+(KS_Utils.currentTime()-ca)+" ms.");return false;};var x=function(b7,b8){var b9=b8.indexOf(ap().valueDelimiter);if(b9<0){aU[b7]=0;b8=null;}else{aU[b7]=b8.substring(0,b9);b8=b8.substring(b9+ap().valueDelimiter.length);}J.log("Global count is recieved for "+b7+" = "+aU[b7]);return b8;};var G=function(b9,b7,b8){return bO(b9,b7).createOptionsHtml(b9,b7,b8);};var a8=function(b7){var b8=bQ("#lookupPage_"+b7);b8.attr("size",bh(b7));b8.val(b(b7));};var am=function(b8){var b9=b(b8);var b7=y[b8];var ca=Math.ceil(aU[b8]/b7);if(b9==1){J.log("NAVIGATION: Disable PREV and FIRST buttons for "+b8);bQ("#btnFirst_"+b8).attr("disabled",true);bQ("#btnPrev_"+b8).attr("disabled",true);}else{bQ("#btnFirst_"+b8).attr("disabled",false);bQ("#btnPrev_"+b8).attr("disabled",false);}if(b9==ca){J.log("NAVIGATION: Disable NEXT and LAST buttons for "+b8);bQ("#btnNext_"+b8).attr("disabled",true);bQ("#btnLast_"+b8).attr("disabled",true);}else{bQ("#btnNext_"+b8).attr("disabled",false);bQ("#btnLast_"+b8).attr("disabled",false);}if(ca==1){bQ("#lookupPage_"+b8).attr("disabled",true);}else{bQ("#lookupPage_"+b8).attr("disabled",false);}};var an=function(b9){var b8={};var ca=q(b9);for(var b7=0;b7<ca.length;b7++){b2(b8,ca[b7].computerIds,ca[b7].humanValue);}return b8;};var b2=function(ca,b8,b9){var cb=new window.votingResultsModule.ResultCriteria();cb.includePickOneComment=false;var b7=window.vpGetTextResults(b9,cb);if(b7==null||b7.length==0){J.log("There are no results for "+b8+" ["+b9+"]");return false;}if(ca["respondentResults["+b8+"]"]==null){J.log("Found result for "+b8+" ["+b9+"] = "+b7);ca["respondentResults["+b8+"]"]=b7;}};var a1=function(b7,b9){var b8={};bQ.each(bQ(".lookupFieldFilter_"+b9),function(cc,ca){var cb=bQ(ca).attr("id");var cd=E[cb];J.log("Process field filter: elementId="+cb+", value="+cd);if(cb==b7){return;}if(cd==null||aJ(b9,cb)==cd){return;}J.log("Found filter: "+cd);if(bQ.trim(cd).length==0){cd="EMPTY_FILTER";}b8[bQ(ca).attr("name")]=cd;});return b8;};var aH=function(b8,b7){J.log("[ FILTER CHANGED ] predefinedFilterChanged for "+b8);if(a0[0]&&a0[0]==b8){bL(b8,null);}u(b8,null);bH(b8);a7(b8,false,b7);};var bc=function(b7,b8){S.getModule().addEventHandlerToManyTokens(b8,function(b9){aH(b7);});J.log("Add filter listener for lookupId="+b7+", tokens="+b8);};var al=function(b7,b8){bm(b7,function(){J.log("Fire lookup listener. QID="+b8+" depends on QID="+b7);aH(b8,b7);});J.log("Add filter listener for lookup qid="+b7);};var W=function(b7){setTimeout(function(){bQ("#lookupPage_"+b7).select();},10);};var bi=function(b8){var b7=y[b8];var b9=aU[b8]%b7;J.log("lastPageSize="+b9);if(b9==0){b9=b7;}return aU[b8]-b9;};var b=function(b7){return bp[b7]/y[b7]+1;};var bh=function(b7){return(""+(aU[b7]/y[b7])).length;};var bZ=function(b8,b7){bp[b7]=0;y[b7]=a4(b8,b7);aU[b7]=null;};var bw=function(b8,b7){r(b7,0);if(bO(b8,b7).isCursorSupported(b7)){bJ(LQ_Core,b7);}};var bo=function(ce,cb,cf,b9){J.log("Change page: "+cb+" / "+cf);var cj=bQ("#lookupPage_"+cb).val();var cd=b(cb);var cg=y[cb];var ch=bp[cb];var ci=bO(ce,cb);switch(cf){case 1:if(bp[cb]==0){J.log("Page is not changed. No actions are required.");bQ("#lookupPage_"+cb).val(cd);if(ci.isCursorSupported(cb)){bj(cb);}return;}bp[cb]=0;bQ("#lookupPage_"+cb).focus();break;case 2:if(ch==0){if(ci.isCursorSupported(cb)){bj(cb);}return;}var b8=ch-cg;bp[cb]=b8>=0?b8:0;bQ("#lookupPage_"+cb).focus();break;case 3:var cc=bi(cb);var ca=ch+cg;J.log("lastPageIndex="+cc+", nextPageStart="+ca+", indexStart[elementId]="+bp[cb]);if(ca>cc){ca=cc;}if(bp[cb]>=ca){if(ci.isCursorSupported(cb)){bj(cb);}return;}bp[cb]=ca;bQ("#lookupPage_"+cb).focus();break;case 4:var b7=bi(cb);if(bp[cb]>=b7){J.log("Page is not changed. No actions are required.");bQ("#lookupPage_"+cb).val(cd);if(ci.isCursorSupported(cb)){bj(cb);}return;}bp[cb]=b7;bQ("#lookupPage_"+cb).focus();break;case 5:if(b9.keyCode==13){J.log("Manual page: "+cj+", Current page: "+cd);if(cj==cd){J.log("Page is not changed. No actions are required.");if(ci.isCursorSupported(cb)){bj(cb);}return;}ch=cj*cg-cg;if(!ch){ch=0;}if(ch<0){return bo(ce,cb,1,null);}else{if(ch>aU[cb]-cg){return bo(ce,cb,4,null);}else{J.log("Calculated index: "+ch);bp[cb]=ch;}}}else{return;}break;}if(ci.isCursorSupported(cb)){R(cb);}bw(ce,cb);if(ci.isCursorSupported(cb)){bj(cb);}az[cb](true);};var aw=function(b9,b7,b8){bO(b9,J.getFinalSelectId(b9)).populateResult(b9,b7,b8);};var M=function(b9,b8,b7){i(bQ("#LookupControl_"+b9),b9,b8,b7);};var i=function(b7,ca,b9,b8){b7.find("#lookupFinalSelect_"+ca+"_input").val(b8);if(!k(ca)){b7.find("#lookupFinalSelect_"+ca+"_reset").show();}bb[ca]=true;LQ_Core.setDropdownValue("lookupFinalSelect_"+ca,b9);J.log("Final result: value = "+b9+", view = "+b8);};var bF=function(cb,b9,b8,ca,b7){if(b7&&b7.length>0){bQ("#lookupField_"+ca+"_input").val(b7);J.log("Field result ["+ca+"] = "+b7);}};var K=function(b9,b8,b7){F(b9,b8,true,b7,b7);};var aT=function(ca,b9,b7,b8){return F(ca,b9,false,b7,b8);};var F=function(cc,ca,b9,b8,cb){var b7=J.getFinalSelectId(cc);var cd=function(cf,ce){bO(cc,b7).selectValue(b7,cc,ce);};if(b9){if(af()){return b4.loadFinalResultsById(LQ_Core,cc,ca,cd,b8,cb);}else{return o.loadFinalResultsById(LQ_Core,cc,ca,false,cd,b8,cb);}}else{if(af()){return b4.loadFinalResultsByKey(LQ_Core,cc,ca,cd,b8,cb);}else{return o.loadFinalResultsByKey(LQ_Core,cc,ca,false,cd,b8,cb);}}};var bv=function(ca,b7,b9){var b8=bQ("#"+b7);J.log("triggerSelect: "+b7+" / Current state: "+b8.css("display"));if(b8.css("display")=="block"){bL(ca,b8,b9);if(b9&&bO(ca,b7).isCursorSupported(b7)){bj(b7);}}else{aX(ca,b7,b8,true,null);bQ("#"+b7+"_input").select();}return false;};var a9=function(){return(af()||bX.isExpand||KS_Utils.isSmallScreen())&&!KS_Utils.isWin7();};var aX=function(cc,b7,b9,cb,cd,ca){if(j(cc,b7)){return;}var b8=a0[1];J.log("showSelect() is called. loadingSelect="+bG+", visibleElement="+b8);if(bG!=null&&bG!=b7){J.log("Another select is active and loading data: "+bG);if(bO(cc,b7).isCursorSupported(b7)){bj(bG);}return;}if(b8!=null&&b8!=b7){bL(cc,null);}a0[0]=cc;a0[1]=b7;if(b9==null){b9=bQ("#"+b7);}if(be.isEform){J.zIndexUp(b9);}if(b9.css("display")!="block"){b9.css("display","block");if(a9()){aP(LQ_Core,b9,b7,(ca),function(){bt(cc,b7,cb,cd);});}else{bt(cc,b7,cb,cd);}by(b7,true);}else{J.log("Select is already visible.");if(cd!=null){cd();}}};var bt=function(b9,b7,b8,ca){if(b8){az[b7](false,ca);}if(!bU(b7)){bQ("#"+b7+"_scroll").scrollTop(0);}if(!g){setTimeout(function(){bQ("#"+b7+"_scroll").scroll(function(){if(bO(b9,b7).isCursorSupported(b7)){bj(b7);}});},200);}if(ca!=null&&!b8){ca();}};var bL=function(ca,b8,b9){var b7=a0[1];if(b7==null&&b8==null){return;}if(b8==null){b8=bQ("#"+b7);}if(j(ca,b8.attr("id"))){return;}J.log("Hide select: "+b8);b8.css("display","none");if(a9()){a2(b8,b7);}if(be.isEform){J.zIndexDown(b8);}if(d[b7]!=null){J.log("Search is present: "+d[b7]);V(ca,b7);bd(ca,b7,true);}bQ(".lastSelectedLookup").removeClass("lastSelectedLookup");bQ("#"+b7+"_input").addClass("lastSelectedLookup");a0[0]=null;a0[1]=null;if(b9!=true){by(b7,false);}};var ak=function(b7){bQ("#"+b7).attr("disabled",true);bQ("#"+b7+"_input").attr("disabled",true);bQ("#"+b7+"_cursor").attr("disabled",true);bQ("#"+b7+"_reset").attr("disabled",true);};var aE=function(b8,b7){bL(b8,null);b3(b8,b7,false);z(b7);};var e=function(b7,b9,b8){J.log(b7);if(b7.relatedTarget&&!bQ(b7.relatedTarget).hasClass("dropdownBtn")){var ca=bQ(b7.target).closest("#lookupContainter_"+b9);if(ca.find(bQ(b7.relatedTarget)).length==0){bL(b9,null);}}};var aF=function(ca,b7){J.log("Clear all for question: "+ca);var b9=bV[ca];if(b9){for(var b8=0;b8<b9.length;b8++){if(b9[b8]&&b9[b8]!=J.getFinalSelectId(ca)&&b7&&b7===ca){J.log("Clear element: "+b9[b8]);bL(ca,null);b3(ca,b9[b8],true);}}}};var ac=function(b9,b7){var b8=a0[1];if(b8!=null&&b8!=b7){bL(b9,null);}J.log("loadingSelect: "+bG);if(bG!=null){return;}J.log("Search started for: "+b7+". Filter["+b7+"]: "+d[b7]);bZ(b9,b7);bw(b9,b7);az[b7](true,function(){aX(b9,b7,null,false,null);});};var bd=function(b9,b7,b8){J.log("Reset search for: "+b7);a[b7]=null;d[b7]=null;aU[b7]=null;bp[b7]=0;if(b8){bA(b9,b7);}};var aN=function(b9,b7,b8){V(b9,b7);bd(b9,b7,b8);aO[b7]=null;az[b7](true,null);};var V=function(ca,b8){var cb=bQ("#"+b8+"_input");var b9=a[b8];J.log('Restore value "'+b9+'" for '+b8);var b7=aJ(ca,b8);if(b9==null||b9.length==0){b9=b7;}cb.val(b9);aY[b8]=true;if(b9==b7){z(b8);}};var aA=function(b7,b9){if(aY[b7]){if(!b9){b9=bQ("#"+b7+"_input");}var b8=b9.val();a[b7]=b8;J.log('Backup value "'+b8+'" and reseting field...');}};var s=function(b8,b7){var b9=bQ("#"+b7+"_input");aY[b7]=true;b9.focus(function(){J.log("Input text gain focus. Search value: >"+bQ.trim(b9.val())+"<");if(af()&&bQ.trim(b9.val())==0){J.log("Double Focus Detected! No action required.");return;}aA(b7,b9);J.log("searchFilter[elementId]="+d[b7]);if(d[b7]==null||d[b7].length==0){b9.val("");}aX(b8,b7,null,true,null,true);return false;});b9.focusout(function(){J.log("Input text lost focus.");if(bQ.trim(b9.val()).length==0){V(b8,b7);}});b9.keyup(function(ca){var cb=b9.val();J.log("User printing text in search field [elementId="+b7+"]... Current text: "+cb);d[b7]=(aJ(b8,b7)==cb)?null:cb;if(ca.keyCode==13){if(bO(b8,b7).isCursorSupported(b7)){if(!aO[b7]&&bU(b7)>0){bj(b7);A(b8,b7,1);}else{ac(b8,b7);}}else{if(j(b8,b7)){ac(b8,b7);}}aO[b7]=null;return false;}else{if(ca.keyCode==27){J.log("Escape: cancel all actions and restore value.");if(j(b8,b7)){aN(b8,b7,false);}else{aO[b7]=null;bL(b8,null);if(bO(b8,b7).isCursorSupported(b7)){bj(b7);}}b9.blur();}else{if(ca.keyCode==40||ca.keyCode==38){aO[b7]=null;return false;}else{if(ca.keyCode==9||ca.keyCode==16||ca.keyCode==17||ca.keyCode==18){return false;}else{aY[b7]=false;aO[b7]=new Date().getTime();setTimeout(function(){J.log("Is user active? ... [keyCode: "+ca.keyCode+"]");if(aO[b7]!=null&&new Date().getTime()-aO[b7]>=900){aO[b7]=null;J.log("No! Start search...");if(d[b7]&&bQ.trim(d[b7]).length>0){bD(b7);}else{z(b7);}ac(b8,b7);}else{J.log("Yes. No action is required.");}return false;},1100);}}}}});J.log("Search listener is added for: "+b7);};var bD=function(b7){J.log("showResetButton: "+b7);bQ("#"+b7+"_reset").show();};var z=function(b7){J.log("hideResetButton: "+b7);bQ("#"+b7+"_reset").hide();};var u=function(cb,ca){var b9=bV[cb];if(b9){for(var b8=0;b8<b9.length;b8++){var b7=b9[b8];if(b7==ca){continue;}if(aG(b7)){bA(cb,b7);}}}if(ca!=null){H(ca,true);}J.log("All selectors [qid="+cb+"] are marked as not-loaded.");return false;};var bA=function(b8,b7){H(b7,false);bZ(b8,b7);bw(b8,b7);};var bH=function(b9){var b7=au(b9);for(var b8=0;b8<b7.length;b8++){aW(b9,b7[b8]);}};var b5=function(b8,b7){return bO(b8,J.getFinalSelectId(b8)).resetFinalSelect(b8,b7);};var aL=function(b8,b7){bO(b8,J.getFinalSelectId(b8)).resetFilters(b8,b7);};var aW=function(b8,b7){a5(b8,"lookupField_"+b7);return false;};var a5=function(b8,b7){J.log("Reset select for: "+b7);bQ("#"+b7+"_input").val(aJ(b8,b7));aY[b7]=true;if(bO(b8,b7).isCursorSupported(b7)){R(b7);}bw(b8,b7);bd(b8,b7,false);E[b7]=null;z(b7);return false;};var bE=function(b8){if(bX.isSelectorTag){bb[b8]=true;return;}var b7=bC(b8);if(!b7){J.log("We lost our selected element -> reset results.");aw(b8,null,null);}bb[b8]=true;J.log("isFinalDataLoaded["+b8+"] -> true");};var D=function(b8,b7){bA(b8,b7);a5(b8,b7);};var a7=function(b9,b8,b7){aL(b9,b7);return b5(b9,new LQ_Event(J.getFinalSelectId(b9),null,null,b9,0,b8));};var A=function(b9,b7,b8){a3(B.getSelectionDropdownEvent(b9,b7,b8));};var bz=function(cc,b8,cb,b7){var ca=bQ("#"+b8+"_"+cb);var b9=ca.prop("checked");ca.prop("checked",!b9);bq(cc,b8,cb,b7);};var bq=function(cb,b8,ca,b7){var cc="#"+b8+"_"+ca;var b9=bQ(cc).prop("checked");if(b9){bQ(cc+"_container").parent().addClass("lookupCheckboxSelected");}else{bQ(cc+"_container").parent().removeClass("lookupCheckboxSelected");}av(new LQ_Event(b8,b7,ca,cb,0,b9));};var b3=function(ca,b7,b8){J.log("doUnselect: "+ca+", "+b7+", "+b8);var b9=new LQ_Event(b7,null,null,ca,0,false,b8);a3(b9);bA(ca,b7);};var a3=function(b9){var b8=b9.elementId;var ca=b9.row;var b7=b9.view;if(bO(b9.qid,b8).isCursorSupported(b8)){bf(LQ_Core,b8,ca);}r(b8,ca);aO[b8]=null;bQ("#"+b8+"_input").val(b7==null?aJ(b9.qid,b8):b7);b6[b8](b9,function(){a[b8]=null;aY[b8]=true;J.log("searchFilter["+b8+"]="+d[b8]);if(d[b8]!=null){J.log("Reset search results: "+b8);bd(b9.qid,b8,true);}bL(b9.qid,null);bM(b9.qid,b8,ca);if(bO(b9.qid,b8).isCursorSupported(b8)){bj(b8);}});};var av=function(b8){var b7=b8.elementId;b6[b7](b8);};var bM=function(b9,b7,b8){if(b8==0||k(b9)){z(b7);}else{bD(b7);}};var aR=function(cj,ce,cg,ca){if(aG(ce)){J.log("Selector is actual for "+ce);return;}ae(ce);bQ("#"+ce+"_table").empty();var b7=isNaN(bp[ce])?0:bp[ce];var cn=b7+(isNaN(y[ce])?400:y[ce]);var cm=aU[ce];var cb={};cb.LoadOptions="1";cb.fieldId=cg;cb.listId=b1(cj);cb.questionId=cj;cb.surveyId=ah();cb.fieldSelectedValue=bQ("#"+ce).val();cb.indexStart=b7;cb.indexEnd=cn;cb.complexName=cg==-1?"true":"false";cb.needGlobalCount=(cm==null)?"true":"false";var ck=c(cj);if(bQ.isArray(ck)){for(var cd=0;cd<ck.length;cd++){var cf=ck[cd];if(!bQ.isArray(cf)){throw"Filter by views supports only array of arrays. Example: [[1,2],[3]]";}for(var cc=0;cc<cf.length;cc++){cb["viewIds["+cd+"]["+cc+"]"]=cf[cc];}}}else{cb.viewId=ck;}var ci=an(cj);var ch=a1(ce,cj);if(d[ce]!=null){cb.searchFieldId=cg;cb.searchFilter=d[ce];}if(af()){b4.loadDataOffline(LQ_Core,cb,ci,ch,cj,ce,ca);}else{var cl=ba[ce];var b9=(cl)?cl.serverUrl:null;cb.loginUserId=(cl)?cl.loginUserId:null;var b8=bQ.extend(cb,ci,ch);o.loadDataOnline(LQ_Core,b8,cj,ce,ca,b9);}return false;};var aj=function(b7,b8){aR(b7,J.getFinalSelectId(b7),-1,b8==null?bE:b8);if(b8!=null){bb[b7]=true;}return false;};var ao=function(cd,cc,b8,cb,ca){var b7=KS_Utils.currentTime();var ce="true"===ca.needGlobalCount;if(ce){cb=x(cc,cb);}var cf=G(cd,cc,cb);a8(cc);am(cc);aQ(cc,cf);J.log("Rendered in "+(KS_Utils.currentTime()-b7)+" ms.");H(cc,true);var b9=bO(cd,cc).isCursorSupported(cc);if(b9){R(cc);}bw(cd,cc);if(b9){L(cc);}if(bQ.isFunction(b8)){b8(cd);}aI();};var br=function(b9,b8){var b7=J.getFinalSelectId(b9);if(k(b9)){LQ_Core.disableSelect(b7);}else{LQ_Core.setLoadAction(b7,C(b9,b7));LQ_Core.setSelectAction(b7,bO(b9,b7).getFinalSelectListener(b9,b8,b7));LQ_Core.resetPager(b9,b7);LQ_Core.resetSelectedRow(b9,b7);if(bO(b9,b7).isCursorSupported(b7)){aS(LQ_Core,b9,b7);}LQ_Core.addSearchListener(b9,b7);J.log("Final listener is added for "+b7);}return false;};var C=function(b8,b7){return function(b9,ca){if(b9){H(b7,false);}else{if(aG(b7)){J.log("Data is not changed: return for "+b7);return;}}aj(b8,ca);return false;};};var ax=function(ca,b9,b8){var b7="lookupField_"+b9;if(k(ca)){ak(b7);}else{az[b7]=function(cb,cc){if(cb){H(b7,false);}else{if(aG(b7)){J.log("Data is not changed: return for "+b7);return;}}aR(ca,b7,b8,cc);return false;};b6[b7]=function(cb,ce){var cc=cb.value;var cd=cb.row;J.log("change [field "+b8+"]");J.log("Onchange: currently selected: "+E[b7]+", selected: "+cc);if(E[b7]==cc){J.log("Onchange: value is not changed. The end. "+b7);if(ce){ce();}return false;}E[b7]=(cd==0)?null:cc;J.log("Onchange: value is changed for element "+b7);u(ca,b7);if(bb[ca]){J.log("Data List is already loaded, refresh it...");bO(ca,J.getFinalSelectId(ca)).resetFinalSelect(ca,cb);}else{J.log("Data List is not loaded. No update is required.");}bu(cb);if(ce){ce();}return false;};bZ(ca,b7);bw(ca,b7);if(bO(ca,b7).isCursorSupported(b7)){aS(LQ_Core,ca,b7);}s(ca,b7);J.log("Field listener is added for "+b7);}return false;};var ai={};var ag={};var bf=function(ca,b7,b9){var b8=ca.getSelectedRow(b7);bQ("#"+b7+"_"+b8).removeClass("selectedItem");bQ("#"+b7+"_"+b9).addClass("selectedItem");J.log("ACTIVATE: "+b7+"_"+b9);J.log("Remove/Add selection for "+b7+" rows "+b8+"/"+b9);ai[b7]=bQ("#"+b7+"_scroll").scrollTop();ag[b7]=ai[b7]-aM(b7);J.log("Revalidated offset: scrollOffsetDown: "+ai[b7]+", scrollOffsetUp: "+ag[b7]+", selectedRow="+b8);};var bJ=function(b9,b7){var b8=b9.getSelectedRow(b7);bQ("#"+b7+"_"+b8).removeClass("selectedItem");};var aM=function(b7){return bX.scrollSize-bx(b7);};var P=function(b7){var b8=Math.floor(bX.scrollSize/bx(b7));J.log("getScrollRowsCount="+b8);return b8;};var bx=function(b7){return bQ("#"+b7+"_0").eq(0).height();};var R=function(b7){J.log("resetCursor: "+b7);ag[b7]=null;ai[b7]=null;};var h=function(b7){var ca=bQ("#"+b7+"_0").eq(0);var b8=ca.outerHeight()-ca.height();var b9=Math.ceil(b8/2);J.log("Padding = "+b9);return b9;};var Y=function(cc,cb,b9,b7,ca,b8){if(b7){cc.showSelect(cb,b9,null,true,function(){return at(cc,b9,b7,ca,b8);});return;}at(cc,b9,b7,ca,b8);};var bj=function(b7){bQ("#"+b7+"_cursor").focus();J.log("Focus moved to cursor.");};var aS=function(ca,b8,b7){var b9=bQ("#"+b7+"_input");b9.keydown(function(cb){if(cb.keyCode==40||cb.keyCode==38){bj(b7);Y(ca,b8,b7,cb.keyCode==40,1,false);return false;}});bQ("#"+b7+"_cursor").keydown(function(cb){if(cb.keyCode==40||cb.keyCode==38){Y(ca,b8,b7,cb.keyCode==40,1,false);return false;}else{if(cb.keyCode==37){ca.changePage(b8,b7,2,null);return false;}else{if(cb.keyCode==39){ca.changePage(b8,b7,3,null);return false;}else{if(cb.keyCode==33){Y(ca,b8,b7,false,P(b7),false);return false;}else{if(cb.keyCode==34){Y(ca,b8,b7,true,P(b7),false);return false;}else{if(cb.keyCode==13){ca.doSelect(b8,b7,ca.getSelectedRow(b7));return false;}else{if(cb.keyCode==27){J.log("Escape: close select");ca.hideSelect(b8,null);return false;}else{if(cb.keyCode==8){return false;}}}}}}}}});};var at=function(cc,cd,ce,b8,b9){J.log("---------------------------------------------------------------------------------------");J.log("Cursor pressed for: "+cd);var ck=cc.getSelectedRow(cd);var ch=cc.getPageSizes();var cg=bQ("#"+cd+"_scroll");if(ck!=null&&ck>=0){var cj=bQ("#"+cd+"_"+ck);J.log("Current row: "+ck+", pageSize: "+ch[cd]+", currentRowExists?: "+(cj.length>0));cj.removeClass("selectedItem");var ca=X(cj.position().top,cd);if(!ca){J.log("Current row is not visible, move scroll to it...");cg.scrollTop(ai[cd]==null?0:ai[cd]);if(b9){J.log("RECURSE GUARD: Break execution!");return false;}else{return at(cc,cd,ce,b8,true);}}if(ce){ck=ck+b8;if(ck>=ch[cd]){ck=ch[cd];}if(bQ("#"+cd+"_"+ck).length==0){J.log("There is no target row: "+ck);ck=bQ("#"+cd+"_table li").length-1;}}else{ck=ck-b8;}}else{ck=0;}if(ck<0){ck=0;}J.log("Target row: "+ck);bQ("#"+cd+"_"+ck).addClass("selectedItem");if(bQ("#"+cd+"_"+ck).position()){var cb=Math.floor(bQ("#"+cd+"_"+ck).position().top);var ci=ai[cd];var b7=ag[cd];J.log(" >> offset: "+cb+", scrollOffsetDown: "+ci+", scrollOffsetUp: "+b7+", selectedRow="+ck);var cf=X(cb,cd);J.log("isVisible="+cf+", scrollsize="+aM(cd));if(ce&&!cf){if(ci!=null&&ci>=0){cb=cb+ci;ag[cd]=ci;}else{ag[cd]=0;}ai[cd]=cb;J.log("scrolling down to "+cb+" ...");cg.scrollTop(cb);}else{if(!ce&&!cf){if(b7!=null){cb=cg.scrollTop()+cb;ag[cd]=b7-aM(cd);if(ag[cd]<0){ag[cd]=0;}ai[cd]=cb;J.log("scrolling up to "+cb+" ...");cg.scrollTop(cb);}}}cc.setSelectedRow(cd,ck);J.log(" << offset: "+cb+", scrollOffsetDown: "+ai[cd]+", scrollOffsetUp: "+ag[cd]+", selectedRow="+ck+", current="+cg.scrollTop());}};var L=function(b7){J.log("Select first row ...");at(LQ_Core,b7,true,1,false);};var X=function(b8,b7){J.log("isRowVisible: offset="+b8+", scrollSize="+aM(b7));return b8>=0&&(b8+h(b7))<=aM(b7);};var aB=function(b7){return ay(b7,J.getFinalSelectId(b7));};var j=function(b8,b7){return b7!=null&&ay(b8,b7)&&J.isFinalSelect(b7);};var aJ=function(b9,b7){if(j(b9,b7)){return bX.txtSearch;}else{var b8=ba[b7];return bQ.trim((b8)?b8.txtNotSelected:bX.txtNotSelected);}};var bO=function(b8,b7){if(j(b8,b7)){return T;}else{return B;}};var aP=function(cd,b9,b8,ca,cc){var cb=bQ("#"+b8+"_input");var b7=bQ("meta[name='viewport']");bl=bQ(window).scrollTop();J.log("Expand select to fullscreen. isFromFocus="+ca);aD().css("visibility","hidden");if(aD().is("#main_frame")){if(/iphone|ipod|ipad/i.test(navigator.userAgent.toLowerCase())){bQ("body").addClass("ios iosSurvey");}aD().css("height",bQ(window).height()).css("width",bQ(window).width()).css("overflow","hidden");}window.scrollTo(0,0);b9.parent().appendTo("body");b9.parent().addClass("isCurrentlySelected");cb.select();if(cc){setTimeout(cc,10);}};var a2=function(b9,b8){aD().css("visibility","visible");var b7=bQ("meta[name='viewport']");if(aD().is("#main_frame")){aD().removeAttr("style");}var ca="#LookupControl_"+J.getElementIdNum(b8);b9.parent().removeClass("isCurrentlySelected");b9.parent().appendTo(ca);if(bl){bQ(window).scrollTop(bl);bl=null;}};var bg=function(ch,b7,b9,cc){var cd=v(ch);var ca="";var ce=false;for(var cb=0;cb<cd.length;cb++){var cg=cd[cb].value;if(cd[cb].isField){var ci=l(ch)[cg];var b8=cc?KS_ValueType.convertValue(bT(ch,cg),b9[ci]):KS_Utils.encodeForJS(b9[ci]);if(KS_Utils.isValueExistsAndNotEmpty(b8)){if(!ce){ce=true;}ca+=bQ.trim(b8);}}else{ca+=cg;}}if(!ce){var cf=l(ch)[LQ_Core.getKeyFieldId(ch)];ca+="("+b9[cf]+")";}return ca;};var aC=function(b7){return(LQ_Core.getAnswerObjectViewId(b7))?true:false;};var m=function(b7){return bQ("#QuestionAnswersTableId"+b7).length>0;};var n=function(b9,b7){var b8=bV[b9];if(!b8){b8=[];bV[b9]=b8;}b8.push(b7);};var r=function(b8,b9){J.log("Set selected row ["+b8+"] = "+b9);var b7=aa[b8];if(b7){if(b7==b9){return;}else{if(b7>0){bQ("#"+b8+"_"+b7).removeClass("selectedItem");}}}if(b9>0){bQ("#"+b8+"_"+b9).addClass("selectedItem");}aa[b8]=b9;return false;};var bC=function(b7){return bO(b7,J.getFinalSelectId(b7)).isSomethingSelected(b7);};var ab=function(b8,b7){return bO(b8,J.getFinalSelectId(b8)).getResultAsText(b8,b7);};var f=function(b7,b8){bs(b7,bB,b8);};var by=function(b7,b8){J.log("Fire lookup visibility listeners for "+b7+", isVisible: "+b8);aV(b7,bB,b8);};var bm=function(b7,b8){bs(b7,ar,b8);};var bW=function(b7){aV(b7,ar,null);};var bu=function(b7){J.log("Fire global lookup change event: "+b7.toString());bQ("#"+b7.elementId).trigger("change",{view:b7.view,value:b7.value,row:b7.row,id:b7.elementId,qid:b7.qid,type:b7.type,ignoreListeners:b7.ignoreListeners});};var bs=function(ca,b8,b9){var b7=b8[ca];if(b7==null){b7=[];b8[ca]=b7;}b7.push(b9);};var aV=function(cb,b9,ca){var b8=b9[cb];if(b8!=null){for(var b7=0;b7<b8.length;b7++){b8[b7](ca);}}};var a4=function(b8,b7){return p(b8).perPageCounts[b7];};var N=function(b8,b7){return p(b8).layoutColumns[b7];};var ay=function(b8,b7){return p(b8).elementTypes[b7]==2;};var bT=function(b9,b7){var b8=p(b9).valueTypes[b7];if(b8){return new ValueType(b8.valType,b8.decimals,b8.decimalDivider,b8.thousendDivider,b8.format,b8.preffix,b8.suffix);}else{return null;}};var v=function(b7){return p(b7).nameParts;};var l=function(b7){return p(b7).fieldAnswerMapping;};var au=function(b7){return p(b7).rowIds;};var U=function(b7){return p(b7).answerIds;};var aK=function(b7){return p(b7).keyFieldId;};var w=function(b7){return p(b7).keyFieldName;};var b1=function(b7){return p(b7).listId;};var c=function(b7){return p(b7).viewId;};var O=function(b8){var b7=p(b8);return(b7)?p(b8).answerObjectId:null;};var I=function(b8){var b7=p(b8);return(b7)?b7.answerObjectViewId:null;};var q=function(b7){return p(b7).expressions;};var bU=function(b7){return aa[b7];};var bS=function(){return y;};var aG=function(b7){return aZ[b7]?true:false;};var H=function(b7,b8){J.log("setSelectorActual > elementId: "+b7+", value: "+b8);aZ[b7]=b8;};var b0=function(b7,b8){az[b7]=b8;};var Z=function(b7,b8){b6[b7]=b8;};var aq=function(b7,b8){E[b7]=b8;};var Q=function(b7){return E[b7];};var bP=function(b8,b7){aY[b8]=b7;};var bk=function(b7){bI=b7;};var a6=function(){return bI;};var t=function(b7,b8){ba[b7]=b8;};var bY=function(b7){return ba[b7];};var bN=function(b7){bK[b7]=true;};var k=function(b7){return bK[b7];};return{loadingSuccessEvent:ao,hideProgressBar:aI,doSelect:A,doSelectCheckbox:bq,hideSelect:bL,showSelect:aX,changePage:bo,populateResult:aw,showFinalSelectedResult:M,showFinalSelectedResultByContainer:i,addFieldSelectListener:ax,showFieldSelectedResult:bF,triggerSelect:bv,addPredefinedFilterListeners:bc,addPredefinedLookupFilterListener:al,selectPageText:W,getPageNumber:b,getPageDigits:bh,backupSearch:aA,clearSelect:aE,clearFiltersGUI:aF,fireGlobalChangeEvent:bu,loadDataForFinalSelect:aj,resetPager:bZ,resetSelect:a5,resetSelectedRow:bw,resetControl:D,getFinalLoadListener:C,addSearchListener:s,disableSelect:ak,addFinalListeners:br,fireLookupResultsListeners:bW,addLookupVisibilityListener:f,resetSearch:bd,resetActualityForElement:bA,clearSearch:aN,getInstance:bO,checkCheckbox:bz,getComplexName:bg,isMultipleQuestion:aB,selectValueById:K,selectValueByKey:aT,isPresentOnVotingPage:aC,isPresentOnVisualPage:m,isOffline:af,getLookupEnv:ap,getLookupDTO:p,resetResults:a7,setBatchOperations:bk,isBatchOperations:a6,isSomethingSelected:bC,getResultAsText:ab,getSelectedRow:bU,setSelectedRow:r,getPageSizes:bS,getExpressions:q,setValueIsObject:bP,setLoadAction:b0,addQuestionElement:n,setSelectAction:Z,setDropdownValue:aq,getDropdownValue:Q,getLayoutColumns:N,getValueType:bT,getNameParts:v,getFieldAnswerMapping:l,getAnswerIds:U,getRowIds:au,getKeyFieldId:aK,getKeyFieldName:w,getListId:b1,getViewId:c,getAnswerObjectId:O,getAnswerObjectViewId:I,setElementConfig:t,getEmptyText:aJ,setReadonly:bN,isReadonly:k,getRespondentResults:an,getVotingFilters:a1,controlExit:e};})(jQuery,window.LQ_GuiConfig,window.LQ_Utils,window.LQ_Online,window.LQ_Offline,window.LQ_Single,window.LQ_Multiple,window.eventsModuleProvider,window.ksConfig);if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=LQ_Core;}