if(window.LQ_Multiple){throw"There is another instance of LQ_Multiple! Check JS includes.";}var LQ_Multiple=(function(o,H){var M={};var n={};var i={};var v={};var z=[];var s=function(P,N){for(var O=0;O<z.length;O++){z[O](P,N);}};var h=function(W,U,T){var R=LQ_Core.getLayoutColumns(W,U);LQ_Utils.log("createCheckHtml: "+W+", "+U+", "+R);var V="<table cellpadding='0' cellspacing='10' border='0'>";var ab=LQ_Utils.getFinalSelectId(W);var X=parseInt(o("#"+ab+"_input").attr("tabIndex"))+1;if(T!=null&&T.length>0){var O=T.split(LQ_Core.getLookupEnv().valueDelimiter);var ad=0;var Q=0;for(var S=0;S<O.length;S++){var Z=O[S];Z=KS_Utils.encodeForJS(Z);var N=Z.split(LQ_Core.getLookupEnv().valueEquals);if(Q==0){V+="<tr>";}var aa=N[0];var Y=N[1];var ac=KS_Utils.escapeForJQuery(Y);var P=M[W]&&M[W][aa];V+="<td "+(P?'class="lookupCheckboxSelected"':"")+'><span class="lookupCheckbox" id="'+U+"_"+aa+'_container"><input type="checkbox" tabIndex="'+X+'"  id="'+U+"_"+aa+"\" onclick='LQ_Core.doSelectCheckbox("+W+', "'+U+'", "'+aa+'", "'+ac+'")\' title="'+ac+'"';X++;if(P){V+=" checked";}V+="/><label dir='auto' onclick='LQ_Core.checkCheckbox("+W+', "'+U+'", "'+aa+'", "'+ac+"\")'>"+Y+"</label></span></td>";Q++;if(Q==R){V+="</tr>";ad++;Q=0;}}}V+="</table>";return V;};var K=function(P,O){var N="lookupFinalSelect_"+P;if(!LQ_Core.isReadonly(P)){n[P]=function(Q){LQ_Core.resetActualityForElement(P,N);u(P);};}LQ_Core.addFinalListeners(P,O);if(!LQ_Core.isReadonly(P)){u(P);}return false;};var u=function(N){LQ_Core.loadDataForFinalSelect(N,null);LQ_Core.resetPager(N,"lookupFinalSelect_"+N);};var l=function(S){var R='<table class="selectedObjectView">';var T=M[S];var U=false;if(T){var Q=0;for(var N in T){Q++;}var O=10000-1-Q;for(var N in T){if(!T.hasOwnProperty(N)){continue;}var P=T[N];if(P){U=true;R+='<tr id="selectedObjectView_'+N+'" class="H3"><td dir="auto">';R+=LQ_Core.getComplexName(S,N,P,false);R+="</td>";R+='<td class="selectedObjectView_remove_td"><span><a href="javascript:void(0);" tabIndex="'+O+'" onclick="LQ_Multiple.resetResult(\''+S+"', '"+N+"');\">[x]</a></span>";R+="</td></tr>";}}}if(!U){R+='<tr><th class="H3 txtNoObjects">'+H.txtNoObjects+"</th></tr>";}R+="</table>";var V={headerText:"",messageText:R,afterShow:function(){window.ks.ui.messageDialog("refresh");},buttons:[{id:"okButton",text:"OK",handler:function(){window.ks.ui.messageDialog("close");o("#showSelectedLink_"+S).focus();}}]};window.ks.ui.messageDialog(V);return false;};var d=function(N){return !LQ_Utils.isFinalSelect(N);};var G=function(O,N){if(N.ignoreListeners){LQ_Utils.log("Ignore reseters for QID="+O);return;}LQ_Utils.log("Reseter exists? -> "+(n[O]!=null));if(n[O]){n[O](N);}return false;};var C=function(O,N){LQ_Core.clearFiltersGUI(O,N);};var t=function(P,O,N){return function(R,T){LQ_Utils.log("change [final select] qid="+P);var Q=R.value;var S=R.selected;if(H.isSelectorTag){LQ_Core.fireGlobalChangeEvent(R);if(T){T();}return false;}if(S){if(LQ_Core.isOffline()){LQ_Offline.loadFinalResultsById(LQ_Core,P,Q,T);}else{LQ_Online.loadFinalResultsById(LQ_Core,P,Q,O,T);}}else{A(P,Q);if(T){T();}}return false;};};var x=function(Q){if(!Q){return 0;}var P=0;var O=M[Q];if(O!=null){for(var N in O){if(N!=null&&N!="null"&&O.hasOwnProperty(N)&&O[N]){P++;}}}return P;};var r=function(O){var N=o("#mlqSelectedCount_"+O);N.empty();N.html(x(O));};var E=function(Q,O,P){if(O==null){B(Q);}else{if(P==null){A(Q,O);}else{var N=q(Q);N[O]=P;r(Q);s(Q,q(Q));D();LQ_Core.fireLookupResultsListeners(Q);LQ_Utils.log("Multiple result is set for QID: "+Q+", ObjectID: "+O);}}};var b=function(N,O){var R="#"+N+"_"+O;var P=o(R);if(P.length>0&&P.prop("checked")){P.prop("checked",false);o(R+"_container").parent().removeClass("lookupCheckboxSelected");}var Q=o("#selectedObjectView_"+O);if(Q.length>0){Q.remove();}};var a=function(O){var N=o("input[name^=other"+O+"_]");if(N.length>0){N.remove();}N=o("input[name^=R"+O+"]");if(N.length>0){N.remove();}};var A=function(P,O){delete q(P)[O];var N=LQ_Utils.getFinalSelectId(P);a(P);b(N,O);r(P);LQ_Utils.log("Multiple result is reset for QID: "+P+", ObjectID: "+O);s(P,q(P));LQ_Core.fireGlobalChangeEvent(new LQ_Event(N,null,null,P,0,false));return false;};var B=function(P){var N=LQ_Utils.getFinalSelectId(P);var O=LQ_Utils.getHiddenElements(P);if(O.length>0){O.val("");}a(P);_.each(M[P],function(R,Q){b(N,Q);});delete M[P];r(P);LQ_Utils.log("Multiple results are reset for QID: "+P);LQ_Core.fireGlobalChangeEvent(new LQ_Event(N,null,null,P,0,false));return false;};var q=function(O){var N=M[O];if(!N){N={};F(O,N);}return N;};var k=function(P){var O=LQ_Core.getAnswerObjectId(P);var N;if(LQ_Core.isPresentOnVisualPage(P)){if(M[P]){return x(P)>0;}N=o(g(P,O,0));}else{N=o("input[name="+L(P,O,0)+"]");}return N.length>0&&N.val().length>0;};var f=function(T,P){if(!k(T)){return null;}var W="";var V=(P)?P:LQ_Core.getAnswerObjectViewId(T);if(LQ_Core.isPresentOnVisualPage(T)&&M[T]){var R=M[T];for(var N in R){if(!R.hasOwnProperty(N)){continue;}if(N=="null"||N==null){continue;}var Q=R[N];if(Q){W+=(Q[V]?Q[V]:"")+", ";}}}else{var S=0;while(true){var O=o("input[name="+L(T,V,S)+"]");if(O.length>0){var U=O.val();if(U&&U.length>0){W+=U+", ";}S++;}else{break;}}}if(W.length>0){W=W.substring(0,W.length-2);}return W;};var I=function(T,R){var W={};if(!k(T)){return W;}if(LQ_Core.isPresentOnVisualPage(T)&&M[T]){W=M[T];}else{var S=0;while(true){var N=[];var O=0;for(var Q=0;Q<R.length;Q++){var V=R[Q];var P=o('input[name="'+L(T,V,S)+'"]');if(P.length>0){var U=P.val();if(U&&U.length>0){N[V]=U;}}else{O++;}}if(O==R.length){return W;}W[S]=N;S++;}}return W;};var e=function(){for(var S in M){if(!M.hasOwnProperty(S)){continue;}var R=M[S];if(R!=null){var P=x(S);if(P>0){var Q=i[S];var N=v[S];if(Q&&P<Q&&Q>=0||N&&P>N&&N>=0){var O=window.survData.questionsMap[S].name;alertMinMaxReq(S,KS_Utils.removeTags(O),Q<0?0:Q,N<0?0:N);return false;}}}}return true;};var J=function(N){LQ_Utils.log("showResultsOnline("+N+", "+M[N]+")");r(N);return false;};var m=function(X){try{var S=LQ_Core.getAnswerObjectId(X);var P=LQ_Core.getAnswerObjectViewId(X);LQ_Utils.log("MLQ showResultsOffline! qid="+X+", answerObjectId="+S+", answerObjectViewId="+P);var O=null;F(X,{});var U=LQ_Core.getAnswerIds(X);var T=0;while(true){var V=o(g(X,S,T));if(V.length<=0){LQ_Utils.log("MLQ OFFLINE/NO ObjectID Input for: qid="+X+", answerId="+S+", objectIndex="+T);break;}if(V.val().length<=0){LQ_Utils.log("MLQ OFFLINE/NO Result for: qid="+X+", answerId="+S+", objectIndex="+T);break;}var Q={};for(var R=0;R<U.length;R++){var Z=U[R];var N=o(g(X,Z,T));var Y=(N.length<=0)?"":N.val();Q[Z]=Y;LQ_Utils.log("MLQ OFFLINE/Restore result: qid="+X+", answerId="+Z+", objectIndex="+T+" --> "+Y);if(S==Z){O=Y;}}if(O!=null){M[X][O]=Q;LQ_Utils.log("MLQ offline result is restored for qid="+X+", dataObjectId="+O);}T++;}r(X);return false;}catch(W){LQ_Utils.log("[ERROR] showResultsOffline -> cant restore MLQ results: "+W);throw W;}};var c=function(O){var N=0;_.each(o("[id^=hidden_inputtextother"+O+"]"),function(Q){var S=o(Q).attr("id");var R=S.lastIndexOf("_");if(R>-1){R++;var P=parseInt(S.substring(R),10);if(P>-1&&P==N){N=P+1;}}});return N;};var D=function(){try{for(var U in M){if(!M.hasOwnProperty(U)){continue;}var S=0;LQ_Utils.log("MLQ add result: > QID: "+U);if(!LQ_Core.isPresentOnVisualPage(U)){S=c(U);}else{o("[id^=inputtextother"+U+"]").remove();}var P=M[U];if(P!=null){for(var N in P){if(!P.hasOwnProperty(N)){continue;}LQ_Utils.log("MLQ add result: > dataObjectId: "+N);if(N!=null&&N!="null"&&P[N]){var O=P[N];if(O){for(var V in O){if(!O.hasOwnProperty(V)){continue;}var W=O[V];if(V==LQ_Core.getAnswerObjectViewId(U)){W=LQ_Core.getComplexName(U,N,O,false);}W=KS_Utils.encodeForJS(W);var X=g(U,V,S).substring(1);var R=o("#"+X);if(R.length>0){R.val(W);}else{var Q=L(U,V,S);var Y='<input type="hidden" name="'+Q+'" id="'+X+'" value="'+W+'"/>';o(document.theForm).append(Y);}LQ_Utils.log("MLQ add result: qid="+U+", answerId="+V+", objectIndex="+S+" --> "+W);}}}S++;}}if(S==0){o("[id^=inputtextother"+U+"]").remove();}LQ_Utils.log("MLQ add result: completed for QID: "+U);}return true;}catch(T){LQ_Utils.log("[ERROR] appendResultsToForm -> cant add MLQ results: "+T);throw T;}};var p=function(P,O,N){i[P]=O;v[P]=N;};var w=function(N,R,P){var O=q(R);var Q=O[P];if(Q){o("#"+N+"_"+P).prop("checked",true);}else{LQ_Utils.log("[ ERROR ] Cant find object data for dataObjectId: "+P);}};var F=function(O,N){M[O]=N;};var g=function(P,N,O){return"#inputtextother"+P+"_"+N+"_"+O;};var j=function(P,N,O){return"#hidden_inputtextother"+P+"_"+N+"_"+O;};var L=function(P,N,O){return"other"+P+"_"+N+"_"+O;};var y=function(N){z.push(N);};return{createOptionsHtml:h,initFinalSelect:K,showResultsOnline:J,showResultsOffline:m,isCursorSupported:d,resetFinalSelect:G,getFinalSelectListener:t,populateResult:E,isSomethingSelected:k,resetResults:B,resetResult:A,showResultsDialog:l,validateMustCheck:e,appendResultsToForm:D,setMustCheckCount:p,getSelectedCount:x,selectValue:w,resetFilters:C,getResultAsText:f,getResult:I,setSelectedObjects:F,setChangedListener:y};})(jQuery,LQ_GuiConfig);