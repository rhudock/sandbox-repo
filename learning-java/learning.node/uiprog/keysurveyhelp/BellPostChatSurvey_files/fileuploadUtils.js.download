if(window.FU_Utils){throw"There is another instance of FU_Utils! Check JS includes.";}var FU_Utils=(function(aF,aG,ag,b,Y){var S={},af="/app/public/delete/file/",ax="/app/public/rotate/image/",I="/app/public/crop/image/",an="/app/public/savemarkup/image/",X="/app/public/original/file/",aw="/app/public/info/file/",l=0,V=["jpeg","jpg","png","gif","bmp"],G=["doc","docx","xls","xlsx","xlsm","csv","ppt","pptx","txt","pdf","rtf","xml"],D=[],f={},am=6000*4000,C=function(){return window.appRoot&&window.appRoot.isDevice();},A=function(){aF(".ReferenceImgBox a.dev_referenceImageBtn").on("click",window.minEnlargeReferenceImage);},s=function(){aF(".deleteFileBtn").on("click",function(aW){var aX=aW.isTrigger?"ignoreConfirm":false;aP(aF(this),aX);});},ad=function(){aF(".rotateFileBtn").on("click",function(aX){if(C()){v(aF(this));aF(this).blur();}else{var aY=aF(this);var a3=window.document.theForm;var a0=aF('[name="RID"]').val();var a4=aY.data("respondentid");var aW=aY.data("questionid");var a5=aY.data("answerid");var a1=M(aW,a5);var aZ=function(a6,a8){var a7=aF("#rotateUploadFile_"+aW+"_"+a5).data("hash");az(aW,a5,a6.respondentID,a8,a6.hash,a7);a1=M(aW,a5);};var a2=function(a7,a8,a6){if(a0!==a3.RID.value||a4!==a3.RID.value){aF.ajax({url:h(a3.RID.value,aW,a5),type:"POST",dataType:"json",success:function(a9){aF.when(aZ(a9,a4)).then(v(aY));}});return true;}return v(aY);};if(a3.respondentNewCreated&&a3.respondentNewCreated.value=="true"&&!window.resultHasBeenSaved&&window.pressedSave){aF.when(F()).then(a2);}else{a2();}aF(this).blur();}});},z=function(aW){ImageToolkit.Util.mainUtil.showCrop({"$imagePreviewParent":aF(".imageViewContainer"),shift:window.pageYOffset,currentImage:aW});},d=function(aW,aX){var aY=aW+"_"+aX;return(votingSubmitModule.responseId!=null?(votingSubmitModule.responseId+"_"+aY):aY);},ar=function(){var aW=screen.width>screen.height?screen.width:screen.height;return aW*window.devicePixelRatio;},F=function(){return window.pressedSave(true);},N=function(){aF(".cropFileBtn").on("click",function(aX){var a8=aF(this);if(a8.parents(".disabled").length){return;}if(C()){if(a8.hasClass("disabled")){return;}a8.addClass("disabled");var aW=a8.data("questionid");var a5=a8.data("answerid");var a7=aF("#AnswerTr"+aW+"_"+a5);a7.loadingOn();if(window.appRoot.getMajorVersion()<11){return;}var a0=aF("#fileUploadContainerImg_"+aW+"_"+a5).attr("data-imagedrawing");var a1=M(aW,a5);var a6=ar();ah(a1.imageSrc).done(function(a9){if(a9){window.appRoot.fs.resizeAttachedImage(a1.imageSrc,a0,true,d(aW,a5),a6,a6).done(function(ba){a1.imageSrc=ba;a8.removeClass("disabled");a7.loadingOff();z(a1);});}else{a8.removeClass("disabled");a7.loadingOff();}});}else{var a3=window.document.theForm;var aZ=a3.RID.value;var aW=aF(this).data("questionid");var a5=aF(this).data("answerid");var a4=aF("#rotateUploadFile_"+aW+"_"+a5).data("respondentid");var a1=M(aW,a5);var aY=function(a9,ba){var bb=aF("#rotateUploadFile_"+aW+"_"+a5).data("hash");az(aW,a5,a9.respondentID,a4,a9.hash,bb);a1=M(aW,a5);};var a2=function(ba,bb,a9){if(aZ!==a3.RID.value||a4!==a3.RID.value){aF.ajax({url:h(a3.RID.value,aW,a5),type:"POST",dataType:"json",success:function(bc){aF.when(aY(bc,a4)).then(z(M(aW,a5)));}});return true;}return z(a1);};if(a3.respondentNewCreated&&a3.respondentNewCreated.value=="true"&&!window.resultHasBeenSaved&&window.pressedSave){aF.when(F()).then(a2);}else{a2();}}});},O=function(a2,aW,a1){if(a2.is(":visible")){a2.focus();}else{var aY=aF("#deleteUploadFile_"+aW+"_"+a1);var aX=aF("#chooseFileBtn_"+aW+"_"+a1);var a0=aF("insertCameraBtn_"+aW+"_"+a1);var aZ=aF("#fileInput_"+aW+"_"+a1);if(aY.is(":visible")){aY.focus();}else{if(aZ.is(":visible")){aZ.focus();}else{if(aX.is(":visible")){aX.focus();}else{if(a0.is(":visible")){a0.focus();}}}}}},m=function(){aF(".markupFileBtn").on("click",function(aX){var a7=aF(this);if(aa()&&a7.hasClass("disabled")){return;}if(a7.parents(".disabled").length){return;}var aW=a7.data("questionid");var a4=a7.data("answerid");var a0=M(aW,a4);if(window.appRoot&&window.appRoot.isDevice()&&window.appRoot.getMajorVersion()>=11){var a6=aF("#AnswerTr"+aW+"_"+a4);a6.loadingOn();var a5=ar();ah(a0.imageSrc).done(function(a8){if(a8){window.appRoot.fs.resizeAttachedImage(a0.imageSrc,null,true,d(aW,a4),a5,a5).done(function(a9){a0.imageSrc=a9;a0.originalUrl=a9;a6.loadingOff();au(a0);});}else{a6.loadingOff();}});}else{var a2=window.document.theForm;var aZ=a2.RID.value;var a3=aF("#rotateUploadFile_"+aW+"_"+a4).data("respondentid");a0=M(aW,a4);var aY=function(a8,ba){var a9=aF("#rotateUploadFile_"+aW+"_"+a4).data("hash");az(aW,a4,a8.respondentID,ba,a8.hash,a9);a0=M(aW,a4);};var a1=function(a9,ba,a8){if(aZ!==a2.RID.value||a3!==a2.RID.value){aF.ajax({url:h(a2.RID.value,aW,a4),type:"POST",dataType:"json",success:function(bb){aF.when(aY(bb,a3)).then(au(a0));}});return true;}return au(a0);};if(a2.respondentNewCreated&&a2.respondentNewCreated.value=="true"&&!window.resultHasBeenSaved&&window.pressedSave){aF.when(F()).then(a1);}else{a1();}}});},ah=function(aX){var aW=aF.Deferred();if(window.appRoot&&window.appRoot.isDevice()&&window.appRoot.fs.getImageInfo){window.appRoot.fs.getImageInfo(aX).then(function(aY){if(aY.width*aY.height>am){window.ks.ui.alert(f.confirmFileTooLarge).done(function(){aW.resolve(false);});}else{aW.resolve(true);}});}else{aW.resolve(true);}return aW.promise();},au=function(aW){ImageToolkit.Util.mainUtil.showMarkup({"$imagePreviewParent":aF(".imageViewContainer"),shift:window.pageYOffset,currentImage:aW});},M=function(aZ,a1){var a5=aF("#fileUploadContainerImg_"+aZ+"_"+a1);var ba=aF("#AnswerLabel"+aZ+"_"+a1).text();var a4=aF("#QuestionLabel"+aZ).clone().find(".dev_QxAy").remove().end().text();var bb=aF("#answerValueUploadFile_"+aZ+"_"+a1).text();var a3=aF("#answerValueUploadFileExtension_"+aZ+"_"+a1).text();var a8=aF("#fileSizeUploadFile_"+aZ+"_"+a1).text();var a6=aF("#rotateUploadFile_"+aZ+"_"+a1);var aX=aF('[name="RID"]').val();var aY=a6.data("hash");var a7=a5.data("fileurl");var a2=n(aZ,a1,aX,aY);var a0=aT(aZ,a1,aX,aY);var bc=aQ(aZ,a1,aX,aY);var a9=t(aZ,a1,aX,aY);if(!a5.data("originalurl")){a5.data("originalurl",aE(aZ,a1,aX,aY));}var aW=(window.appRoot&&window.appRoot.isDevice())?a7:a5.data("originalurl");var bd=(window.appRoot&&window.appRoot.isDevice())?aW:a7;return{imageSrc:bd,alt:ba,questionId:aZ,answerId:a1,questionText:a4,answerBody:bb,answerExtension:a3,fileSize:a8,rotateUrl:a2,removeUrl:a0,cropUrl:bc,saveMarkupUrl:a9,originalUrl:aW,hasImageDrawing:a5.attr("data-imagedrawing")?true:false};},w=function(){aF(".downloadFileBtn").on("click",function(aW){aF(this).blur();aB(aF(this));});},aB=function(aX){if(aa()&&aX.hasClass("disabled")){return;}var aW=aX.data("questionid");var aZ=aX.data("answerid");var aY=aF("#fileUploadContainerImg_"+aW+"_"+aZ);var a0=aY.attr("data-imagedrawing");fileUploadHelper.downloadAttachedFile(aY.data("fileurl"),a0,aW,aZ);},aP=function(aW,aX){if(aW.length==0){return;}if(aa()&&aW.hasClass("disabled")){return;}if(aW.parents(".disabled").length){return;}x(aW.data("questionid"),aW.data("answerid"),aW.data("respondentid"),aW.data("hash"),aX);},v=function(aW){if(aW.length==0){return;}if(aa()&&aW.hasClass("disabled")){return;}if(aW.parents(".disabled").length){return;}aD(aW.data("questionid"),aW.data("answerid"),aW.data("respondentid"),aW.data("hash"));},p=function(aW,aY,aX){if(aX.success===true){o(aW,aY);}},aq=function(aW,aX){aF("input.htmlButton").removeAttr("disabled");aF("#fileInput_"+aW+"_"+aX).trigger("change");O(aF("#fileInput_"+aW+"_"+aX),aW,aX);},x=function(aW,aZ,aY,a0,aX){if(window.appRoot&&window.appRoot.isDevice()){return fileUploadHelper.deleteAttachedImage(aW,aZ,aT(aW,aZ,aY,a0),aX).then(Y.partial(p,aW,aZ)).always(Y.partial(aq,aW,aZ));}if(aX==="ignoreConfirm"||confirm(f.confirmDeleteFileLabel)){aF("input.htmlButton").attr("disabled","disabled");aF.ajax({url:aT(aW,aZ,aY,a0),type:"POST",dataType:"json"}).then(Y.partial(p,aW,aZ)).always(Y.partial(aq,aW,aZ));}},ae=function(aW,aX){aF("input.htmlButton").removeAttr("disabled");if(aa()){var aY=aF("#fileUploadContainer_"+aW+"_"+aX);aY.find("a").removeClass("disabled");aY.loadingOff();}else{var aZ=aF("#FUIFooter_"+aW+"_"+aX);aZ.removeClass("disabled");aZ.find(".rotateFileBtn").removeClass("disabled");aZ.parents(".FUIT").loadingOff();}},aD=function(aW,a0,aX,a1){aF("input.htmlButton").attr("disabled","disabled");var a3=aF("#FUIFooter_"+aW+"_"+a0);if(a3.hasClass("disabled")){return;}var aY=aF("#rotateUploadFile_"+aW+"_"+a0);if(aY.hasClass("disabled")){return;}if(aa()){var a2=aF("#fileUploadContainer_"+aW+"_"+a0);a2.find("a").addClass("disabled");a2.loadingOn();}a3.addClass("disabled");aY.addClass("disabled");a3.parents(".FUIT").loadingOn();var aZ=M(aW,a0);ah(aZ.imageSrc).then(function(a4){if(a4){return av(aW,a0,aX,a1);}}).always(Y.partial(ae,aW,a0));},av=function(aX,a0,aZ,a1){var a2=aF("#fileUploadContainerImg_"+aX+"_"+a0).attr("data-imagedrawing");if(a2){var aW=aF.Deferred();var aY=new Image();aY.src=a2;aY.onload=function(){var a3=this;setTimeout(function(){ap(a3,aX,a0,aZ,a1).then(aW.resolve,aW.reject);},100);};aY=null;return aW.promise();}else{return u(aX,a0,aZ,a1);}},ap=function(a1,aW,a3,a2,a0){var a4=aL(a1.width,a1.height);var aY=document.createElement("canvas");var aX=a4.width;var a5=a4.height;aY.width=a5;aY.height=aX;var a6=aY.getContext("2d");a6.translate(aY.width/2,aY.height/2);a6.rotate(Math.PI/-2);a6.drawImage(a1,0,0,a1.width,a1.height,-aY.height/2,-aY.width/2,aY.height,aY.width);a6.rotate(Math.PI/2);a6.translate(-aY.width/2,-aY.height/2);var aZ=aY.toDataURL();if(!window.appRoot||!window.appRoot.isDevice()){aF("canvas").remove();}return u(aW,a3,a2,a0,aZ);},u=function(aW,aZ,aX,a0,a1){var aY=window.appRoot&&window.appRoot.isDevice()?i:ac;return aY(aW,aZ,aX,a0,a1).then(function(){aF("#fileInput_"+aW+"_"+aZ).trigger("change");O(aF("#rotateUploadFile_"+aW+"_"+aZ),aW,aZ);});},y=function(aW,aX,aY){if(votingSubmitModule.responseId){return window.appRoot.attchFiles.save({responseId:votingSubmitModule.responseId,questionId:aW,answerId:aX},{imageDrawing:aY},false);}else{return window.appRoot.resolved();}},i=function(aX,a0,aZ,a1,a2){if(window.appRoot.getMajorVersion()<11){return window.appRoot.rejected();}var aY=aF("#fileUploadContainerImg_"+aX+"_"+a0);var aW=aY.data("fileurl");return window.appRoot.fs.rotateImage(aW).then(function(){return window.appRoot.fs.getFileByUrl(aW);}).then(function(a3){return ai(aX,a0,aW,a2,a3.size);});},g=function(){if(window.appRoot.getPlatform()=="win7"){return cordova.file.applicationStorageDirectory+"Temp/";}return window.appRoot.getPlatform()==="ios"?cordova.file.documentsDirectory:cordova.file.externalCacheDirectory;},ai=function(aY,a0,aX,a1,aW){var a2=d(aY,a0);var aZ=g()+"tmp/original/"+a2;return window.appRoot.fs.removeFile(aZ).then(function(){var a3=300*window.devicePixelRatio;return window.appRoot.fs.resizeAttachedImage(aX,a1,true,a2,a3,a3).then(function(a5){var a4=aF("#fileUploadContainerImg_"+aY+"_"+a0);a4.attr("src",a5+"?"+Math.random());if(aW!=undefined){a4.data("filesize",aW);}if(a1){return y(aY,a0,a1).then(function(){a4.attr("data-imagedrawing",a1);return appRoot.resolved(aX,a1);});}else{return appRoot.resolved(aX,null);}});});},E=1000,aL=function(aY,aW){var aX=aY;var aZ=aW;if(aX>=aZ&&aX>E){aZ=Math.round(aZ*E/aX);aX=E;}else{if(aX<aZ&&aZ>E){aX=Math.round(aX*E/aZ);aZ=E;}}return{width:aX,height:aZ};},ac=function(aW,aY,aX,aZ,a0){return aF.ajax({url:n(aW,aY,aX,aZ),type:"POST",dataType:"json",data:{imageDrawing:a0}}).then(function(a1){if(a1.error===false){r(aW,aY,aX,a1.newHash,a1.oldHash);if(a0){aF("#fileUploadContainerImg_"+aW+"_"+aY).attr("data-imagedrawing",a0);}}else{aN(aW,aY);}return a1;}).fail(function(){aN(aW,aY);});},q=function(aW,a1,a0){var aY=aF("#cancelUploadFile_"+aW+"_"+a1);var aX=aF("#uploadingFileName_"+aW+"_"+a1);aY.off("click").on("click",function(){a0.abort();aF(this).hide();U(aW,a1,0,false);var a3=aF("#fileInput_"+aW+"_"+a1);var a2=aF("input.htmlButton");a3.parent(".customFUInput").removeClass("hidden");a3.removeClass("hidden");if(l===0){a2.removeAttr("disabled");}});aY.css("display","inline-block");aY.removeClass("hidden");var aZ=a0.files!=null?a0.files[0]:null;if(aZ){aX.text(aZ.name).removeClass("hidden");}},o=function(aW,aY){var aX=aW+"_"+aY;aF("#inputtextother"+aX).val("");aF("#FUIFileInputBox_"+aX).removeClass("hidden");aF("#fileInput_"+aX).removeClass("hidden");aF("#FUIFooter_"+aX).addClass("hidden");aF("#fileUploadContainer_"+aX).addClass("hidden");aF("#fileUploadContainerImg_"+aX).attr("src","");},az=function(aW,a6,a5,aX,a8,a3){console.log("respondentId="+a5+" oldRespondentId="+aX+" newHash="+a8+" oldHash="+a3);var a2=aF("#fileUploadContainerImg_"+aW+"_"+a6);var aZ="/"+a5+"/";var a4="/"+aX+"/";if(a5!=aX){var a7=aF("#rotateUploadFile_"+aW+"_"+a6);var a0=aF("#deleteUploadFile_"+aW+"_"+a6);a7.data("respondentid",a5);a0.data("respondentid",a5);a7.data("hash",a8);a0.data("hash",a8);var a1=aF("#inputtextother"+aW+"_"+a6);var aY=aF("#downloadUploadFile_"+aW+"_"+a6);a1.data("link",T(a1.data("link"),a4,aZ));aY.attr("href",K(T(aY.attr("href"),a4,aZ),a3,a8));aY.click(function(){aY.focus();});a2.attr("src",K(T(a2.attr("src"),a4,aZ),a3,a8));a2.data("fileurl",K(T(a2.data("fileurl"),a4,aZ),a3,a8));if(!a2.data("originalurl")){a2.data("originalurl",aE(aW,a6,a5,a8));}a2.data("originalurl",K(T(a2.data("originalurl"),a4,aZ),a3,a8));}},r=function(aW,a2,aZ,a1,a3){var aY=aF("#fileUploadContainerImg_"+aW+"_"+a2);if(a1&&a3){aY.one("load",function(){aN(aW,a2);});aF("#rotateUploadFile_"+aW+"_"+a2).data("hash",a1);aF("#deleteUploadFile_"+aW+"_"+a2).data("hash",a1);var a0=aF("#inputtextother"+aW+"_"+a2);var aX=aF("#downloadUploadFile_"+aW+"_"+a2);a0.data("link",K(a0.data("link"),a3,a1));aX.attr("href",K(aX.attr("href"),a3,a1));aX.click(function(){alert(1);aX.focus();});aY.attr("src",K(aY.attr("src"),a3,a1));aY.data("fileurl",K(aY.data("fileurl"),a3,a1));if(!aY.data("originalurl")){aY.data("originalurl",aE(aW,a2,aZ,a1));}aY.data("originalurl",K(aY.data("originalurl"),a3,a1));}else{aN(aW,a2);}},aN=function(aW,aY){var aZ=aF("#FUIFooter_"+aW+"_"+aY);aZ.removeClass("disabled");var aX=aF("#rotateUploadFile_"+aW+"_"+aY);aX.removeClass("disabled");aZ.parents(".FUIT").loadingOff();},T=function(aY,a0,aX){if(!aY){return;}var aZ=aY.replace(a0,aX);var aW=aZ.indexOf("?dummy=");aZ=aW!=-1?aZ.substring(0,aW):aZ;aZ=aZ+"?dummy="+new Date().getTime();return aZ;},K=function(aX,a0,aY){if(!aX){return;}var aZ=aX.replace(a0,aY);var aW=aZ.indexOf("?dummy=");aZ=aW!=-1?aZ.substring(0,aW):aZ;aZ=aZ+"?dummy="+new Date().getTime();return aZ;},h=function(aX,aW,aY){return aw+aX+"/"+aW+"/"+aY+"/";},aT=function(aW,aY,aX,aZ){return aI(af,aW,aY,aX,aZ);},n=function(aW,aY,aX,aZ){return aI(ax,aW,aY,aX,aZ);},aa=function(){return document.getElementById("isEform")&&document.getElementById("isEform").value==="true";},aQ=function(aW,aY,aX,aZ){return aI(I,aW,aY,aX,aZ);},t=function(aW,aY,aX,aZ){return aI(an,aW,aY,aX,aZ);},aE=function(aW,aY,aX,aZ){return aI(X,aW,aY,aX,aZ);},aI=function(aY,aW,aZ,aX,a0){return aY+a0+"/"+aX+"/"+aW+"/"+aZ+"/";},H=function(){var aW=aa()?".FUIImg_eform div":".FUIImg";aF(aW).on("click",function(aY){if(aY.target==this){return;}var aX=aF(this).find("img");if(!aX.data("fileurl")){return;}if(!k(aX)){return;}ay(aX);});},ay=function(aY){b.disableScroll();var aW=aY.data("questionid");var a1=aY.data("answerid");var aX=aF("#QuestionAnswersTableId"+aW);var a2=[];var a0=0;var aZ=0;aX.find(".dev_previewImage:visible").each(function(a4,a5){if(!k(aF(a5))){return;}var a3=aF(a5).data("answerid");if(a1==a3){aZ=a0;}a2.push(M(aW,a3));a0++;});ImageToolkit.Util.mainUtil.showGallery({"$imagePreviewParent":aF(".imageViewContainer"),shift:window.pageYOffset,images:a2,currentIndex:aZ,showRotateButton:al(aY),showDeleteButton:aV(aY),showMarkupButton:aO(aY),showCropButton:ak(aY)});b.disableScroll();},e=function(aW){return aW.data("isimage")===true;},k=function(aW){return aW.data("isresizable")===true;},al=function(aW){return aW.data("showrotate")===true;},aV=function(aW){return aW.data("showdelete")===true;},aO=function(aW){return aW.data("showmarkup")===true;},ak=function(aW){return aW.data("showcrop")===true;},c=function(){aF(".dev_MouseOverEvent").on("mouseover",function(aW){simpleCalloutMouseOverByObject(aW,this,60000);}).on("mousemove",function(aW){simpleCalloutMouseMove(aW);}).on("mouseout",function(aW){simpleCalloutMouseOut(aW);});},j=function(aW){aW.parent().find("tr").show();aW.remove();},U=function(aW,a2,aY,aX){aY=aY<100?aY:100;var a1=aF("#progress_"+aW+"_"+a2);var a0=aF("#fileInput_"+aW+"_"+a2);var aZ=aF("input.htmlButton");a1.css("display",aX&&aY>=0?"inline-block":"none");a1.find(" .progress-bar").css("width",aY+"%");if(aX&&aY>=0){a0.parent(".customFUInput").addClass("hidden");a0.addClass("hidden");aZ.attr("disabled","disabled");}else{a0.parent(".customFUInput").removeClass("hidden");a0.removeClass("hidden");if(l===0){aZ.removeAttr("disabled");}}},at=function(aW){return ag.getFileUploadSettings(aW);},aA=function(aW,a0){var aY=at(aW);var aX=a0.lastIndexOf(".");if(aX<0){return -1;}var aZ=a0.substring(aX+1,a0.length).toLowerCase();if(aY.otherEnable&&(aJ(aW).indexOf(aZ)>=0||aJ(aW).indexOf("*/*")>=0)){return aY.fileSize;}if(aY.docEnable&&G.indexOf(aZ)>=0){return aY.docSize;}if(aY.imageEnable&&V.indexOf(aZ)>=0){return(1024*1024*100);}return aY.fileSize;},L=function(aW){var aX=at(aW);if(aX.imageEnable){return V;}return[];},aH=function(aW){var aX=at(aW);if(aX.docEnable){return G;}return[];},aJ=function(aW){var aX=at(aW);if(aX.otherEnable&&aX.fileExtensions){return aX.fileExtensions.replace(/\s|\./g,"").toLowerCase().split(",");}return[];},Z=function(aX){var aW=[];var aY=at(aX);if(aY.imageEnable){aW=aW.concat(V);}if(aY.docEnable){aW=aW.concat(G);}if(aY.otherEnable&&aY.fileExtensions){aW=aW.concat(aY.fileExtensions.replace(/\s|\./g,"").toLowerCase().split(","));}return aW;},a=function(aY,aW,aX){var aZ=aY.split(".").pop().toLowerCase();if(aF.inArray(aZ,aW)==-1){aX.allowed=false;aX.message=f.clientFileTypeNotAllowed.replace("{0}",aZ);}},aK=function(aW){if(aW<1024){return aW+" B";}if(aW<1024*1024){return(Math.floor(aW/1024))+" KB";}return(aW/(1024*1024)).toFixed(2)+" MB";},ab=function(aZ,aY,aW,aX){var a0=aA(aW,aY);if(a0>0&&aZ>(a0+a0*0.1)){aX.allowed=false;aX.message=aX.message.concat(f.clientFileSizeNotAllowed.replace("{0}",aK(aZ)).replace("{1}",aK(a0)));}},aS=function(aY,aW,a0,aX){if(aC()){var aZ=aF("#safariAccept_"+aW+"_"+a0).val();aY.prop("accept",aZ);}aY.change(function(){var a3=this.files?this.files[0]:null;if(a3==null){return;}var a2=at(aW);var a1={allowed:true,message:""};if(a2.allType||(!a2.allType&&a2.imageEnable&&a2.docEnable&&a2.otherEnable&&!a2.fileExtensions)){a1.allowed=true;}else{if(a2.otherEnable&&a2.fileExtensions&&a2.fileExtensions.indexOf("/")>=0){a1.allowed=true;}else{a(aF(this).val(),Z(aW),a1);}}if(a1.allowed){ab((a3.size||a3.fileSize),a3.name,aW,a1);}D[a0]=a1;if(aX&&D[a0].allowed==false){aY.val("");alert(D[a0].message);}});},aj=function(){aF.each(aF(".deleteFileBtn"),function(aY,a0){var a2=aF("#"+a0.id);var aW=a2.data("questionid");var a1=a2.data("answerid");var aZ=a2.data("respondentid");aF("#fileUploadContainerImg_"+aW+"_"+a1).on("mousedown",function(a3){a3.preventDefault();});var aX=aF("#fileInput_"+aW+"_"+a1);aS(aX,aW,a1,true);r(aW,aZ,a1);});},aU=function(){aF.each(aF(".deleteFileBtn"),function(a0,aZ){var aY=aF("#"+aZ.id);var aW=aY.data("questionid");var a2=aY.data("answerid");var a1=aY.data("respondentid");aF("#fileUploadContainerImg_"+aW+"_"+a2).on("mousedown",function(a5){a5.preventDefault();});var a3=aF("#fileInput_"+aW+"_"+a2);aS(a3,aW,a2,false);var aX="/servlet/survey.BackgroundFileUploader";if(!(typeof window.ksConfig==="undefined"||window.ksConfig==null)){aX=window.ksConfig.modulePath+aX+"?msig="+window.ksConfig.msig;}var a4=aF("<button/>").addClass("btn btn-primary").prop("disabled",true).text("Processing...").on("click",function(){var a6=aF(this),a5=a6.data();a6.off("click").text("Abort").on("click",function(){a6.remove();a5.abort();});a5.submit().always(function(){a6.remove();});});a3.fileupload({url:aX,dataType:"json",autoUpload:false,disableImageResize:false,previewMaxWidth:100,previewMaxHeight:100,previewCrop:false}).on("fileuploadadd",function(a8,a6){if(D[a2].allowed==false){alert(D[a2].message);return false;}var a9=document.theForm;var a5=function(){q(aW,a2,a6);l++;a6.submit();};var a7=function(){return window.pressedSave(true);};if(a9.respondentNewCreated&&a9.respondentNewCreated.value=="true"&&!window.resultHasBeenSaved&&window.pressedSave){aF.when(a7()).then(a5);}else{a5();}}).on("fileuploadfail",function(a6,a5){aF("#cancelUploadFile_"+aW+"_"+a2).addClass("hidden");aF("#FUIFileInputBox_"+aW+"_"+a2).removeClass("hidden");}).on("fileuploadprogressall",function(a6,a5){U(aW,a2,parseInt(a5.loaded/a5.total*100,10),true);}).on("fileuploaddone",function(a6,a5){aF.each(a5.result.files,function(bi,bc){l--;var bf=aF("#fileUploadContainerImg_"+aW+"_"+a2);var bb=aF("#fileUploadContainer_"+aW+"_"+a2);var bk=aF("#deleteUploadFile_"+aW+"_"+a2);var ba=aF("#downloadUploadFile_"+aW+"_"+a2);var a7=aF("#rotateUploadFile_"+aW+"_"+a2);var bl=aF("#markupUploadFile_"+aW+"_"+a2);var bh=aF("#cropUploadFile_"+aW+"_"+a2);var bg=aF("#answerValueUploadFile_"+aW+"_"+a2);var bm=aF("#answerValueUploadFileExtension_"+aW+"_"+a2);var a9=aF("#fileSizeUploadFile_"+aW+"_"+a2);var a8=aF("#AnswerTr"+aW+"_"+a2);var bj=aF("#FUIFooter_"+aW+"_"+a2);var be=aF("#fileInput_"+aW+"_"+a2);var bn=aF("#FUIFileInputBox_"+aW+"_"+a2);var bd=aF("#inputtextother"+aW+"_"+a2);if(bc.urlImagePreview){bf.on("mousedown",function(bo){bo.preventDefault();});bf.attr("src",bc.urlImagePreview);bf.one("load",function(){U(aW,a2,0,false);aF("#cancelUploadFile_"+aW+"_"+a2).addClass("hidden");aF("#uploadingFileName_"+aW+"_"+a2).addClass("hidden");var bu=Q(bc.fileName);var bq=aR(bc.fileName);var bo=" ("+bc.fileSize+")";bg.html(bu);bm.html(bq);a9.html(bo);var bt=bu+bq+bo;bg.attr("title",bt);bm.attr("title",bt);a9.attr("title",bt);if(bd.length>0){bd.val(bc.fileName);bd.data("link",bc.fileUrl);}else{bn.append(aF('<input type="hidden" name="other'+aW+"_"+a2+'" value="'+bc.fileName+'" data-link="'+bc.fileUrl+'" id="inputtextother'+aW+"_"+a2+'" class="inputUploadFile"/>'));}ba.attr("href",bc.fileUrl);ba.click(function(){alert(1);ba.focus();});bb.removeClass("hidden");a9.removeClass("hidden");a9.css("display","inline-block");bj.removeClass("hidden");ba.removeClass("hidden");var bs=at(aW);var br=bs.allType||bs.imageEnable;var bp=bc.isResizable&&bs.allowEditImage&&br;bf.data("isresizable",bc.isResizable);bf.data("showrotate",bc.isResizable);bf.data("showdelete",bc.isResizable);bf.data("showmarkup",bp);bf.data("showcrop",bp);bf.removeAttr("data-imagedrawing");if(bc.isResizable){a8.removeClass("isNotResizible");bb.removeClass("isNotResizible");a7.removeClass("hidden");bf.data("fileurl",bc.fileUrl);bf.removeData("originalurl");if(bp){bl.removeClass("hidden");bh.removeClass("hidden");}}else{a8.addClass("isNotResizible");bb.addClass("isNotResizible");a7.addClass("hidden");bl.addClass("hidden");bh.addClass("hidden");}bn.addClass("hidden");bk.data("hash",bc.hash);a7.data("hash",bc.hash);be.trigger("change");O(aF(bk),aW,a2);if(l==0&&window.pressedSave){window.pressedSave(true);}});}else{if(bc.error){U(aW,a2,0,false);aF("#cancelUploadFile_"+aW+"_"+a2).addClass("hidden");aF("#uploadingFileName_"+aW+"_"+a2).addClass("hidden");bb.addClass("hidden");bj.addClass("hidden");ba.addClass("hidden");a7.addClass("hidden");bn.removeClass("hidden");alert(bc.error);be.trigger("change");O(aF(bn),aW,a2);}}});}).on("fileuploadfail",function(bb,a9){l--;U(aW,a2,0,false);var a7=aF("#cancelUploadFile_"+aW+"_"+a2);var a6=aF("#fileUploadContainer_"+aW+"_"+a2);var bc=aF("#fileSizeUploadFile_"+aW+"_"+a2);var a8=aF("#fileInput_"+aW+"_"+a2);var ba=aF("#uploadingFileName_"+aW+"_"+a2);var a5=aF("#FUIFooter_"+aW+"_"+a2);a7.addClass("hidden");a6.addClass("hidden");bc.addClass("hidden");a5.addClass("hidden");ba.addClass("hidden");a8.removeClass("hidden");a8.trigger("change");O(aF(a8),aW,a2);});});},aM=function(a1,a3,a2,bj,bb,a8,a0,aX,bg,a6){l--;aF("#cancelUploadFile_"+a1+"_"+a3).addClass("hidden");aF("#uploadingFileName_"+a1+"_"+a3).addClass("hidden");var bn=aF("#fileUploadContainerImg_"+a1+"_"+a3);var bo=aF("#fileUploadContainer_"+a1+"_"+a3);var bl=aF("#deleteUploadFile_"+a1+"_"+a3);var bd=aF("#downloadUploadFile_"+a1+"_"+a3);var a4=aF("#rotateUploadFile_"+a1+"_"+a3);var ba=aF("#answerValueUploadFile_"+a1+"_"+a3);var a5=aF("#answerValueUploadFileExtension_"+a1+"_"+a3);var bk=aF("#fileSizeUploadFile_"+a1+"_"+a3);var a9=aF("#AnswerTr"+a1+"_"+a3);var a7=aF("#FUIFooter_"+a1+"_"+a3);var aZ=aF("#fileInput_"+a1+"_"+a3);var bi=aF("#FUIFileInputBox_"+a1+"_"+a3);var aW=aF("#inputtextother"+a1+"_"+a3);if(a2){bn.on("mousedown",function(bp){bp.preventDefault();});bn.attr("src",a2);var bf=Q(bj);var be=aR(bj);var bb=" ("+bb+")";ba.html(bf);a5.html(be);bk.html(bb);var bm=bf+be+bb;ba.attr("title",bm);a5.attr("title",bm);bk.attr("title",bm);aW.val(bj);aW.data("link",a8);bd.attr("href",a8);bo.removeClass("hidden");bk.removeClass("hidden");a7.removeClass("hidden");bd.removeClass("hidden");var bh=at(a1);var aY=bh.allType||bh.imageEnable;var bc=a0&&bh.allowEditImage&&aY;bn.data("isresizable",a0);bn.data("showrotate",a0);bn.data("showdelete",a0);bn.data("showmarkup",bc);bn.data("showcrop",bc);if(a0){a9.removeClass("isNotResizible");bo.removeClass("isNotResizible");a4.removeClass("hidden");bn.data("fileurl",a8);}else{a9.addClass("isNotResizible");bo.addClass("isNotResizible");a4.addClass("hidden");}bi.addClass("hidden");bl.data("hash",aX);a4.data("hash",aX);aZ.trigger("change");if(a6!=true){O(aF(bl),a1,a3);}if(l==0&&window.pressedSave){window.pressedSave(true);}}else{if(bg){bo.addClass("hidden");a7.addClass("hidden");bd.addClass("hidden");a4.addClass("hidden");bi.removeClass("hidden");alert(bg);aZ.trigger("change");O(aF(bi),a1,a3);}}},Q=function(aW){if(!aW){return"";}else{if(aW.lastIndexOf(".")==0){return"";}else{if(aW.lastIndexOf(".")==1){return aW.substring(0,aW.lastIndexOf("."));}else{if(aW.lastIndexOf(".")>1){return aW.substring(0,aW.lastIndexOf(".")-1);}else{return aW;}}}}},aR=function(aW){if(!aW){return"";}else{if(aW.lastIndexOf(".")==0){return aW;}else{if(aW.lastIndexOf(".")==1){return aW.substring(aW.lastIndexOf("."),aW.length);}else{if(aW.lastIndexOf(".")>1){return aW.substring(aW.lastIndexOf(".")-1,aW.length);}else{return"";}}}}},ao=function(){aF(document).ready(function(){if(aG!=undefined&&typeof aG==="object"){aF.extend(f,aG);}A();c();s();ad();w();H();N();m();if(!window.appRoot&&!(jQuery.browser.msie&&jQuery.browser.version<=9)){aU();}else{aj();}});},aC=function(){return aF.browser.safari&&!/chrome/.test(navigator.userAgent.toLowerCase());};ao();var J={SMALL_SCREEN_WIDTH:640,DEFAULT_TOP_PANEL_HEIGHT:100,SMALL_SCREEN_TOP_PANEL_HEIGHT:55,TOP_MARGIN:15,DEFAULT_TOOLBAR_HEIGHT:45,BOTTOM_MARGIN:20,LEFT_RIGHT_MARGINS:15*2,MIN_IMAGE_SIZE:25,DEBOUNCE_TIME:100};var R=(function(aW,a2){if(aW.length==0){return;}var aY=aW.get(0);var a1=aY.naturalWidth;var aZ=aY.naturalHeight;var aX=aZ/a1;var a0=B()/P();var a4=B();var a3=(aX<a0?P():"");aW.css({"max-height":a4,"max-width":a3,height:"",width:""});});var B=(function(){var aW=window.innerWidth>J.SMALL_SCREEN_WIDTH?J.DEFAULT_TOP_PANEL_HEIGHT:J.SMALL_SCREEN_TOP_PANEL_HEIGHT;return Math.max(window.innerHeight-aW-J.TOP_MARGIN-J.DEFAULT_TOOLBAR_HEIGHT-J.BOTTOM_MARGIN,J.MIN_IMAGE_SIZE);});var P=(function(){return Math.max(window.innerWidth-J.LEFT_RIGHT_MARGINS,J.MIN_IMAGE_SIZE);});var W=function(aZ){var aX;var a1=aF(".imageDrawingContainer");var aY=aF(a1).find("canvas").get(0);if(aZ!=undefined){aX=aZ;if(aY!=undefined){aF(aY).css({"max-width":aF(aX).width()+"px","max-height":aF(aX).height()+"px",width:aF(aX).width()+"px",height:aF(aX).height()+"px"});}if(window.appRoot!=undefined&&window.appRoot.majorVersion!=undefined&&window.appRoot.majorVersion==9){var a0=aF(aX).height();var aW=setInterval(function(){if(aF(aX).height()!=a0){aF(aX).css({"max-height":a0+"px"});}},1);setTimeout(function(){clearInterval(aW);},500);}}else{setTimeout(function(){var a3=aF(".imageDrawingContainer");aX=aF(a3).find("> img");var a4=aF(a3).width();var a2=aF(a3).height();aF(aX).css({"max-width":a4+"px","max-height":a2+"px",width:"",height:""});if(aY!=undefined){aF(aY).css({"max-width":aF(aX).width()+"px","max-height":aF(aX).height()+"px",width:aF(aX).width()+"px",height:aF(aX).height()+"px"});}},300);}};return{removeAttachedFile:x,removeAttachedFileByButton:aP,getRotateLink:n,getRemoveLink:aT,getFileUploadSettings:at,getImageExtensions:L,getDocExtensions:aH,getOtherExtensions:aJ,getAllowedFileExtensions:Z,convertSize:aK,checkExtensions:a,checkFileSize:ab,insertFileToDom:aM,updateUrl:K,alignImage:R,canvasResizer:W,limitImageDrawingSize:aL,isSafari:aC,deviceRotate:i,updateAttachedImage:ai,getTmpFileName:d,getPreviewImageWidth:ar,isEditAllowed:ah,getCurrentImageData:M,maxImageResolution:am};})(jQuery,window.fileUploadTranslations,window.fileuploadSettingsUtils,window.scrollFixModule,_);if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=FU_Utils;}