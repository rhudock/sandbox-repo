(function($){var _root=this;function replaceCheckAndRadio(){var inputs=document.getElementsByTagName("input");for(var i=0;i<inputs.length;i++){var inputElem=inputs[i];if(inputElem.type=="checkbox"||inputElem.type=="radio"){$('<i class="c_i"></i>').insertAfter(inputElem);}}}function replaceSelects(){var inputs=document.getElementsByTagName("select");for(var i=0;i<inputs.length;i++){var inputElem=inputs[i];inputElem.style.display="none";var ul=document.createElement("ul");if(inputElem.value!=null&&inputElem.value.length>0){for(var j=0;j<inputElem.options.length;j++){var option=inputElem.options[j];if(option.selected){var li=document.createElement("li");var optText=document.createTextNode(option.text);$('<i class="c_i"></i>').prependTo(li);li.appendChild(optText);ul.appendChild(li);}}}else{var li=document.createElement("li");var optText=document.createTextNode(_root.printerFriendlyTranslations.nothingSelected);li.appendChild(optText);ul.appendChild(li);}$(ul).addClass("selectedAnswerList");inputElem.parentElement.appendChild(ul);}}if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports={};module.exports.replaceCheckAndRadio=replaceCheckAndRadio;module.exports.replaceSelects=replaceSelects;}$(document).ready(function(){if(_root.vpIsRbr&&_root.vpIsRbr()){$("body").removeClass("isRBR").addClass("isRBR");replaceCheckAndRadio();replaceSelects();}});}).call(window,jQuery);(function(survData){var _root=this;_root.fileuploadSettingsUtils=[];_root.fileuploadSettingsUtils.getFileUploadSettings=function(QID){var queData=window.survData.fileUploadSettingsDTOMap[QID];if(queData==null){queData=window.survData.fileUploadSettingsDTOMap[-1];}return queData;};if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=_root.fileuploadSettingsUtils;}}).call(window,window.survData);var result_ROW_LOGIC=true;var isOnlyValidate_ROW_LOGIC=true;var errors_ROW_LOGIC="";var parser_ROW_LOGIC={isVoted_ROW_LOGIC:function(expression){var parseResult=this.parseLogicToken(expression);return validateRequiredElement(parseResult.questionId,parseResult.answerId,parseResult.columnNum,parseResult.matchResult,expression);},validateBySurveyStructure_ROW_LOGIC:function(expression){var parseResult=this.parseLogicToken(expression);return validateRequiredElementBySurveyStructure(parseResult.questionId,parseResult.answerId,parseResult.columnNum,parseResult.matchResult);},parseLogicToken:function(expression){var rowLogicRegExp=new RegExp("Q(\\d+)(?:.A(\\?|\\d+|\\*))?(?:.C(\\d+))?((<>|==)[^\\s]+)?");var resultParse={};var token=rowLogicRegExp.exec(expression);resultParse.questionId=token[1];resultParse.answerId=token[2];resultParse.columnNum=token[3];resultParse.matchResult=token[4];if(resultParse.questionId==""||isNaN(resultParse.questionId)){resultParse.questionId=null;}if(resultParse.answerId==""||isNaN(resultParse.answerId)){resultParse.answerId=null;}if(resultParse.columnNum==""||isNaN(resultParse.columnNum)){resultParse.columnNum=null;}if(resultParse.columnNum!=null&&resultParse.answerId!=null&&resultParse.columnNum.length>0){resultParse.columnNum=parseInt(resultParse.columnNum)-1;}return resultParse;}};function getErrors_ROW_LOGIC(){return errors_ROW_LOGIC;}function checkExpression_ROW_LOGIC(expression){if(isOnlyValidate_ROW_LOGIC){return parser_ROW_LOGIC.validateBySurveyStructure_ROW_LOGIC(expression);}else{return parser_ROW_LOGIC.isVoted_ROW_LOGIC(expression);}}function saveResult_ROW_LOGIC(expression){result_ROW_LOGIC=expression;}function parseExpressionLogic_ROW_LOGIC(expression,isOnlyValidate){isOnlyValidate_ROW_LOGIC=isOnlyValidate;result_ROW_LOGIC=true;var error_offsets=new Array();var error_lookaheads=new Array();var error_count=0;if((error_count=__ROW_LOGICparse(expression,error_offsets,error_lookaheads))>0){result_ROW_LOGIC=false;for(i=0;i<error_count;i++){errors_ROW_LOGIC+='Parse error near "'+expression.substr(error_offsets[i])+'", expecting "'+error_lookaheads[i].join()+'"'+"\n";}}return result_ROW_LOGIC;}var ROW_LOGIC_dbg_withparsetree=false;var ROW_LOGIC_dbg_withtrace=false;var ROW_LOGIC_dbg_withstepbystep=false;function __ROW_LOGICdbg_print(text){alert(text);}function __ROW_LOGICdbg_wait(){}function __ROW_LOGIClex(info){var state=0;var match=-1;var match_pos=0;var start=0;var pos=info.offset+1;do{pos--;state=0;match=-2;start=pos;if(info.src.length<=start){return 12;}do{switch(state){case 0:if((info.src.charCodeAt(pos)>=9&&info.src.charCodeAt(pos)<=10)||info.src.charCodeAt(pos)==13||info.src.charCodeAt(pos)==32){state=1;}else{if(info.src.charCodeAt(pos)==33){state=2;}else{if(info.src.charCodeAt(pos)==40){state=3;}else{if(info.src.charCodeAt(pos)==41){state=4;}else{if(info.src.charCodeAt(pos)==38){state=9;}else{if(info.src.charCodeAt(pos)==65||info.src.charCodeAt(pos)==97){state=11;}else{if(info.src.charCodeAt(pos)==78||info.src.charCodeAt(pos)==110){state=12;}else{if(info.src.charCodeAt(pos)==79||info.src.charCodeAt(pos)==111){state=13;}else{if(info.src.charCodeAt(pos)==81||info.src.charCodeAt(pos)==113){state=14;}else{if(info.src.charCodeAt(pos)==124){state=15;}else{state=-1;}}}}}}}}}}break;case 1:state=-1;match=1;match_pos=pos;break;case 2:state=-1;match=8;match_pos=pos;break;case 3:state=-1;match=2;match_pos=pos;break;case 4:state=-1;match=3;match_pos=pos;break;case 5:state=-1;match=7;match_pos=pos;break;case 6:state=-1;match=6;match_pos=pos;break;case 7:if((info.src.charCodeAt(pos)>=48&&info.src.charCodeAt(pos)<=57)){state=7;}else{if(info.src.charCodeAt(pos)==46){state=18;}else{if(info.src.charCodeAt(pos)==60){state=19;}else{if(info.src.charCodeAt(pos)==61){state=20;}else{state=-1;}}}}match=5;match_pos=pos;break;case 8:if((info.src.charCodeAt(pos)>=0&&info.src.charCodeAt(pos)<=31)||(info.src.charCodeAt(pos)>=33&&info.src.charCodeAt(pos)<=254)){state=8;}else{state=-1;}match=4;match_pos=pos;break;case 9:if(info.src.charCodeAt(pos)==38){state=5;}else{state=-1;}break;case 10:if((info.src.charCodeAt(pos)>=48&&info.src.charCodeAt(pos)<=57)){state=10;}else{if(info.src.charCodeAt(pos)==60){state=19;}else{if(info.src.charCodeAt(pos)==61){state=20;}else{state=-1;}}}match=5;match_pos=pos;break;case 11:if(info.src.charCodeAt(pos)==78||info.src.charCodeAt(pos)==110){state=16;}else{state=-1;}break;case 12:if(info.src.charCodeAt(pos)==79||info.src.charCodeAt(pos)==111){state=17;}else{state=-1;}break;case 13:if(info.src.charCodeAt(pos)==82||info.src.charCodeAt(pos)==114){state=6;}else{state=-1;}break;case 14:if((info.src.charCodeAt(pos)>=48&&info.src.charCodeAt(pos)<=57)){state=7;}else{state=-1;}break;case 15:if(info.src.charCodeAt(pos)==124){state=6;}else{state=-1;}break;case 16:if(info.src.charCodeAt(pos)==68||info.src.charCodeAt(pos)==100){state=5;}else{state=-1;}break;case 17:if(info.src.charCodeAt(pos)==84||info.src.charCodeAt(pos)==116){state=2;}else{state=-1;}break;case 18:if(info.src.charCodeAt(pos)==67||info.src.charCodeAt(pos)==99){state=21;}else{if(info.src.charCodeAt(pos)==65||info.src.charCodeAt(pos)==97){state=25;}else{state=-1;}}break;case 19:if(info.src.charCodeAt(pos)==62){state=22;}else{state=-1;}break;case 20:if(info.src.charCodeAt(pos)==61){state=22;}else{state=-1;}break;case 21:if((info.src.charCodeAt(pos)>=48&&info.src.charCodeAt(pos)<=57)){state=10;}else{state=-1;}break;case 22:if((info.src.charCodeAt(pos)>=0&&info.src.charCodeAt(pos)<=31)||(info.src.charCodeAt(pos)>=33&&info.src.charCodeAt(pos)<=254)){state=8;}else{state=-1;}break;case 23:if(info.src.charCodeAt(pos)==67||info.src.charCodeAt(pos)==99){state=21;}else{state=-1;}break;case 24:if(info.src.charCodeAt(pos)==60){state=19;}else{if(info.src.charCodeAt(pos)==61){state=20;}else{if(info.src.charCodeAt(pos)==46){state=23;}else{if((info.src.charCodeAt(pos)>=48&&info.src.charCodeAt(pos)<=57)){state=24;}else{state=-1;}}}}match=5;match_pos=pos;break;case 25:if((info.src.charCodeAt(pos)>=48&&info.src.charCodeAt(pos)<=57)){state=24;}else{state=-1;}break;}pos++;}while(state>-1);}while(1>-1&&match==1);if(match>-1){info.att=info.src.substr(start,match_pos-start);info.offset=match_pos;}else{info.att=new String();match=-1;}return match;}function __ROW_LOGICparse(src,err_off,err_la){var sstack=new Array();var vstack=new Array();var err_cnt=0;var act;var go;var la;var rval;var parseinfo=new Function("","var offset; var src; var att;");var info=new parseinfo();var treenode=new Function("","var sym; var att; var child;");var treenodes=new Array();var tree=new Array();var tmptree=null;var pop_tab=new Array(new Array(0,1),new Array(10,1),new Array(9,3),new Array(9,3),new Array(9,2),new Array(9,3),new Array(9,1),new Array(11,1),new Array(11,1));var act_tab=new Array(new Array(8,3,2,4,4,6,5,7),new Array(12,0),new Array(7,8,6,9,12,-1),new Array(8,3,2,4,4,6,5,7),new Array(8,3,2,4,4,6,5,7),new Array(12,-6,6,-6,7,-6,3,-6),new Array(12,-7,6,-7,7,-7,3,-7),new Array(12,-8,6,-8,7,-8,3,-8),new Array(8,3,2,4,4,6,5,7),new Array(8,3,2,4,4,6,5,7),new Array(7,-4,6,-4,12,-4,3,-4),new Array(7,8,6,9,3,14),new Array(7,8,6,-3,12,-3,3,-3),new Array(7,8,6,-2,12,-2,3,-2),new Array(12,-5,6,-5,7,-5,3,-5));var goto_tab=new Array(new Array(10,1,9,2,11,5),new Array(),new Array(),new Array(9,10,11,5),new Array(9,11,11,5),new Array(),new Array(),new Array(),new Array(9,12,11,5),new Array(9,13,11,5),new Array(),new Array(),new Array(),new Array(),new Array());var labels=new Array("p'","^","(",")","EXPRESSION_TEXT","EXPRESSION","OR","AND","NOT","expr","p","expr_complex","$");info.offset=0;info.src=src;info.att=new String();if(!err_off){err_off=new Array();}if(!err_la){err_la=new Array();}sstack.push(0);vstack.push(0);la=__ROW_LOGIClex(info);while(true){act=16;for(var i=0;i<act_tab[sstack[sstack.length-1]].length;i+=2){if(act_tab[sstack[sstack.length-1]][i]==la){act=act_tab[sstack[sstack.length-1]][i+1];break;}}if(ROW_LOGIC_dbg_withtrace&&sstack.length>0){__ROW_LOGICdbg_print("\nState "+sstack[sstack.length-1]+"\n"+"\tLookahead: "+labels[la]+' ("'+info.att+'")\n'+"\tAction: "+act+"\n"+'\tSource: "'+info.src.substr(info.offset,30)+((info.offset+30<info.src.length)?"...":"")+'"\n'+"\tStack: "+sstack.join()+"\n"+"\tValue stack: "+vstack.join()+"\n");if(ROW_LOGIC_dbg_withstepbystep){__ROW_LOGICdbg_wait();}}if(act==16){if(ROW_LOGIC_dbg_withtrace){__ROW_LOGICdbg_print("Error detected: There is no reduce or shift on the symbol "+labels[la]);}err_cnt++;err_off.push(info.offset-info.att.length);err_la.push(new Array());for(var i=0;i<act_tab[sstack[sstack.length-1]].length;i+=2){err_la[err_la.length-1].push(labels[act_tab[sstack[sstack.length-1]][i]]);}var rsstack=new Array();var rvstack=new Array();for(var i=0;i<sstack.length;i++){rsstack[i]=sstack[i];rvstack[i]=vstack[i];}while(act==16&&la!=12){if(ROW_LOGIC_dbg_withtrace){__ROW_LOGICdbg_print("\tError recovery\n"+"Current lookahead: "+labels[la]+" ("+info.att+")\n"+"Action: "+act+"\n\n");}if(la==-1){info.offset++;}while(act==16&&sstack.length>0){sstack.pop();vstack.pop();if(sstack.length==0){break;}act=16;for(var i=0;i<act_tab[sstack[sstack.length-1]].length;i+=2){if(act_tab[sstack[sstack.length-1]][i]==la){act=act_tab[sstack[sstack.length-1]][i+1];break;}}}if(act!=16){break;}for(var i=0;i<rsstack.length;i++){sstack.push(rsstack[i]);vstack.push(rvstack[i]);}la=__ROW_LOGIClex(info);}if(act==16){if(ROW_LOGIC_dbg_withtrace){__ROW_LOGICdbg_print("\tError recovery failed, terminating parse process...");}break;}if(ROW_LOGIC_dbg_withtrace){__ROW_LOGICdbg_print("\tError recovery succeeded, continuing");}}if(act>0){if(ROW_LOGIC_dbg_withparsetree){var node=new treenode();node.sym=labels[la];node.att=info.att;node.child=new Array();tree.push(treenodes.length);treenodes.push(node);}if(ROW_LOGIC_dbg_withtrace){__ROW_LOGICdbg_print("Shifting symbol: "+labels[la]+" ("+info.att+")");}sstack.push(act);vstack.push(info.att);la=__ROW_LOGIClex(info);if(ROW_LOGIC_dbg_withtrace){__ROW_LOGICdbg_print("\tNew lookahead symbol: "+labels[la]+" ("+info.att+")");}}else{act*=-1;if(ROW_LOGIC_dbg_withtrace){__ROW_LOGICdbg_print("Reducing by producution: "+act);}rval=void (0);if(ROW_LOGIC_dbg_withtrace){__ROW_LOGICdbg_print("\tPerforming semantic action...");}switch(act){case 0:rval=vstack[vstack.length-1];break;case 1:saveResult_ROW_LOGIC(vstack[vstack.length-1]);break;case 2:rval=vstack[vstack.length-3]||vstack[vstack.length-1];break;case 3:rval=vstack[vstack.length-3]&&vstack[vstack.length-1];break;case 4:rval=(isOnlyValidate_ROW_LOGIC?vstack[vstack.length-1]:!vstack[vstack.length-1]);break;case 5:rval=vstack[vstack.length-2];break;case 6:rval=checkExpression_ROW_LOGIC(vstack[vstack.length-1]);break;case 7:rval=vstack[vstack.length-1];break;case 8:rval=vstack[vstack.length-1];break;}if(ROW_LOGIC_dbg_withparsetree){tmptree=new Array();}if(ROW_LOGIC_dbg_withtrace){__ROW_LOGICdbg_print("\tPopping "+pop_tab[act][1]+" off the stack...");}for(var i=0;i<pop_tab[act][1];i++){if(ROW_LOGIC_dbg_withparsetree){tmptree.push(tree.pop());}sstack.pop();vstack.pop();}go=-1;for(var i=0;i<goto_tab[sstack[sstack.length-1]].length;i+=2){if(goto_tab[sstack[sstack.length-1]][i]==pop_tab[act][0]){go=goto_tab[sstack[sstack.length-1]][i+1];break;}}if(ROW_LOGIC_dbg_withparsetree){var node=new treenode();node.sym=labels[pop_tab[act][0]];node.att=new String();node.child=tmptree.reverse();tree.push(treenodes.length);treenodes.push(node);}if(act==0){break;}if(ROW_LOGIC_dbg_withtrace){__ROW_LOGICdbg_print("\tPushing non-terminal "+labels[pop_tab[act][0]]);}sstack.push(go);vstack.push(rval);}}if(ROW_LOGIC_dbg_withtrace){__ROW_LOGICdbg_print("\nParse complete.");}if(ROW_LOGIC_dbg_withparsetree){if(err_cnt==0){__ROW_LOGICdbg_print("\n\n--- Parse tree ---");__ROW_LOGICdbg_parsetree(0,treenodes,tree);}else{__ROW_LOGICdbg_print("\n\nParse tree cannot be viewed. There where parse errors.");}}return err_cnt;}function __ROW_LOGICdbg_parsetree(indent,nodes,tree){var str=new String();for(var i=0;i<tree.length;i++){str="";for(var j=indent;j>0;j--){str+="\t";}str+=nodes[tree[i]].sym;if(nodes[tree[i]].att!=""){str+=" >"+nodes[tree[i]].att+"<";}__ROW_LOGICdbg_print(str);if(nodes[tree[i]].child.length>0){__ROW_LOGICdbg_parsetree(indent+1,nodes,nodes[tree[i]].child);}}}(function($){var _root=this;var eventsModule=function(window,$,survData){var eventsModule={};var eventsByQuestion={};var eventsForAllItems=[];eventsModule.eventsByQuestion=eventsByQuestion;eventsModule.eventsForAllItems=eventsForAllItems;var idPatterns=[/^RC(\d+)_(\d+)$/i,/^inputtextother(\d+)_(\d+)$/i,/^lookupFinalSelect_(\d+)$/i,/^selectR(\d+)$/i,/^R(\d+)_(\d+)_(\d+)$/i,/^(?:inputtext|select)other(\d+)_(\d+)_(?:(?:radio|check)?(\d+))$/i,/^fileInput_(\d+)_(\d+)$/i,/^RC(\d+)_\d+_\d+_\d+$/i];var patternsLength=idPatterns.length;var globalOnChange=function(event,data){var target=event.target;if(target){setTimeout(function(){eventsModule.triggerByElement(target,data);if(window.oneTouchScript){eventsModule.callOneTouchScript(target);}},0);}};if($.browser.msie&&$.browser.version<=8){$(document).on("change",globalOnChange);}else{document.onchange=globalOnChange;}eventsModule.triggerByElement=function(element,eventData){var dataElement=eventsModule.getDataByElement(element);if(dataElement){eventsModule.triggerEvent(dataElement.questionId,dataElement.answerId,dataElement.columnId,null,eventData);}};eventsModule.callOneTouchScript=function(element){var dataElement=eventsModule.getDataByElement(element);if(dataElement&&dataElement.answerId){var funcName="funcRC"+dataElement.answerId;if(window[funcName]&&typeof window[funcName]=="function"){window[funcName]();}}};eventsModule.getDataByElement=function(element){if(!element.id){return null;}for(var i=0;i<patternsLength;i++){var patternId=idPatterns[i];var parsed=patternId.exec(element.id);if(parsed){var queId=parsed[1];var ansId=null;if(parsed.length>2){ansId=parsed[2];}var columnId=null;if(parsed.length>3){var queData=window.votingSubmitModule.survData.questionsMap[queId];if(queData==null){if(logOffline){logOffline.info("getDataByElement failed queData == null! QID: "+queId);}return null;}var colNum=parsed[3];columnId=queData.columnsSorted[colNum];}return{questionId:queId,answerId:ansId,columnId:columnId};}}return null;};eventsModule.addEventHandlerToAllItems=function(handler){eventsForAllItems.push({handlerToRun:handler,key:"byAll"+(eventsForAllItems.length+1)});};eventsModule.addEventHandlerToManyTokens=function(tokens,handler){_.each(tokens,function(token){eventsModule.addEventHandler(token.questionId,token.answerId,token.columnId,handler);});};eventsModule.addEventHandler=function(questionId,answerIdParam,columnIdParam,handler){var byQuestion=eventsByQuestion[questionId];if(byQuestion==null){byQuestion={};byQuestion.all=[];byQuestion.AC={};eventsByQuestion[questionId]=byQuestion;}var eventHandler={handlerToRun:handler,key:"byQue"+questionId+"_"+(byQuestion.all.length+1)};byQuestion.all.push(eventHandler);var answerId=answerIdParam?answerIdParam:null;var columnId=columnIdParam?columnIdParam:null;var queData=survData.questionsMap[questionId];if(queData==null){if(window.logOffline){logOffline.info("eventsModule.addEventHandler failed queData == null! QID: "+questionId);}return false;}for(var i=0;i<queData.answersSorted.length;i++){var currentAnsId=queData.answersSorted[i];if(answerId&&answerId!=currentAnsId){continue;}var columnsCount=queData.columnsSorted&&queData.columnsSorted.length?queData.columnsSorted.length:1;for(var y=0;y<columnsCount;y++){var currentColId=queData.columnsSorted?queData.columnsSorted[y]:null;if(columnId&&columnId!=currentColId){continue;}var key=(""+currentAnsId+"_"+currentColId);var forAnswerColumn=byQuestion.AC[key];if(!forAnswerColumn){byQuestion.AC[key]=forAnswerColumn=[];}forAnswerColumn.push(eventHandler);}}};var _pushToRun=function(handler,triggerScope,eventData){var alreadyRun=triggerScope.handlersAlreadyRun[handler.key];if(alreadyRun){return false;}triggerScope.handlersAlreadyRun[handler.key]=true;var loopInitiator;if(triggerScope.loopInitiatorParam){loopInitiator=triggerScope.loopInitiatorParam;}else{loopInitiator={};loopInitiator[handler.key]=0;}var loopCount=loopInitiator[handler.key]||0;if(loopCount>0){window.logOffline.error("Loop calculation detected! questionId: "+triggerScope.questionId+", answerId: "+triggerScope.answerId+", columnId: "+triggerScope.columnId+", handler: "+handler+", handlerKey: "+handler.key);return true;}loopInitiator[handler.key]=loopCount+1;handler.handlerToRun(loopInitiator,eventData);return true;};var _runHandlers=function(handlersList,triggerScope,eventData){if(!handlersList){return false;}for(var i=0;i<handlersList.length;i++){var handlerToRun=handlersList[i];if(handlerToRun){_pushToRun(handlerToRun,triggerScope,eventData);}}return false;};eventsModule.triggerEvent=function(questionId,answerId,columnId,loopInitiatorParam,eventData){var handlersAlreadyRun={};var triggerScope={};triggerScope.questionId=questionId;triggerScope.answerId=answerId;triggerScope.columnId=columnId;triggerScope.handlersAlreadyRun=handlersAlreadyRun;triggerScope.loopInitiatorParam=loopInitiatorParam;var byQuestion=eventsByQuestion[questionId];if(byQuestion){if(answerId==null&&columnId==null){_runHandlers(byQuestion.all,triggerScope,eventData);}else{var queData=survData.questionsMap[questionId];if(queData==null){if(window.logOffline){logOffline.info("eventsModule.triggerEvent failed queData == null! QID: "+questionId);}return false;}for(var i=0;i<queData.answersSorted.length;i++){var currentAnsId=queData.answersSorted[i];if(answerId&&answerId!=currentAnsId){continue;}var columnsCount=queData.columnsSorted&&queData.columnsSorted.length?queData.columnsSorted.length:1;for(var y=0;y<columnsCount;y++){var currentColId=queData.columnsSorted?queData.columnsSorted[y]:null;if(columnId&&columnId!=currentColId){continue;}var key=(""+currentAnsId+"_"+currentColId);_runHandlers(byQuestion.AC[key],triggerScope,eventData);}}}}if(loopInitiatorParam==null){_runHandlers(eventsForAllItems,triggerScope,eventData);}return false;};return eventsModule;};_root.eventsModuleProvider=(function(window,$){var eventsModuleInstance=null;return{resetModule:function(){eventsModuleInstance=null;},getModule:function(create){if(create===true){if(!eventsModuleInstance){eventsModuleInstance=eventsModule(window,$,window.survData);}else{throw new Error("Events module already initialized");}}if(!eventsModuleInstance){throw new Error("Events module not initialized");}return eventsModuleInstance;}};})(window,$);if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=_root.eventsModuleProvider;window.eventsModuleProvider=_root.eventsModuleProvider;}}).call(this,jQuery);var votingWaitModule=(function(window,$,votingSubmitModule,eventsModuleProvider,ksAPI){var module={};var waitingQID=[];var waitingSV=[];var timeout=60000;module.startWait=0;module.addWaitingQuestion=function(questionId){var qidStr="_"+questionId;for(var i=0;i<waitingQID.length;i++){if(waitingQID[i]===qidStr){return false;}}waitingQID.push(qidStr);return true;};module.removeWaitingQuestion=function(questionId){var qidStr="_"+questionId;for(var i=0;i<waitingQID.length;i++){if(waitingQID[i]===qidStr){waitingQID.splice(i,1);return true;}}return false;};function _getSetValueId(questionId,answerId,columnId){return"sv_"+questionId+(answerId?"_"+answerId:"")+(columnId?"_"+columnId:"");}module.addWaitingSetValue=function(questionId,answerId,columnId){var qidStr=_getSetValueId(questionId,answerId,columnId);for(var i=0;i<waitingSV.length;i++){if(waitingSV[i]===qidStr){return false;}}waitingSV.push(qidStr);return true;};module.removeWaitingSetValue=function(questionId,answerId,columnId){var qidStr=_getSetValueId(questionId,answerId,columnId);for(var i=0;i<waitingSV.length;i++){if(waitingSV[i]===qidStr){waitingSV.splice(i,1);return true;}}return false;};module.isEmpty=function(){return(waitingQID.length==0);};module.isEmptyAll=function(){return(waitingQID.length==0&&waitingSV.length==0);};module.getWaitingQuestions=function(){return waitingQID;};module.getWaitingQuestionById=function(questionId){for(var i=0;i<waitingQID.length;i++){if(waitingQID[i]==="_"+questionId){return true;}}return false;};return module;})(window,jQuery,window.votingSubmitModule,window.eventsModuleProvider,window.ksAPI);if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=votingWaitModule;window.votingWaitModule=votingWaitModule;}var votingResultsModule=(function(window,$,votingSubmitModule,eventsModuleProvider,ksAPI,votingWaitModule){var module={};module.ResultCriteria=function(){this.includePickOneComment=true;this.fileUploadAsLink=false;this.fileUploadAsLinkedAnswers=false;this.matrixDropdownAsIndex=false;};module.findElementById=function(formSuffix,id){return _findElementById(formSuffix,id);};function _findElementById(formSuffix,id){var idElem=""+id+formSuffix;var elementById=document.getElementById(idElem);if(elementById==null){elementById=document.getElementById("hidden_"+idElem);}return $(elementById);}module.getVotingResult=function(QID,AID,columnNum,criteriaParam){var parentForm;var formSuffix="";if(window._current_form==null){parentForm=window.getFormFromCache("theForm");}else{parentForm=$(window._current_form);formSuffix="_f"+window._current_form.name.substring(7);}var queData=window.survData.questionsMap[QID];if(queData==null){return null;}var criteria=criteriaParam;if(!criteria){criteria=new module.ResultCriteria();}switch(queData.type){case"PICK_ONE_NO_OTHER":case"PICK_ONE_WITH_OTHER":case"PICK_ONE_WITH_COMMENT":return module._getResultForPickone(formSuffix,queData,AID,criteria);case"CHECKALL_NO_OTHER":case"CHECKALL_WITH_OTHER":return module._getResultForCheckAll(formSuffix,queData,AID,criteria);case"DROPDOWN":case"LISTBOX":return module._getResultForDropdownListbox(formSuffix,queData,AID,criteria);case"SINGLE_LINE":case"MULTI_LINE":case"NUMERIC_ALLOCATION":return module._getResultForSingleline(formSuffix,queData,AID,criteria);case"RANK_GRID_DEPENDENT":case"RANK_GRID_INDEPENDENT":return module._getResultForRateDiff(formSuffix,queData,AID,columnNum,criteria);case"COMPARE":return module._getResultForCompare(formSuffix,queData,AID,criteria);case"MATRIX_3D":return module._getResultForMatrix(formSuffix,queData,AID,columnNum,criteria);case"LOOKUP":case"MULTIPLE_LOOKUP":return window.LQ_Core.getResultAsText(QID,AID);case"UPLOAD_FILE":return module._getResultForFileUpload(parentForm,formSuffix,queData,AID,criteria);case"HEADER":case"INTERNAL_NOTES":default:return null;}return null;};module._getResultForPickone=function(formSuffix,queDataParam,answerIdParam,criteria){var radioResult=null;for(var i=0;i<queDataParam.answersSorted.length;i++){var ansData=queDataParam.answers[queDataParam.answersSorted[i]];if(answerIdParam==null||ansData.answerId==answerIdParam){if(ansData.type=="ATYPE_RADIO"){var elemRadio=_findElementById(formSuffix,"RC"+queDataParam.questionId+"_"+ansData.answerId);if(elemRadio.attr("type")=="hidden"||elemRadio.is(":checked")){radioResult=ansData.nameOriginal;if(queDataParam.type!="PICK_ONE_WITH_COMMENT"||answerIdParam!=null){return radioResult;}}}else{if(ansData.type=="ATYPE_SINGLE_LINE"){var elemComment=_findElementById(formSuffix,"inputtextother"+queDataParam.questionId+"_"+ansData.answerId);var comment=elemComment.val();if(comment!=null&&comment.length>0){if(radioResult==null){return comment;}else{return radioResult+(criteria.includePickOneComment?(", "+comment):"");}}else{return radioResult;}}else{if(ansData.type=="ATYPE_SINGLE_LINE_RADIO"){var elemRadio=_findElementById(formSuffix,"RC"+queDataParam.questionId+"_"+ansData.answerId);if(elemRadio.attr("type")=="hidden"||elemRadio.is(":checked")){var elemOther=_findElementById(formSuffix,"inputtextother"+queDataParam.questionId+"_"+ansData.answerId);return elemOther.length>0?elemOther.val():"";}}}}}}return null;};module._getResultForCheckAll=function(formSuffix,queDataParam,answerIdParam,criteria){var checkallResult=null;for(var i=0;i<queDataParam.answersSorted.length;i++){var ansData=queDataParam.answers[queDataParam.answersSorted[i]];if(answerIdParam==null||ansData.answerId==answerIdParam){var elemRadio=_findElementById(formSuffix,"RC"+queDataParam.questionId+"_"+ansData.answerId);if(elemRadio.attr("type")=="hidden"||elemRadio.is(":checked")){if(checkallResult==null){checkallResult="";}if(ansData.type=="ATYPE_SINGLE_LINE_CHECKBOX"){var elemOther=_findElementById(formSuffix,"inputtextother"+queDataParam.questionId+"_"+ansData.answerId);var otherVal=elemOther.val();if(otherVal==null){otherVal="";}checkallResult+=otherVal+", ";}else{checkallResult+=ansData.nameOriginal+", ";}if(answerIdParam!=null){break;}}}}if(checkallResult!=null&&checkallResult.length>0){return checkallResult.substring(0,checkallResult.length-2);}return checkallResult;};module._getResultForDropdownListbox=function(formSuffix,queDataParam,answerIdParam,criteria){var combinedResult=null;for(var i=0;i<queDataParam.answersSorted.length;i++){var ansId=queDataParam.answersSorted[i];if(answerIdParam==null||ansId==answerIdParam){var $elem=_findElementById(formSuffix,"AnswerOption"+queDataParam.questionId+"_"+ansId);var selectedOptionsByQuestionId=ksAPI.getPreviouslySelectedOptions(queDataParam.questionId);if(($elem.length&&($elem.attr("type")=="hidden"||$elem.is(":checked")))||selectedOptionsByQuestionId&&selectedOptionsByQuestionId[ansId]){if(combinedResult==null){combinedResult="";}combinedResult+=(queDataParam.answers[ansId].nameOriginal+", ");}}}if(combinedResult!=null&&combinedResult.length>0){return combinedResult.substring(0,combinedResult.length-2);}return combinedResult;};module._getResultForSingleline=function(formSuffix,queDataParam,answerIdParam,criteria){var combinedResult=null;for(var i=0;i<queDataParam.answersSorted.length;i++){var ansId=queDataParam.answersSorted[i];if(answerIdParam==null||ansId==answerIdParam){var $elem=_findElementById(formSuffix,"inputtextother"+queDataParam.questionId+"_"+ansId);var valOther=$elem.val();if(valOther!=null&&valOther!=""){if(combinedResult==null){combinedResult="";}combinedResult+=(valOther+", ");}}}if(combinedResult!=null&&combinedResult.length>0){return combinedResult.substring(0,combinedResult.length-2);}return combinedResult;};module._getResultForRateDiff=function(formSuffix,queDataParam,answerIdParam,columnNumOrIdParam,criteria){var columnId=columnNumOrIdParam;if(columnNumOrIdParam!=null&&answerIdParam!=null){columnId=queDataParam.columnsSorted[columnNumOrIdParam];}var answered="";for(var i=0;i<queDataParam.answersSorted.length;i++){var ansId=queDataParam.answersSorted[i];if(answerIdParam==null||ansId==answerIdParam){for(var k=0;k<queDataParam.columnsSorted.length;k++){var colId=queDataParam.columnsSorted[k];if(columnId==null||columnId==colId){var elem=_findElementById(formSuffix,"R"+queDataParam.questionId+"_"+ansId+"_"+k);if(elem.attr("type")=="hidden"||elem.is(":checked")){var result="";if(answerIdParam){result=queDataParam.columns[colId].nameOriginal;}else{result=queDataParam.answers[ansId].nameOriginal;}answered+=result+", ";}}}}}if(answered.length>0){return answered.substring(0,answered.length-2);}return null;};module._getResultForCompare=function(formSuffix,queDataParam,answerIdParam,criteria){var compareAnsweredIds={};for(var i=0;i<queDataParam.answersSorted.length;i++){var ansLeftId=queDataParam.answersSorted[i];for(var k=0;k<queDataParam.answersSorted.length;k++){var ansRightId=queDataParam.answersSorted[k];var breakAndReturnValue=null;$.each(["RC"+queDataParam.questionId+"_"+ansLeftId+"_"+ansRightId+"_"+ansLeftId,"RC"+queDataParam.questionId+"_"+ansLeftId+"_"+ansRightId+"_"+ansRightId],function(){var elem=_findElementById(formSuffix,""+this);if(elem.attr("type")!="hidden"){elem=elem.filter(":checked");}if(elem.length>0&&answerIdParam!=null&&elem.val()==answerIdParam){breakAndReturnValue=queDataParam.answers[elem.val()].nameOriginal;return false;}if(elem.length>0&&(answerIdParam==null||elem.val()==answerIdParam)){compareAnsweredIds[elem.val()]=true;}});if(breakAndReturnValue!=null){return breakAndReturnValue;}}}var resultCompare="";for(var ii=0;ii<queDataParam.answersSorted.length;ii++){var sortedAnsIs=queDataParam.answersSorted[ii];if(compareAnsweredIds[sortedAnsIs]){resultCompare+=(queDataParam.answers[sortedAnsIs].nameOriginal+", ");}}if(resultCompare.length>0){resultCompare=resultCompare.substring(0,resultCompare.length-2);return resultCompare;}return null;};module._getResultForMatrix=function(formSuffix,queDataParam,answerIdParam,columnNumOrIdParam,criteria){var columnId=columnNumOrIdParam;if(columnNumOrIdParam!=null&&answerIdParam!=null){columnId=queDataParam.columnsSorted[columnNumOrIdParam];}var result=null;for(var i=0;i<queDataParam.answersSorted.length;i++){var ansId=queDataParam.answersSorted[i];if(answerIdParam==null||ansId==answerIdParam){var ansData=queDataParam.answers[ansId];for(var k=0;k<queDataParam.columnsSorted.length;k++){var colId=queDataParam.columnsSorted[k];if(columnId==null||colId==columnId){var column=queDataParam.columns[colId];if(column.type=="EDIT_RADIO"){var elem=_findElementById(formSuffix,"inputtextother"+queDataParam.questionId+"_"+ansId+"_radio"+k);if(elem.attr("type")=="hidden"||elem.is(":checked")){if(result==null){result="";}if(answerIdParam==null&&columnNumOrIdParam==null){result+=ansData.nameOriginal+", ";break;}else{if(answerIdParam!=null&&columnNumOrIdParam==null){result+=column.nameOriginal+", ";}else{if(answerIdParam==null&&columnNumOrIdParam!=null){result+=ansData.nameOriginal+", ";}else{if(answerIdParam!=null&&columnNumOrIdParam!=null){return column.nameOriginal;}}}}}}else{if(column.type=="EDIT_CHECKBOX"){var elem=_findElementById(formSuffix,"inputtextother"+queDataParam.questionId+"_"+ansId+"_check"+k);if(elem.attr("type")=="hidden"||elem.is(":checked")){if(result==null){result="";}if(answerIdParam==null&&columnNumOrIdParam==null){result+=ansData.nameOriginal+", ";break;}else{if(answerIdParam!=null&&columnNumOrIdParam==null){}else{if(answerIdParam==null&&columnNumOrIdParam!=null){result+=ansData.nameOriginal+", ";}else{if(answerIdParam!=null&&columnNumOrIdParam!=null){return column.nameOriginal;}}}}}}else{if(column.type=="EDIT_TEXT"){var elem=_findElementById(formSuffix,"inputtextother"+queDataParam.questionId+"_"+ansId+"_"+k);var valText=elem.val();if(valText!=null&&valText!=""){if(result==null){result="";}if(answerIdParam==null&&columnNumOrIdParam==null){result+=ansData.nameOriginal+", ";break;}else{if(answerIdParam!=null&&columnNumOrIdParam==null){}else{if(answerIdParam==null&&columnNumOrIdParam!=null){result+=valText+", ";}else{if(answerIdParam!=null&&columnNumOrIdParam!=null){return valText;}}}}}}else{if(column.type=="EDIT_DROPDOWN"){var elem=_findElementById(formSuffix,"selectother"+queDataParam.questionId+"_"+ansId+"_"+k);if(elem.length>0&&elem.val().length>0){if(result==null){result="";}var option=column.optionsByVal[elem.val()];if(answerIdParam==null&&columnNumOrIdParam==null){result+=ansData.nameOriginal+", ";break;}else{if(answerIdParam!=null&&columnNumOrIdParam==null){}else{var optionResult=criteria&&criteria.matrixDropdownAsIndex?(""+option.val):option.text;if(answerIdParam==null&&columnNumOrIdParam!=null){result+=optionResult+", ";}else{if(answerIdParam!=null&&columnNumOrIdParam!=null){return optionResult;}}}}}}}}}}}}}if(result!=null&&result.length>0){return result.substring(0,result.length-2);}return result;};module._isOfflineVoting=function(){return votingSubmitModule.isOfflineVoting();};module._getResultForFileUpload=function(parentForm,formSuffix,queDataParam,answerIdParam,criteria){var values="";if(module._isOfflineVoting()&&criteria&&(criteria.fileUploadAsLinkedAnswers||criteria.fileUploadAsLink)){return values;}for(var i=0;i<queDataParam.answersSorted.length;i++){var ansId=queDataParam.answersSorted[i];if(answerIdParam==null||answerIdParam==ansId){var elemOther=parentForm.find("#fileInput_"+queDataParam.questionId+"_"+ansId);var valOther=elemOther.val();if(valOther==null||valOther==""){elemOther=_findElementById(formSuffix,"inputtextother"+queDataParam.questionId+"_"+ansId);valOther=elemOther.val();}if(valOther!=null&&valOther!=""){valOther=valOther.split("/").pop().split("\\").pop();var linkRelative=elemOther.data("link");var host=module._getHost();if(criteria&&criteria.fileUploadAsLinkedAnswers){valOther="<a href='"+host+linkRelative+"' target='_blank'>"+valOther+"</a>";}else{if(criteria&&criteria.fileUploadAsLink){valOther=host+linkRelative;}}values+=(valOther+", ");}}}if(values.length>0){return values.substring(0,values.length-2);}return null;};module._getHost=function(){if(!window.location.origin){return window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");}return window.location.origin;};var allQIDsInputMap={};var alreadyAddedQIdsMap={};function removeHiddenResult(parentForm,elem,queData){var formName=$(parentForm).attr("name");var allQIDsInput=allQIDsInputMap[formName];if(!allQIDsInput){allQIDsInput=parentForm.find("input[name=ALL_QIDS]");allQIDsInputMap[formName]=allQIDsInput;}if(!votingSubmitModule.isOfflineVoting()&&allQIDsInput.length){var alreadyAddedQIds=alreadyAddedQIdsMap[formName];if(!alreadyAddedQIds){alreadyAddedQIds={};alreadyAddedQIdsMap[formName]=alreadyAddedQIds;}if(!alreadyAddedQIds[queData.questionId]){alreadyAddedQIds[queData.questionId]=true;var allQIDsVal=allQIDsInput.val();var qId=""+queData.questionId;if(allQIDsVal.length){qId+=",";}allQIDsInput.val(qId+allQIDsVal);}}if(elem){elem.remove();}}module.setVotingResult=function(QID,AID,columnNum,value,reset,loopInitiator,triggerChanges,usingLookupFilter){var parentForm;var formSuffix="";if(window._current_form==null){parentForm=window.getFormFromCache("theForm");}else{parentForm=$(window._current_form);formSuffix="_f"+window._current_form.name.substring(7);}var queData=window.survData.questionsMap[QID];if(queData==null){if(window.logOffline){window.logOffline.info("setVotingResult failed queData == null! QID: "+QID+", AID: "+AID+", columnNum: "+columnNum);}return false;}var ansData=null;if(AID!=null){ansData=queData.answers[AID];}var columnData=null;if(columnNum!=null){columnData=queData.columns[columnNum];if(!columnData){columnData=queData.columns[queData.columnsSorted[columnNum-1]];}}switch(queData.type){case"PICK_ONE_NO_OTHER":case"PICK_ONE_WITH_OTHER":case"PICK_ONE_WITH_COMMENT":case"CHECKALL_NO_OTHER":case"CHECKALL_WITH_OTHER":module._setResultForPickone(parentForm,queData,ansData,columnNum,value,reset,loopInitiator,triggerChanges);break;case"DROPDOWN":case"LISTBOX":module._setResultForDropdownListbox(parentForm,queData,ansData,reset,loopInitiator,triggerChanges,queData.type=="DROPDOWN");break;case"SINGLE_LINE":case"NUMERIC_ALLOCATION":case"MULTI_LINE":module._setResultForSingleline(parentForm,queData,ansData,value,reset,loopInitiator,triggerChanges);break;case"LOOKUP":module._setResultForLookup(queData,value,reset,loopInitiator,triggerChanges,(usingLookupFilter?true:false));break;case"MULTIPLE_LOOKUP":module._setResultForMultiLookup(parentForm,queData,value,reset,loopInitiator,triggerChanges,(usingLookupFilter?true:false));break;case"UPLOAD_FILE":module._setResultForFileUpload(queData,ansData,reset,loopInitiator,triggerChanges);break;case"RANK_GRID_DEPENDENT":case"RANK_GRID_INDEPENDENT":module._setResultForRateDiff(parentForm,queData,ansData,columnData,reset,loopInitiator,triggerChanges);break;case"COMPARE":module._setResultForCompareOne(parentForm,queData,ansData,reset,loopInitiator,triggerChanges);break;case"MATRIX_3D":module._setResultForMatrix(parentForm,queData,ansData,columnData,value,reset,loopInitiator,triggerChanges);break;case"HEADER":case"INTERNAL_NOTES":}};module._setResultForPickone=function(parentForm,queData,ansData,columnNum,value,reset,loopInitiator,triggerChanges){if(ansData){if(window.mobileFriendlyControls&&(queData.type==="PICK_ONE_NO_OTHER"||queData.type==="PICK_ONE_WITH_OTHER"||queData.type==="PICK_ONE_WITH_COMMENT")){window.mobileFriendlyControls.checker(parentForm.find("input[name=R"+queData.questionId+"]"),false);}var elem=parentForm.find("input[name=R"+queData.questionId+"]").filter("input[value="+ansData.answerId+"]");if(!elem.length&&ansData.type!="ATYPE_SINGLE_LINE"){if(!reset&&queData.type.indexOf("PICK_ONE")==0){parentForm.find("input[name=R"+queData.questionId+"]").remove();if(queData.type=="PICK_ONE_WITH_OTHER"){for(var i=0;i<queData.answersSorted.length;i++){var curAns=queData.answers[queData.answersSorted[i]];if(curAns.type=="ATYPE_SINGLE_LINE_RADIO"){var elemOther=parentForm.find("input[name=other"+queData.questionId+"_"+curAns.answerId+"]");elemOther.remove();}}}}var elemIdNew="RC"+queData.questionId+"_"+ansData.answerId;elem=$("<input type='hidden' name='R"+queData.questionId+"' id='"+elemIdNew+"'>").appendTo(parentForm);}if(elem.attr("type")=="hidden"){if(reset){removeHiddenResult(parentForm,elem,queData);}else{elem.val(ansData.answerId);}}else{elem.prop("checked",!reset);elem.data("tallinn",!reset);if(window.mobileFriendlyControls){window.mobileFriendlyControls.checker(elem,!reset);}}if(ansData.type=="ATYPE_SINGLE_LINE_RADIO"||ansData.type=="ATYPE_SINGLE_LINE"||ansData.type=="ATYPE_SINGLE_LINE_CHECKBOX"){var elemText=parentForm.find("input[name=other"+queData.questionId+"_"+ansData.answerId+"]");if(!elemText.length){elemText=$("<input type='hidden' name='other"+queData.questionId+"_"+ansData.answerId+"' id='inputtextother"+queData.questionId+"_"+ansData.answerId+"'>").appendTo(parentForm);}if(elemText.attr("type")=="hidden"){if(reset){removeHiddenResult(parentForm,elemText,queData);}}elemText.val(reset?"":value);}var triggerAnswerId=null;if(queData.type=="CHECKALL_NO_OTHER"||queData.type=="CHECKALL_WITH_OTHER"){triggerAnswerId=ansData.answerId;}if(triggerChanges!=false){eventsModuleProvider.getModule().triggerEvent(queData.questionId,triggerAnswerId,null,loopInitiator);}}else{if(reset){var elem=parentForm.find("input[name=R"+queData.questionId+"]");if(elem.attr("type")=="hidden"){removeHiddenResult(parentForm,elem,queData);}else{elem.prop("checked",false);elem.data("tallinn",!reset);if(window.mobileFriendlyControls){window.mobileFriendlyControls.checker(elem,false);}}for(var i=0;i<queData.answersSorted.length;i++){var ans=queData.answers[queData.answersSorted[i]];if(ans.type=="ATYPE_SINGLE_LINE_RADIO"||ans.type=="ATYPE_SINGLE_LINE"||ans.type=="ATYPE_SINGLE_LINE_CHECKBOX"){var elemText=parentForm.find("input[name=other"+queData.questionId+"_"+ans.answerId+"]");if(elemText.attr("type")=="hidden"){removeHiddenResult(parentForm,elemText,queData);}else{elemText.val("");}}}if(triggerChanges!=false){eventsModuleProvider.getModule().triggerEvent(queData.questionId,null,null,loopInitiator);}}}};module._setResultForDropdownListbox=function(parentForm,queData,ansData,reset,loopInitiator,triggerChanges,dropdown){var elemSelect=parentForm.find("[name=R"+queData.questionId+"]");var options;var hiddenElemSelect=elemSelect.attr("type")=="hidden";if(hiddenElemSelect){options=elemSelect;}else{elemSelect.find("option").first().prop("selected",false);options=elemSelect.find("option");}if(ansData){var filterOption=options.filter("[value="+ansData.answerId+"]");if(dropdown&&!reset){ksAPI.setPreviouslySelectedOptions(queData.questionId,{});}if(!hiddenElemSelect&&!filterOption.length){var selectObj=parentForm.find("[name=R"+queData.questionId+"]");var allSortedOptionIdsByQueId=ksAPI.getAllSortedOptions(queData.questionId);var deletedOptionsByQueId=ksAPI.getDeletedOptions(queData.questionId);var selectedOptsByQueId=ksAPI.getPreviouslySelectedOptions(queData.questionId);var needToSelectedOptsByQueId={};var existedIdx=0;var lastExistedOption;var needToReturn=false;for(var index=0;index<allSortedOptionIdsByQueId.length;index++){var opt=allSortedOptionIdsByQueId[index];var optExisted=options[existedIdx];if(optExisted&&optExisted.value==opt){lastExistedOption=optExisted;existedIdx++;continue;}var deletedOpt=deletedOptionsByQueId[opt];if(deletedOpt&&ansData.answerId==opt){if(selectedOptsByQueId[opt]!=null){if(reset){ksAPI.resetSelectedOptionCache(queData.questionId,ansData.answerId);continue;}deletedOpt.selected=false;var $deleteOpt=$(deletedOpt);if(lastExistedOption){$(lastExistedOption).after($deleteOpt);}else{$deleteOpt.appendTo(elemSelect);}deletedOpt.selected=selectedOptsByQueId[opt]==true;if(elemSelect.attr("multiple")&&selectedOptsByQueId[opt]==true){needToSelectedOptsByQueId=selectedOptsByQueId;ksAPI.setPreviouslySelectedOptions(queData.questionId,needToSelectedOptsByQueId);}lastExistedOption=$deleteOpt;}else{needToReturn=true;if(elemSelect.attr("multiple")){needToSelectedOptsByQueId=selectedOptsByQueId;}needToSelectedOptsByQueId[opt]=true;}}}if(needToReturn){ksAPI.setPreviouslySelectedOptions(queData.questionId,needToSelectedOptsByQueId);if(!elemSelect.attr("multiple")){elemSelect.find("option").first().prop("selected",true);}return;}elemSelect=parentForm.find("[name=R"+queData.questionId+"]");options=elemSelect.find("option").filter("[value="+ansData.answerId+"]");}else{options=options.filter("[value="+ansData.answerId+"]");}}if(!options.length&&ansData&&!reset){if(!reset&&queData.type=="DROPDOWN"){parentForm.find("[name=R"+queData.questionId+"]").remove();}var elemIdNew="AnswerOption"+queData.questionId+"_"+ansData.answerId;options=$("<input type='hidden' name='R"+queData.questionId+"' id='"+elemIdNew+"' value='"+ansData.answerId+"'>").appendTo(parentForm);elemSelect=options;}if(hiddenElemSelect){if(reset){removeHiddenResult(parentForm,options,queData);}else{if(ansData){options.val(ansData.answerId);}}}else{options.prop("selected",!reset);if(reset&&ksAPI&&ksAPI.resetSelectedOptionCache){for(var i=0;i<queData.answersSorted.length;i++){var ansId=queData.answersSorted[i];if(ansData&&ansId!=ansData.answerId){continue;}ksAPI.resetSelectedOptionCache(queData.questionId,ansId);}}}if(triggerChanges!=false){eventsModuleProvider.getModule().triggerEvent(queData.questionId,null,null,loopInitiator);}};module._setResultForSingleline=function(parentForm,queData,ansData,value,reset,loopInitiator,triggerChanges){if(ansData){var elem=$("[name=other"+queData.questionId+"_"+ansData.answerId+"]");if(!elem.length){var elemIdNew="inputtextother"+queData.questionId+"_"+ansData.answerId;elem=$("<input type='hidden' name='other"+queData.questionId+"_"+ansData.answerId+"' id='"+elemIdNew+"'>").appendTo(parentForm);}if(elem.attr("type")=="hidden"){if(reset){removeHiddenResult(parentForm,elem,queData);}}elem.val(reset?"":value);if(triggerChanges!=false){eventsModuleProvider.getModule().triggerEvent(queData.questionId,ansData.answerId,null,loopInitiator);}if(queData.type=="NUMERIC_ALLOCATION"&&elem.length){var totalAnswerId=queData.answersSorted[queData.answersSorted.length-1];var totalObject=queData.answers[totalAnswerId];var totalHiddenElement=$("[name=other"+queData.questionId+"_"+totalAnswerId+"]");if(totalObject&&totalObject.total&&totalHiddenElement&&totalHiddenElement.attr("type")==="hidden"){totalHiddenElement.remove();}elem.blur();}}else{if(reset){var lastAnswer=null;for(var i=0;i<queData.answersSorted.length;i++){var ans=queData.answers[queData.answersSorted[i]];var elemText=parentForm.find("[name=other"+queData.questionId+"_"+ans.answerId+"]");if(elemText.attr("type")=="hidden"){removeHiddenResult(parentForm,elemText,queData);}else{elemText.val("");}if(elemText.length){lastAnswer=elemText;if(triggerChanges!=false){eventsModuleProvider.getModule().triggerEvent(queData.questionId,ans.answerId,null,loopInitiator);}}}if(queData.type=="NUMERIC_ALLOCATION"&&lastAnswer){lastAnswer.blur();}}}};module._setResultForLookup=function(queData,value,reset,loopInitiator,triggerChanges,usingPredefinedFilter){if(window.LQ_Core.isOffline()&&!window.appRoot.isDevice()){return;}if(window.LQ_Core){votingWaitModule.addWaitingQuestion(queData.questionId);if(reset){$.when(window.LQ_Core.resetResults(queData.questionId,true)).always(function(){votingWaitModule.removeWaitingQuestion(queData.questionId);if(triggerChanges!=false){eventsModuleProvider.getModule().triggerEvent(queData.questionId,null,null,loopInitiator);}return false;});}else{if(value){$.when(window.LQ_Core.selectValueByKey(queData.questionId,value,usingPredefinedFilter,false)).always(function(){votingWaitModule.removeWaitingQuestion(queData.questionId);if(triggerChanges!=false){eventsModuleProvider.getModule().triggerEvent(queData.questionId,null,null,loopInitiator);}return false;});}else{$.when(window.LQ_Core.resetResults(queData.questionId,true)).always(function(){votingWaitModule.removeWaitingQuestion(queData.questionId);if(triggerChanges!=false){eventsModuleProvider.getModule().triggerEvent(queData.questionId,null,null,loopInitiator);}return false;});}}}};module._setResultForMultiLookup=function(parentForm,queData,value,reset,loopInitiator,triggerChanges,usingPredefinedFilter){if(window.LQ_Core.isOffline()&&!window.appRoot.isDevice()){return;}if(reset){if(window.LQ_Multiple){votingWaitModule.addWaitingQuestion(queData.questionId);$.when(window.LQ_Multiple.resetResults(queData.questionId)).always(function(){votingWaitModule.removeWaitingQuestion(queData.questionId);if(triggerChanges!=false){eventsModuleProvider.getModule().triggerEvent(queData.questionId,null,null,loopInitiator);}removeHiddenResult(parentForm,null,queData);return false;});}}else{if(window.LQ_Core){votingWaitModule.addWaitingQuestion(queData.questionId);if(value){$.when(window.LQ_Core.selectValueByKey(queData.questionId,value,usingPredefinedFilter,false)).always(function(){votingWaitModule.removeWaitingQuestion(queData.questionId);if(triggerChanges!=false){eventsModuleProvider.getModule().triggerEvent(queData.questionId,null,null,loopInitiator);}return false;});}else{if(window.LQ_Multiple){votingWaitModule.addWaitingQuestion(queData.questionId);$.when(window.LQ_Multiple.resetResults(queData.questionId)).always(function(){votingWaitModule.removeWaitingQuestion(queData.questionId);if(triggerChanges!=false){eventsModuleProvider.getModule().triggerEvent(queData.questionId,null,null,loopInitiator);}return false;});}}}}};module._setResultForRateDiff=function(parentForm,queData,ansData,columnData,reset,loopInitiator,triggerChanges){for(var i=0;i<queData.answersSorted.length;i++){var currentAnsData=queData.answers[queData.answersSorted[i]];if(ansData&&ansData.answerId!=currentAnsData.answerId){continue;}for(var j=0;j<queData.columnsSorted.length;j++){var currentColumnData=queData.columns[queData.columnsSorted[j]];if(columnData&&columnData.columnId!=currentColumnData.columnId){continue;}var elem=parentForm.find("input[name=R"+queData.questionId+"_"+currentAnsData.answerId+"]").filter("[value="+(j+1)+"]");if(!elem.length){if(!reset){parentForm.find("input[name=R"+queData.questionId+"_"+currentAnsData.answerId+"]").remove();}var elemIdNew="R"+queData.questionId+"_"+currentAnsData.answerId+"_"+j;elem=$("<input type='hidden' name='R"+queData.questionId+"_"+currentAnsData.answerId+"' id='"+elemIdNew+"'>").appendTo(parentForm);}if(elem.attr("type")=="hidden"){if(reset){removeHiddenResult(parentForm,elem,queData);}else{elem.val(j+1);}}else{elem.prop("checked",!reset);elem.data("tallinn",!reset);}}}if(triggerChanges!=false){eventsModuleProvider.getModule().triggerEvent(queData.questionId,ansData?ansData.answerId:null,columnData?columnData.columnId:null,loopInitiator);}};module._setResultForFileUpload=function(queData,ansData,reset,loopInitiator,triggerChanges){if(window.LQ_Core.isOffline()&&!window.appRoot.isDevice()){return;}if(reset){var answerIds=ansData?[ansData.answerId]:queData.answersSorted;jQuery.each(answerIds,function(idx,answerId){var deleteUploadElement=$("#AnswerTr"+queData.questionId+"_"+answerId+" .deleteFileBtn");if(deleteUploadElement.length){deleteUploadElement.trigger("click",["ignoreConfirm"]);}else{var hiddenFileUpload=$("#hidden_inputtextother"+queData.questionId+"_"+answerId);if(hiddenFileUpload.data("link")!=null){var arrOfLink=hiddenFileUpload.data("link").split("/");var sizeOfLink=arrOfLink.length;if(FU_Utils&&sizeOfLink==9){FU_Utils.removeAttachedFile(arrOfLink[sizeOfLink-2],arrOfLink[sizeOfLink-1],arrOfLink[sizeOfLink-3],arrOfLink[sizeOfLink-4],"ignoreConfirm");}}hiddenFileUpload.val("");$("#inputtextother"+queData.questionId+"_"+answerId).val("");var fileInput=$("#fileInput_"+queData.questionId+"_"+answerId);if($.browser.msie){fileInput.replaceWith(fileInput.clone(true));}else{fileInput.val("");}if(window.fileUploadHelper&&window.fileUploadHelper.deleteAttachedImageFromForm){window.fileUploadHelper.deleteAttachedImageFromForm(queData.questionId,answerId);}}});}if(triggerChanges!=false){eventsModuleProvider.getModule().triggerEvent(queData.questionId,null,null,loopInitiator);}};module._setResultForCompareOne=function(parentForm,queData,ansData,reset,loopInitiator,triggerChanges){if(reset){var answers=queData.answersSorted;var pairs=[];while(answers.length>=1){var answer=answers[0];answers=answers.slice(1);for(var idx=0;idx<answers.length;idx++){pairs.push({first:answer,second:answers[idx]});}}var buildIdsForCompare=function(questionId,pair){var generalIdPart="RC"+questionId+"_"+pair.first+"_"+pair.second+"_";return{"left":"#"+generalIdPart+pair.first,"leftHidden":"#hidden_"+generalIdPart+pair.first,"right":"#"+generalIdPart+pair.second,"rightHidden":"#hidden_"+generalIdPart+pair.second};};$.each(pairs,function(idx,pair){var ids=buildIdsForCompare(queData.questionId,pair);$(ids.left).attr("checked",false);$(ids.left).data("tallinn",false);removeHiddenResult(parentForm,$(ids.leftHidden),queData);$(ids.right).attr("checked",false);$(ids.right).data("tallinn",false);removeHiddenResult(parentForm,$(ids.rightHidden),queData);});}if(triggerChanges!=false){eventsModuleProvider.getModule().triggerEvent(queData.questionId,null,null,loopInitiator);}};module._setResultForMatrix=function(parentForm,queData,ansData,columnData,value,reset,loopInitiator,triggerChanges){var pageNumber=window.votingSubmitModule.getPageNumber();var isQuestionOnPage=$.inArray(queData.questionId,window.survData.questionsByVP[pageNumber])>-1;var questionEl=isQuestionOnPage?$("#QuestionAnswersTableId"+queData.questionId):null;for(var i=0;i<queData.answersSorted.length;i++){var currentAnsData=queData.answers[queData.answersSorted[i]];if(ansData&&ansData.answerId!=currentAnsData.answerId){continue;}for(var j=0;j<queData.columnsSorted.length;j++){var currentColumnData=queData.columns[queData.columnsSorted[j]];if(columnData&&columnData.columnId!=currentColumnData.columnId){continue;}var id=_getId(currentColumnData.type,queData.questionId,currentAnsData.answerId,j);var elem=isQuestionOnPage?questionEl.find("#"+id):parentForm.find("#hidden_"+id);if(!elem.length){if(!reset&&currentColumnData.type=="EDIT_RADIO"){parentForm.find("input[name=other"+queData.questionId+"_"+currentAnsData.answerId+"_radio]").remove();}var elemIdNew=_getId(currentColumnData.type,queData.questionId,currentAnsData.answerId,j);var elemName=_getName(currentColumnData.type,queData.questionId,currentAnsData.answerId,j);elem=$("<input type='hidden' name='"+elemName+"' id='"+elemIdNew+"'>").appendTo(parentForm);}if(elem.attr("type")=="hidden"){if(reset){removeHiddenResult(parentForm,elem,queData);}else{if(currentColumnData.type=="EDIT_RADIO"||currentColumnData.type=="EDIT_CHECKBOX"){elem.val(j);}if(currentColumnData.type=="EDIT_TEXT"){elem.val(value);}if(currentColumnData.type=="EDIT_DROPDOWN"){elem.val(value);}}}else{if(currentColumnData.type=="EDIT_RADIO"||currentColumnData.type=="EDIT_CHECKBOX"){elem.prop("checked",!reset);elem.data("tallinn",!reset);}if(currentColumnData.type=="EDIT_TEXT"){elem.val(reset?"":value);}if(currentColumnData.type=="EDIT_DROPDOWN"){elem.val(reset?"":value);}}}}if(triggerChanges!=false){eventsModuleProvider.getModule().triggerEvent(queData.questionId,ansData?ansData.answerId:null,columnData?columnData.columnId:null,loopInitiator);}};var INPUT_ID_PREFIX="inputtextother";var SELECT_ID_PREFIX="selectother";var NAME_PREFIX="other";var _getId=function(questionType,questionId,answerId,columnId){if(questionType==="EDIT_RADIO"){return INPUT_ID_PREFIX+questionId+"_"+answerId+"_radio"+columnId;}if(questionType=="EDIT_CHECKBOX"){return INPUT_ID_PREFIX+questionId+"_"+answerId+"_check"+columnId;}if(questionType=="EDIT_TEXT"){return INPUT_ID_PREFIX+questionId+"_"+answerId+"_"+columnId;}if(questionType=="EDIT_DROPDOWN"){return SELECT_ID_PREFIX+questionId+"_"+answerId+"_"+columnId;}};var _getName=function(questionType,questionId,answerId,columnId){var name=NAME_PREFIX+questionId+"_"+answerId;if(questionType==="EDIT_RADIO"){return name+"_radio";}if(questionType=="EDIT_CHECKBOX"){return name+"_check"+columnId;}if(questionType=="EDIT_TEXT"){return name+"_"+columnId;}if(questionType=="EDIT_DROPDOWN"){return name+"_"+columnId;}};return module;})(window,jQuery,window.votingSubmitModule,window.eventsModuleProvider,window.ksAPI,window.votingWaitModule);if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=votingResultsModule;window.votingResultsModule=votingResultsModule;}var answerRequiredModule=(function(window,$,votingResultsModule){var module={};module.check=function(QID,checkit,element,other_element){var frm=null;if(element!=null&&element!=undefined){frm=window.findQuestionElementsOnForm(QID,element.form);}if(!frm){return;}var formSuffix=element.form.name=="theForm"?"":("_f"+element.form.name.substring(7));var jklmn=0;while(jklmn<window.prefAnsweredQue.length){if(window.prefAnsweredQue[jklmn]==QID||window.prefAnsweredQueBackup[jklmn]==QID){var i=0;var somethingChecked=false;while(i<frm.length){var elem=frm[i];if(elem.name!=null&&elem.value!=null&&!j$(elem).data("tallinn")){if(elem.name.indexOf("R"+QID)==0&&elem.checked){if(window.prefAnsweredQue[jklmn]==QID){window.removeFromPreferredArrays(QID);}jklmn=window.prefAnsweredQue.length;somethingChecked=true;break;}}i++;}if(!somethingChecked&&window.prefAnsweredQueBackup[jklmn]==QID){window.addToPreferredArrays(QID);}}jklmn++;}if(!checkit){return;}var AID;var elemCheckOrRadio;if(other_element){AID=parseInt(window.findAID(other_element.name));elemCheckOrRadio=votingResultsModule.findElementById(formSuffix,"RC"+QID+"_"+AID);if(!elemCheckOrRadio.is(":checked")){$(other_element).data("checkedManualy",false);}else{$(other_element).data("checkedManualy",true);}}if(other_element==null||other_element.name==null||other_element.value.length==0||other_element.readOnly){return;}if(!elemCheckOrRadio.is(":checked")){other_element.value="";$(other_element).change();}};return module;})(window,jQuery,window.votingResultsModule);if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=answerRequiredModule;}var calculationModule=(function(window,$,parser_ROW_LOGIC,votingResultsModule,commonVotingModule){var calcModule={};calcModule.getValueType=function(queId,ansId,colIdOrIdx){var queData=window.survData.questionsMap[queId];if(!queData){return null;}var ansData=null;if(ansId!=null){ansData=queData.answers[ansId];}var vt=null;if(colIdOrIdx!=null){var colData;if(ansData){colData=queData.columns[queData.columnsSorted[colIdOrIdx]];}else{colData=queData.columns[colIdOrIdx];}if(colData){vt=colData.valueType;}}else{if(ansData){vt=ansData.valueType;}}return vt;};calcModule.getResultForConditionJS=function(expression,asText){var rawValue=calcModule.getLogicTokenResult(expression,true);if(rawValue===null||rawValue===undefined){return null;}var parsed=parser_ROW_LOGIC.parseLogicToken(expression);var queId=parsed.questionId;if(!queId){throw"Incorrect expression=["+expression+"]";}var queData=window.survData.questionsMap[parsed.questionId];if(queData.type=="MATRIX_3D"&&parsed.answerId!=null&&parsed.columnNum!=null&&parsed.columnNum>=0){var columnData=queData.columns[queData.columnsSorted[parsed.columnNum]];if(columnData&&columnData.type=="EDIT_DROPDOWN"){var criteriaDrop=new votingResultsModule.ResultCriteria();criteriaDrop.matrixDropdownAsIndex=!asText;return votingResultsModule.getVotingResult(parsed.questionId,parsed.answerId,parsed.columnNum,criteriaDrop);}}return calcModule._applyValueTypeToResult(parsed,rawValue);};calcModule.getResultForConditionJSAsText=function(expression){return calcModule.getResultForConditionJS(expression,true);};calcModule.getResultWithValueType=function(expression){var rawValue=calcModule.getLogicTokenResult(expression,true);if(rawValue===null||rawValue===undefined){return null;}var parsed=parser_ROW_LOGIC.parseLogicToken(expression);var queId=parsed.questionId;if(!queId){throw"Incorrect expression=["+expression+"]";}return calcModule._applyValueTypeToResult(parsed,rawValue);};calcModule._applyValueTypeToResult=function(parsedExpression,result){var vt=calcModule.getValueType(parsedExpression.questionId,parsedExpression.answerId,parsedExpression.columnNum);if(vt){var vtNative=new ValueType(vt.valType,vt.decimals,vt.decimalDivider,vt.thousendDivider,vt.format,vt.preffix,vt.suffix);return KS_ValueType.convertToValue(vtNative,result);}return result;};calcModule.getLogicTokenResult=function(expression,returnValue,criteria){var parsed=parser_ROW_LOGIC.parseLogicToken(expression);var result=votingResultsModule.getVotingResult(parsed.questionId,parsed.answerId,parsed.columnNum,criteria);if(returnValue){return result;}return result!=null;};var nonSkippedPages=null;var _isPageNotSkipped=function(pageNum){if(!nonSkippedPages){var trace=window.votingSubmitModule.getResponseTrace();if(!trace){return true;}nonSkippedPages={};for(var i=0;i<trace.length;i++){var curTrace=trace[i];if(!curTrace.passed&&curTrace.encountered){continue;}nonSkippedPages[curTrace.page]=true;}}return nonSkippedPages[pageNum];};calcModule.parseDateKS=function(value){var vtNative=new ValueType("DATE","0",".",",","yyyy-MM-dd","","");return KS_ValueType.convertToValue(vtNative,value);};window.parseDateKS=calcModule.parseDateKS;calcModule.getLogicTokenWeight=function(expression){var parsed=parser_ROW_LOGIC.parseLogicToken(expression);var queData=window.survData.questionsMap[parsed.questionId];if(!_isPageNotSkipped(queData.pageNum)&&window.survData.allPagesNumber&&window.survData.allPagesNumber>1&&queData.pageNum!=window.votingSubmitModule.getPageNumber()){return 0;}switch(queData.type){case"PICK_ONE_NO_OTHER":case"PICK_ONE_WITH_OTHER":case"PICK_ONE_WITH_COMMENT":case"CHECKALL_NO_OTHER":case"CHECKALL_WITH_OTHER":case"DROPDOWN":case"LISTBOX":if(parsed.answerId){var ansData1=queData.answers[parsed.answerId];return getAnswerWeight(queData,ansData1);}else{return this.calcSumForQuestion(queData);}break;case"SINGLE_LINE":case"MULTI_LINE":case"NUMERIC_ALLOCATION":case"LOOKUP":case"UPLOAD_FILE":if(!parsed.answerId){return 0;}var textResult=calcModule.getResultWithValueType(expression);if(textResult!=null&&!isNaN(textResult)){return parseFloat(textResult);}break;case"RANK_GRID_DEPENDENT":case"RANK_GRID_INDEPENDENT":if(!parsed.answerId){return 0;}var ansData=queData.answers[parsed.answerId];if(parsed.columnNum!=null&&parsed.columnNum>=0){if(votingResultsModule.getVotingResult(queData.questionId,parsed.answerId,parsed.columnNum)!=null){var column=queData.columns[queData.columnsSorted[parsed.columnNum]];return column?column.columnWeight:0;}}else{return getAnswerWeightRateDiff(queData,ansData);}break;case"COMPARE":if(!parsed.answerId){return 0;}var ansData2=queData.answers[parsed.answerId];if(votingResultsModule.getVotingResult(queData.questionId,parsed.answerId,null)!=null){return ansData2.answerWeight;}break;case"MATRIX_3D":if(!parsed.answerId){return 0;}if(parsed.columnNum>=0){var textResult=calcModule.getResultWithValueType(expression);if(textResult!=null&&!isNaN(textResult)){return parseFloat(textResult);}}break;case"HEADER":case"INTERNAL_NOTES":default:return 0;}return 0;};calcModule.calcSumForQuestion=function(queData,nullInfluencesToMax){var sum=0;var toBeIgnored=[];if(nullInfluencesToMax){for(var k=0;k<queData.answersSorted.length;k++){var answer=queData.answers[queData.answersSorted[k]];if(queData.questionId in toBeIgnored){continue;}if(!isMultyQuestion(queData)){continue;}if(answer.answerWeight==null&&votingResultsModule.getVotingResult(queData.questionId,answer.answerId,null,null)!=null){toBeIgnored.push(queData.questionId);break;}}}for(var k=0;k<queData.answersSorted.length;k++){var answer=queData.answers[queData.answersSorted[k]];if($.inArray(queData.questionId,toBeIgnored)>-1){continue;}sum+=getAnswerWeight(queData,answer);}return sum;};calcModule.calcTotal=function(questionId){var breakAfterCurrentQuestion=false;var sum=0;var trace=window.votingSubmitModule.getResponseTrace();var curPageNumber=window.votingSubmitModule.getPageNumber();for(var i=0;i<curPageNumber;i++){if((i+1)!=curPageNumber&&!trace[i].passed&&trace[i].encountered){continue;}var questionsOnPage=window.survData.questionsByVP[i+1];for(var q=0;q<questionsOnPage.length;q++){var queId=questionsOnPage[q];var queData=window.survData.questionsMap[queId];sum+=calcModule.calcSumForQuestion(queData);if(queId==questionId){breakAfterCurrentQuestion=true;break;}}if(breakAfterCurrentQuestion){break;}}return sum;};calcModule.defaultNullWeightsInfluenceToMaxScore=true;calcModule.calcScore=function(startQueNum,endQueNum){return calcModule.calcScoreNull(startQueNum,endQueNum,calcModule.defaultNullWeightsInfluenceToMaxScore);};calcModule.calcScoreNull=function(startQueNum,endQueNum,nullInfluencesToMax){var survData=window.survData;var questionsSection={};var j=startQueNum;while(j>=startQueNum&&j<=endQueNum){questionsSection[survData.questionsSorted[j-1]]=survData.questionsSorted[j-1];j++;}var sum=0;var trace=window.votingSubmitModule.getResponseTrace();if(!trace){trace=new Array();trace[0]={page:1,passed:true};}var questionByPages=survData.questionsByVP;if(!survData.questionsByVP.hasOwnProperty("1")){questionByPages=[];questionByPages[1]=survData.questionsSorted;if(trace&&!trace.length){trace[0]={page:1,passed:true};}}var curPageNumber=window.votingSubmitModule.getPageNumber();for(var i=0;i<trace.length;i++){if((i+1)!=curPageNumber&&!trace[i].passed&&trace[i].encountered){continue;}var pageNum=trace[i].page;var questionsOnPage=questionByPages[pageNum];for(var q=0;q<questionsOnPage.length;q++){var queId=questionsOnPage[q];if(!questionsSection[queId]){continue;}var queData=survData.questionsMap[queId];sum+=calcModule.calcSumForQuestion(queData,nullInfluencesToMax);}}return sum;};calcModule.calcMaxScore=function(startQueNum,endQueNum){return this.calcMaxScoreNull(startQueNum,endQueNum,calcModule.defaultNullWeightsInfluenceToMaxScore);};calcModule.calcMaxScoreNull=function(startQueNum,endQueNum,nullWeightsInfluenceToMaxScore){var survData=window.survData;var questionsSection={};var j=startQueNum;while(j>=startQueNum&&j<=endQueNum){questionsSection[survData.questionsSorted[j-1]]=survData.questionsSorted[j-1];j++;}var maximum=0;var trace=window.votingSubmitModule.getResponseTrace();if(!trace){trace=new Array();trace[0]={page:1,passed:true};}var questionByPages=survData.questionsByVP;if(!survData.questionsByVP.hasOwnProperty("1")){questionByPages=[];questionByPages[1]=survData.questionsSorted;if(trace&&!trace.length){trace[0]={page:1,passed:true};}}var curPageNumber=window.votingSubmitModule.getPageNumber();for(var i=0;i<trace.length;i++){if((i+1)!=curPageNumber&&!trace[i].passed&&trace[i].encountered){continue;}var pageNum=trace[i].page;var questionsOnPage=questionByPages[pageNum];for(var q=0;q<questionsOnPage.length;q++){var queId=questionsOnPage[q];if(!questionsSection[queId]){continue;}var queData=survData.questionsMap[queId];if(queData.type=="MATRIX_3D"||queData.answersSorted.length==0){continue;}var multy=isMultyQuestion(queData);if(multy){var valueForMulty=calcModule.getMaximumValueForMulty(queData,nullWeightsInfluenceToMaxScore);if(valueForMulty!=null&&(valueForMulty>0||queData.answerRequired)){maximum+=valueForMulty;}}else{if(queData.type=="COMPARE"){var valueForCompare=calcModule.getMaximumForCompare(queData);if(valueForCompare!=null){maximum+=valueForCompare;}}else{if(queData.type=="RANK_GRID_INDEPENDENT"||queData.type=="RANK_GRID_DEPENDENT"){var valueForRankGridHeader=getMaximumValueForRankGridHeader(queData,nullWeightsInfluenceToMaxScore);if(valueForRankGridHeader!=null&&(valueForRankGridHeader>0||queData.answerRequired)){maximum+=valueForRankGridHeader;}}else{var valueForSingle=calcModule.getMaximumValueForSingle(queData,nullWeightsInfluenceToMaxScore);if(valueForSingle!=null&&(valueForSingle>0||queData.answerRequired)){maximum+=valueForSingle;}}}}}}return maximum;};function isMultyQuestion(queData){return(queData.type=="CHECKALL_WITH_OTHER"||queData.type=="CHECKALL_NO_OTHER"||queData.type=="LISTBOX");}function getAnswerWeight(queData,ansData){if(queData.type=="RANK_GRID_DEPENDENT"||queData.type=="RANK_GRID_INDEPENDENT"){return getAnswerWeightRateDiff(queData,ansData);}if(!ansData.answerWeight){return 0;}if(queData.type=="COMPARE"){return getAnswerWeightCompare(queData,ansData);}if(votingResultsModule.getVotingResult(queData.questionId,ansData.answerId,null)!=null){return ansData.answerWeight;}return 0;}function getAnswerWeightCompare(queData,ansData){var sumWeight=0;for(var k=0;k<queData.answersSorted.length;k++){var anotherAnsId=queData.answersSorted[k];if(ansData.answerId==anotherAnsId){continue;}var id=queData.questionId+"_"+ansData.answerId+"_"+anotherAnsId+"_"+ansData.answerId;var elemLeft=$("#hidden_RC"+id);if(elemLeft.length==0){elemLeft=$("#RC"+id);if(elemLeft.length>0){if(elemLeft.attr("type")!=="hidden"){elemLeft=elemLeft.filter(":checked");}}}if(elemLeft.length>0){if(elemLeft.val()==ansData.answerId){sumWeight+=ansData.answerWeight;}}else{id=queData.questionId+"_"+anotherAnsId+"_"+ansData.answerId+"_"+ansData.answerId;var elemRight=$("#hidden_RC"+id);if(elemRight.length==0){elemRight=$("#RC"+id);if(elemRight.length>0){if(elemRight.attr("type")!=="hidden"){elemRight=elemRight.filter(":checked");}}}if(elemRight.length>0){if(elemRight.val()==ansData.answerId){sumWeight+=ansData.answerWeight;}}}}return sumWeight;}function getAnswerWeightRateDiff(queData,ansData){if(queData.columnsSorted==null||queData.columnsSorted.length==0){return 0;}for(var i=0;i<queData.columnsSorted.length;i++){var id="R"+queData.questionId+"_"+ansData.answerId+"_"+i;var elem=$("#hidden_"+id);if(elem.length==0){elem=$("#"+id);if(elem.length>0){if(elem.attr("type")!=="hidden"){elem=elem.filter(":checked");}}}if(elem.length>0&&elem.val().length>0){var columnId=queData.columnsSorted[elem.val()-1];var column=queData.columns[columnId];if(column.columnWeight!=null){return column.columnWeight;}}}return 0;}calcModule.getMaximumValueForMulty=function(queData,nullWeightsInfluenceToMaxScore){var max=null;var negativeCount=0;var totalNonNullCount=0;var positiveSumm=0;var answeredNull=false;var answeredNotNull=false;for(var k=0;k<queData.answersSorted.length;k++){var answer=queData.answers[queData.answersSorted[k]];if(answer==null){continue;}if(votingResultsModule.getVotingResult(queData.questionId,answer.answerId,null,null)!=null){if(answer.answerWeight==null){answeredNull=true;}else{answeredNotNull=true;}}if(answeredNotNull&&answeredNull){break;}}if(answeredNull&&!answeredNotNull&&nullWeightsInfluenceToMaxScore){return null;}for(var k=0;k<queData.answersSorted.length;k++){var answer=queData.answers[queData.answersSorted[k]];if(answer.answerWeight==null){continue;}if(max==null){max=answer.answerWeight;}if(max!=null&&answer.answerWeight>0){positiveSumm+=answer.answerWeight;}if(answer.answerWeight<0){negativeCount++;}totalNonNullCount++;}if(negativeCount==totalNonNullCount){return calcModule.getMaximumValueForSingle(queData,nullWeightsInfluenceToMaxScore);}return positiveSumm;};calcModule.getMaximumValueForSingle=function(queData,nullWeightsInfluenceToMaxScore){var max=null;var questionAnsweredWithValues=false;for(var i=0;i<queData.answersSorted.length;i++){var ansId=queData.answersSorted[i];var answer=queData.answers[ansId];var answered=(votingResultsModule.getVotingResult(queData.questionId,ansId,null)!=null);if(answered&&answer.answerWeight!=null){questionAnsweredWithValues=true;}if(nullWeightsInfluenceToMaxScore&&answered&&answer.answerWeight==null){if(!(queData.type=="PICK_ONE_WITH_COMMENT"&&answer.type=="ATYPE_SINGLE_LINE")){return null;}}if(answer.answerWeight!=null&&(max==null||answer.answerWeight>max)){max=answer.answerWeight;}}if(nullWeightsInfluenceToMaxScore&&!questionAnsweredWithValues){return null;}return max;};calcModule.getMaximumForCompare=function(queData){var result=0;var sortedWeights=[];for(var k=0;k<queData.answersSorted.length;k++){var answer=queData.answers[queData.answersSorted[k]];if(answer.answerWeight===null||answer.answerWeight===undefined){continue;}sortedWeights.push(answer.answerWeight);}sortedWeights.sort(function(a,b){return b-a;});var answersCount=queData.answersSorted.length;for(var i=0;i<sortedWeights.length;i++){result+=sortedWeights[i]*--answersCount;}return result;};function getMaximumValueForRankGridHeader(queData,nullWeightsInfluenceToMaxScore){var columns=queData.columnsSorted;var max=null;for(var k=0;k<queData.columnsSorted.length;k++){var column=queData.columns[queData.columnsSorted[k]];if(max==null&&column.columnWeight!=null){max=column.columnWeight;}if(column.columnWeight!=null&&max!=null&&column.columnWeight>max){max=column.columnWeight;}}if(max==null){return max;}if(!nullWeightsInfluenceToMaxScore){return max*queData.answersSorted.length;}var count=0;for(var i=0;i<queData.answersSorted.length;i++){var answer=queData.answers[queData.answersSorted[i]];var result=null;var column=null;for(var j=0;j<queData.columnsSorted.length;j++){result=votingResultsModule.getVotingResult(queData.questionId,answer.answerId,j);if(!result){continue;}column=queData.columns[queData.columnsSorted[j]];break;}if(!column||column.columnWeight==null){continue;}count++;}return max*count;}if(commonVotingModule){calcModule.allDataRestored=commonVotingModule.allDataRestored;}else{calcModule.allDataRestored=$.Deferred();calcModule.allDataRestored.resolve();}return calcModule;})(window,jQuery,window.parser_ROW_LOGIC,window.votingResultsModule,window.commonVotingModule);if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=calculationModule;window.calculationModule=calculationModule;}
/*!
 * jQuery Form Plugin
 * version: 2.67 (12-MAR-2011)
 * @requires jQuery v1.3.2 or later
 *
 * Examples and documentation at: http://malsup.com/jquery/form/
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 */
(function($){$.fn.ajaxSubmit=function(options){if(!this.length){log("ajaxSubmit: skipping submit process - no element selected");return this;}if(typeof options=="function"){options={success:options};}var action=this.attr("action");var url=(typeof action==="string")?$.trim(action):"";if(url){url=(url.match(/^([^#]+)/)||[])[1];}url=url||window.location.href||"";options=$.extend(true,{url:url,type:this[0].getAttribute("method")||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},options);var veto={};this.trigger("form-pre-serialize",[this,options,veto]);if(veto.veto){log("ajaxSubmit: submit vetoed via form-pre-serialize trigger");return this;}if(options.beforeSerialize&&options.beforeSerialize(this,options)===false){log("ajaxSubmit: submit aborted via beforeSerialize callback");return this;}var n,v,a=this.formToArray(options.semantic);if(options.data){options.extraData=options.data;for(n in options.data){if(options.data[n] instanceof Array){for(var k in options.data[n]){a.push({name:n,value:options.data[n][k]});}}else{v=options.data[n];v=$.isFunction(v)?v():v;a.push({name:n,value:v});}}}if(options.beforeSubmit&&options.beforeSubmit(a,this,options)===false){log("ajaxSubmit: submit aborted via beforeSubmit callback");return this;}this.trigger("form-submit-validate",[a,this,options,veto]);if(veto.veto){log("ajaxSubmit: submit vetoed via form-submit-validate trigger");return this;}var q=$.param(a);if(options.type.toUpperCase()=="GET"){options.url+=(options.url.indexOf("?")>=0?"&":"?")+q;options.data=null;}else{options.data=q;}var $form=this,callbacks=[];if(options.resetForm){callbacks.push(function(){$form.resetForm();});}if(options.clearForm){callbacks.push(function(){$form.clearForm();});}if(!options.dataType&&options.target){var oldSuccess=options.success||function(){};callbacks.push(function(data){var fn=options.replaceTarget?"replaceWith":"html";$(options.target)[fn](data).each(oldSuccess,arguments);});}else{if(options.success){callbacks.push(options.success);}}options.success=function(data,status,xhr){var context=options.context||options;for(var i=0,max=callbacks.length;i<max;i++){callbacks[i].apply(context,[data,status,xhr||$form,$form]);}};var fileInputs=$("input:file",this).length>0;var mp="multipart/form-data";var multipart=($form.attr("enctype")==mp||$form.attr("encoding")==mp);if(options.iframe!==false&&(fileInputs||options.iframe||multipart)){if(options.closeKeepAlive){$.get(options.closeKeepAlive,fileUpload);}else{fileUpload();}}else{$.ajax(options);}this.trigger("form-submit-notify",[this,options]);return this;function fileUpload(){var form=$form[0];if($(":input[name=submit],:input[id=submit]",form).length){alert('Error: Form elements must not have name or id of "submit".');return;}var s=$.extend(true,{},$.ajaxSettings,options);s.context=s.context||s;var id="jqFormIO"+(new Date().getTime()),fn="_"+id;var $io=$('<iframe id="'+id+'" name="'+id+'" src="'+s.iframeSrc+'" />');var io=$io[0];$io.css({position:"absolute",top:"-1000px",left:"-1000px"});var xhr={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(){log("aborting upload...");var e="aborted";this.aborted=1;$io.attr("src",s.iframeSrc);xhr.error=e;s.error&&s.error.call(s.context,xhr,"error",e);g&&$.event.trigger("ajaxError",[xhr,s,e]);s.complete&&s.complete.call(s.context,xhr,"error");}};var g=s.global;if(g&&!$.active++){$.event.trigger("ajaxStart");}if(g){$.event.trigger("ajaxSend",[xhr,s]);}if(s.beforeSend&&s.beforeSend.call(s.context,xhr,s)===false){if(s.global){$.active--;}return;}if(xhr.aborted){return;}var timedOut=0;var sub=form.clk;if(sub){var n=sub.name;if(n&&!sub.disabled){s.extraData=s.extraData||{};s.extraData[n]=sub.value;if(sub.type=="image"){s.extraData[n+".x"]=form.clk_x;s.extraData[n+".y"]=form.clk_y;}}}function doSubmit(){var t=$form.attr("target"),a=$form.attr("action");form.setAttribute("target",id);if(form.getAttribute("method")!="POST"){form.setAttribute("method","POST");}if(form.getAttribute("action")!=s.url){form.setAttribute("action",s.url);}if(!s.skipEncodingOverride){$form.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"});}if(s.timeout){setTimeout(function(){timedOut=true;cb();},s.timeout);}var extraInputs=[];try{if(s.extraData){for(var n in s.extraData){extraInputs.push($('<input type="hidden" name="'+n+'" value="'+s.extraData[n]+'" />').appendTo(form)[0]);}}$io.appendTo("body");io.attachEvent?io.attachEvent("onload",cb):io.addEventListener("load",cb,false);form.submit();}finally{form.setAttribute("action",a);if(t){form.setAttribute("target",t);}else{$form.removeAttr("target");}$(extraInputs).remove();}}if(s.forceSync){doSubmit();}else{setTimeout(doSubmit,10);}var data,doc,domCheckCount=50;function cb(){if(xhr.aborted){return;}try{doc=io.contentWindow?io.contentWindow.document:io.contentDocument?io.contentDocument:io.document;}catch(e){KS_Utils.log(e.message);}if(!doc||doc.location.href==s.iframeSrc){return;}io.detachEvent?io.detachEvent("onload",cb):io.removeEventListener("load",cb,false);var ok=true;try{if(timedOut){throw"timeout";}var isXml=s.dataType=="xml"||doc.XMLDocument||$.isXMLDoc(doc);log("isXml="+isXml);if(!isXml&&window.opera&&(doc.body==null||doc.body.innerHTML=="")){if(--domCheckCount){log("requeing onLoad callback, DOM not available");setTimeout(cb,250);return;}}xhr.responseText=doc.body?doc.body.innerHTML:doc.documentElement?doc.documentElement.innerHTML:null;xhr.responseXML=doc.XMLDocument?doc.XMLDocument:doc;xhr.getResponseHeader=function(header){var headers={"content-type":s.dataType};return headers[header];};var scr=/(json|script)/.test(s.dataType);if(scr||s.textarea){var ta=doc.getElementsByTagName("textarea")[0];if(ta){xhr.responseText=ta.value;}else{if(scr){var pre=doc.getElementsByTagName("pre")[0];var b=doc.getElementsByTagName("body")[0];if(pre){xhr.responseText=pre.textContent;}else{if(b){xhr.responseText=b.innerHTML;}}}}}else{if(s.dataType=="xml"&&!xhr.responseXML&&xhr.responseText!=null){xhr.responseXML=toXml(xhr.responseText);}}data=httpData(xhr,s.dataType,s);}catch(e){log("error caught:",e);ok=false;xhr.error=e;s.error&&s.error.call(s.context,xhr,"error",e);g&&$.event.trigger("ajaxError",[xhr,s,e]);}if(xhr.aborted){log("upload aborted");ok=false;}if(ok){s.success&&s.success.call(s.context,data,"success",xhr);g&&$.event.trigger("ajaxSuccess",[xhr,s]);}g&&$.event.trigger("ajaxComplete",[xhr,s]);if(g&&!--$.active){$.event.trigger("ajaxStop");}s.complete&&s.complete.call(s.context,xhr,ok?"success":"error");setTimeout(function(){$io.removeData("form-plugin-onload");$io.remove();xhr.responseXML=null;},100);}var toXml=$.parseXML||function(s,doc){if(window.ActiveXObject){doc=new ActiveXObject("Microsoft.XMLDOM");doc.async="false";doc.loadXML(s);}else{doc=(new DOMParser()).parseFromString(s,"text/xml");}return(doc&&doc.documentElement&&doc.documentElement.nodeName!="parsererror")?doc:null;};var parseJSON=$.parseJSON||function(s){return window["eval"]("("+s+")");};var httpData=function(xhr,type,s){var ct=xhr.getResponseHeader("content-type")||"",xml=type==="xml"||!type&&ct.indexOf("xml")>=0,data=xml?xhr.responseXML:xhr.responseText;if(xml&&data.documentElement.nodeName==="parsererror"){$.error&&$.error("parsererror");}if(s&&s.dataFilter){data=s.dataFilter(data,type);}if(typeof data==="string"){if(type==="json"||!type&&ct.indexOf("json")>=0){data=parseJSON(data);}else{if(type==="script"||!type&&ct.indexOf("javascript")>=0){$.globalEval(data);}}}return data;};}};$.fn.ajaxForm=function(options){if(this.length===0){var o={s:this.selector,c:this.context};if(!$.isReady&&o.s){log("DOM not ready, queuing ajaxForm");$(function(){$(o.s,o.c).ajaxForm(options);});return this;}log("terminating; zero elements found by selector"+($.isReady?"":" (DOM not ready)"));return this;}return this.ajaxFormUnbind().bind("submit.form-plugin",function(e){if(!e.isDefaultPrevented()){e.preventDefault();$(this).ajaxSubmit(options);}}).bind("click.form-plugin",function(e){var target=e.target;var $el=$(target);if(!($el.is(":submit,input:image"))){var t=$el.closest(":submit");if(t.length==0){return;}target=t[0];}var form=this;form.clk=target;if(target.type=="image"){if(e.offsetX!=undefined){form.clk_x=e.offsetX;form.clk_y=e.offsetY;}else{if(typeof $.fn.offset=="function"){var offset=$el.offset();form.clk_x=e.pageX-offset.left;form.clk_y=e.pageY-offset.top;}else{form.clk_x=e.pageX-target.offsetLeft;form.clk_y=e.pageY-target.offsetTop;}}}setTimeout(function(){form.clk=form.clk_x=form.clk_y=null;},100);});};$.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin");};$.fn.formToArray=function(semantic){var a=[];if(this.length===0){return a;}var form=this[0];var els=semantic?form.getElementsByTagName("*"):form.elements;if(!els){return a;}var i,j,n,v,el,max,jmax;for(i=0,max=els.length;i<max;i++){el=els[i];n=el.name;if(!n){continue;}if(semantic&&form.clk&&el.type=="image"){if(!el.disabled&&form.clk==el){a.push({name:n,value:$(el).val()});a.push({name:n+".x",value:form.clk_x},{name:n+".y",value:form.clk_y});}continue;}v=$.fieldValue(el,true);if(v&&v.constructor==Array){for(j=0,jmax=v.length;j<jmax;j++){a.push({name:n,value:v[j]});}}else{if(v!==null&&typeof v!="undefined"){a.push({name:n,value:v});}}}if(!semantic&&form.clk){var $input=$(form.clk),input=$input[0];n=input.name;if(n&&!input.disabled&&input.type=="image"){a.push({name:n,value:$input.val()});a.push({name:n+".x",value:form.clk_x},{name:n+".y",value:form.clk_y});}}return a;};$.fn.formSerialize=function(semantic){return $.param(this.formToArray(semantic));};$.fn.fieldSerialize=function(successful){var a=[];this.each(function(){var n=this.name;if(!n){return;}var v=$.fieldValue(this,successful);if(v&&v.constructor==Array){for(var i=0,max=v.length;i<max;i++){a.push({name:n,value:v[i]});}}else{if(v!==null&&typeof v!="undefined"){a.push({name:this.name,value:v});}}});return $.param(a);};$.fn.fieldValue=function(successful){for(var val=[],i=0,max=this.length;i<max;i++){var el=this[i];var v=$.fieldValue(el,successful);if(v===null||typeof v=="undefined"||(v.constructor==Array&&!v.length)){continue;}v.constructor==Array?$.merge(val,v):val.push(v);}return val;};$.fieldValue=function(el,successful){var n=el.name,t=el.type,tag=el.tagName.toLowerCase();if(successful===undefined){successful=true;}if(successful&&(!n||el.disabled||t=="reset"||t=="button"||(t=="checkbox"||t=="radio")&&!el.checked||(t=="submit"||t=="image")&&el.form&&el.form.clk!=el||tag=="select"&&el.selectedIndex==-1)){return null;}if(tag=="select"){var index=el.selectedIndex;if(index<0){return null;}var a=[],ops=el.options;var one=(t=="select-one");var max=(one?index+1:ops.length);for(var i=(one?index:0);i<max;i++){var op=ops[i];if(op.selected){var v=op.value;if(!v){v=(op.attributes&&op.attributes["value"]&&!(op.attributes["value"].specified))?op.text:op.value;}if(one){return v;}a.push(v);}}return a;}return $(el).val();};$.fn.clearForm=function(){return this.each(function(){$("input,select,textarea",this).clearFields();});};$.fn.clearFields=$.fn.clearInputs=function(){return this.each(function(){var t=this.type,tag=this.tagName.toLowerCase();if(t=="text"||t=="password"||tag=="textarea"){this.value="";}else{if(t=="checkbox"||t=="radio"){this.checked=false;}else{if(tag=="select"){this.selectedIndex=-1;}}}});};$.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=="function"||(typeof this.reset=="object"&&!this.reset.nodeType)){this.reset();}});};$.fn.enable=function(b){if(b===undefined){b=true;}return this.each(function(){this.disabled=!b;});};$.fn.selected=function(select){if(select===undefined){select=true;}return this.each(function(){var t=this.type;if(t=="checkbox"||t=="radio"){this.checked=select;}else{if(this.tagName.toLowerCase()=="option"){var $sel=$(this).parent("select");if(select&&$sel[0]&&$sel[0].type=="select-one"){$sel.find("option").selected(false);}this.selected=select;}}});};function log(){if($.fn.ajaxSubmit.debug){var msg="[jquery.form] "+Array.prototype.join.call(arguments,"");if(window.console&&window.console.log){window.console.log(msg);}else{if(window.opera&&window.opera.postError){window.opera.postError(msg);}}}}})(jQuery);(function($){var defaults={text:"",cls:"",position:"default",forcePosition:false,animate:false,trigger:"hover",showDelay:200,dontHideOnTooltipHover:false,selector:""},eventNS=".ks_tooltip",isTouch=("ontouchstart" in window||"onmsgesturechange" in window),_getHtml=function(id,text,cls){return'<div id="'+id+'" class="'+(cls||"")+'" '+'style="display:none; position:absolute; -webkit-transform:translateZ(0) translate3d(0, 0, 0); '+'transform:translateZ(0) translate3d(0, 0, 0);">'+text+"</div>";},_isIE=function(){var msie=parseInt((/msie (\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1]);if(isNaN(msie)){msie=parseInt((/trident\/.*; rv:(\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1]);}return msie!==null&&!isNaN(msie);},KS_Tooltip=function(target,conf){var config={},self=this,timestamp=+new Date(),tooltipId="ks_tooltip"+timestamp,showEvent="mouseenter",isIE=_isIE();if(typeof conf==="string"){conf={text:conf};}if(conf&&typeof conf.showDelay!=="number"){delete conf.showDelay;}if(isTouch&&conf&&!conf.trigger){conf.trigger="click";}config=$.extend({},defaults,conf||{},config);if(target.length&&target.data("tooltipId")){return target;}this.conf=config;this.target=target;this.win=$(window);this.body=$("body");this.doc=$(document);this.animSpeed=100;this.targetDistance=7;this.screenMargin=20;this.tooltipId=tooltipId;if(isIE||this.conf.animate===false){this.animSpeed=0;}if(typeof this.conf.trigger==="string"){showEvent=(this.conf.trigger==="hover"?"mouseenter":this.conf.trigger);}if(this.conf.text){this.text=this.conf.text;}else{if(!this.conf.selector){this.text=this.target.data("title")||this.target.attr("title")||"";this.target.removeAttr("title").data("title",this.text);}}this.destroy();this.target.data("tooltipId",tooltipId).off(eventNS);if(this.conf.selector){this.target.on(showEvent+eventNS,this.conf.selector,function(e){self.show.call(self,e,this);}).on("mouseleave"+eventNS,this.conf.selector,function(e){self.hide.call(self,e,this);}).on("destroyed"+eventNS,this.conf.selector,function(){self.destroy.call(self);});}else{this.target.on(showEvent+eventNS,function(e){self.show.call(self,e,this);}).on("mouseleave"+eventNS,function(e){self.hide.call(self,e,this);}).on("destroyed"+eventNS,function(){self.destroy.call(self);});}if(isIE){this.target.on("mousemove"+eventNS,this.conf.selector,function(e){self.show.call(self,e,this);});}if(this.ks_tooltip&&this.conf.dontHideOnTooltipHover===true){this.ks_tooltip.off(eventNS).on("mouseenter"+eventNS,function(e){self.dontHide.call(self,e,this);}).on("mouseleave"+eventNS,function(e){self.hide.call(self,e,this);});}return this;};KS_Tooltip.prototype.show=function(ev,el){var self=this;this.currentTarget=$(el);if(!this.ks_tooltip){this.text=this.currentTarget.data("title")||this.currentTarget.attr("title")||this.conf.text||"";this.currentTarget.removeAttr("title").data("title",this.text);if(!this.text){return;}this.ks_tooltip=$(_getHtml(this.tooltipId,this.text,this.conf.cls)).appendTo("body");this.ks_tooltip.data("ks_tooltip",this);if(this.ks_tooltip&&this.conf.dontHideOnTooltipHover===true){this.ks_tooltip.off(eventNS).on("mouseenter"+eventNS,function(e){self.dontHide.call(self,e,this);}).on("mouseleave"+eventNS,function(e){self.hide.call(self,e,this);});}if(isTouch){setTimeout(function(){self.body.on("click"+eventNS,function(e){var target=$(e.target);if(target.is(self.currentTarget)){return;}self.body.off(eventNS);self.hide.call(self,e,this);});},100);}}if(!this.ks_tooltip||!this.ks_tooltip.length){return;}if(this.ks_tooltip.is(":hidden")){this.ks_tooltip.stop(true).fadeTo(0,0).show();setTimeout(function(){self.align.call(self,self.currentTarget);},10);this.align(this.currentTarget).delay(this.conf.showDelay).fadeTo(this.animSpeed,1);}else{this.align(this.currentTarget).stop(true).fadeTo(this.animSpeed,1);}};KS_Tooltip.prototype.hide=function(){var self=this,animSpeed=(this.conf.dontHideOnTooltipHover?this.animSpeed+100:this.animSpeed);if(!this.ks_tooltip){return;}this.ks_tooltip.stop(true).fadeTo(animSpeed,0,function(){self.ks_tooltip.remove();self.ks_tooltip=null;});};KS_Tooltip.prototype.dontHide=function(){this.ks_tooltip.stop(true).fadeTo(0,1);};KS_Tooltip.prototype.align=function(el,keepOnScreen){if(!this||!this.ks_tooltip){return;}if(!el||!el.length||el.is(":hidden")){return this.ks_tooltip.hide();}var position=this.conf.position,targetOff=el.offset(),targetW=el.outerWidth(),targetH=el.outerHeight(),win={width:this.win.width(),height:this.win.height(),scrollLeft:this.doc.scrollLeft(),scrollTop:this.doc.scrollTop()},target={l:targetOff.left,t:targetOff.top,r:targetOff.left+targetW,b:targetOff.top+targetH,w:targetW,h:targetH},ks_tooltip={w:this.ks_tooltip.outerWidth(),h:this.ks_tooltip.outerHeight()},cls,isOnScreen;ks_tooltip.left=target.l+(target.w-ks_tooltip.w)/2;ks_tooltip.top=target.t+(target.h-ks_tooltip.h)/2;if(position==="default"||position==="auto"||keepOnScreen===true){ks_tooltip.left=target.l+(target.w-ks_tooltip.w)/2;ks_tooltip.top=target.t-ks_tooltip.h-this.targetDistance;position="";if(win.scrollTop>ks_tooltip.top){ks_tooltip.top=target.t+target.h+this.targetDistance;position+="b";}else{position+="t";}if(ks_tooltip.left<this.screenMargin+win.scrollLeft){ks_tooltip.left=this.screenMargin+win.scrollLeft;position+="r";}if(ks_tooltip.left+ks_tooltip.w+this.screenMargin-win.scrollLeft>win.width){ks_tooltip.left=win.width-ks_tooltip.w-this.screenMargin+win.scrollLeft;position+="l";if(ks_tooltip.left<target.l-ks_tooltip.w){ks_tooltip.left=target.l-ks_tooltip.w;}}}cls=["ks_tooltip",(this.conf.cls||""),"ks_tooltip-"+position[0]];switch(position[0]){case"t":ks_tooltip.top=target.t-ks_tooltip.h-this.targetDistance;break;case"b":ks_tooltip.top=target.b+this.targetDistance;break;case"l":ks_tooltip.left=target.l-ks_tooltip.w-this.targetDistance;break;case"r":ks_tooltip.left=target.r+this.targetDistance;break;}if(position[1]){cls.push("ks_tooltip-"+position[0]+position[1]);switch(position[1]){case"t":ks_tooltip.top=target.b-ks_tooltip.h-target.h/2+10;break;case"b":ks_tooltip.top=target.t+target.h/2-10;break;case"r":ks_tooltip.left=target.l+target.w/2-10;break;case"l":if(ks_tooltip.w<target.r){ks_tooltip.left=target.r-ks_tooltip.w-target.w/2+10;}break;}}this.ks_tooltip.attr("class",cls.join(" ")).css(ks_tooltip);if(this.conf.forcePosition!==true&&keepOnScreen!==true){isOnScreen=true;if(ks_tooltip.top+this.screenMargin<win.scrollTop){isOnScreen=false;}if(ks_tooltip.top+ks_tooltip.h+this.screenMargin-win.scrollTop>win.height){isOnScreen=false;}if(ks_tooltip.left<this.screenMargin+win.scrollLeft){isOnScreen=false;}if(ks_tooltip.left+ks_tooltip.w+this.screenMargin-win.scrollLeft>win.width){isOnScreen=false;}if(isOnScreen===false){return this.align(el,true);}}return this.ks_tooltip;};KS_Tooltip.prototype.destroy=function(){if(this.target&&this.target.length){this.target.off(".ks_tooltip").removeData("tooltipId");}if(this.ks_tooltip&&this.ks_tooltip.length){this.ks_tooltip.remove();}};$.fn.ks_tooltip=function(options){var target,tt,td,id;return $(this).each(function(){target=$(this);if(target.length){id=target.data("tooltipId");}if(id){tt=$("#"+id);}if(options==="_destroy"){if(tt&&tt.length){tt.remove();target.off(".ks_tooltip").removeData("tooltipId");}return;}else{if(options==="hide"){if(tt&&tt.length){td=tt.data("ks_tooltip");if(td&&td.hide){td.hide();}}return;}}tt=new KS_Tooltip(target,options);});};})(jQuery);(function($){var oldClean=jQuery.cleanData;$.cleanData=function(elems){for(var i=0,elem;elem=elems[i++];){$(elem).triggerHandler("destroyed");}oldClean(elems);};})(jQuery);(function(undefined){var moment,VERSION="2.8.3",globalScope=typeof global!=="undefined"?global:this,oldGlobalMoment,round=Math.round,hasOwnProperty=Object.prototype.hasOwnProperty,i,YEAR=0,MONTH=1,DATE=2,HOUR=3,MINUTE=4,SECOND=5,MILLISECOND=6,locales={},momentProperties=[],hasModule=(typeof module!=="undefined"&&module.exports),aspNetJsonRegex=/^\/?Date\((\-?\d+)/i,aspNetTimeSpanJsonRegex=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,isoDurationRegex=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,formattingTokens=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,localFormattingTokens=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,parseTokenOneOrTwoDigits=/\d\d?/,parseTokenOneToThreeDigits=/\d{1,3}/,parseTokenOneToFourDigits=/\d{1,4}/,parseTokenOneToSixDigits=/[+\-]?\d{1,6}/,parseTokenDigits=/\d+/,parseTokenWord=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,parseTokenTimezone=/Z|[\+\-]\d\d:?\d\d/gi,parseTokenT=/T/i,parseTokenTimestampMs=/[\+\-]?\d+(\.\d{1,3})?/,parseTokenOrdinal=/\d{1,2}/,parseTokenOneDigit=/\d/,parseTokenTwoDigits=/\d\d/,parseTokenThreeDigits=/\d{3}/,parseTokenFourDigits=/\d{4}/,parseTokenSixDigits=/[+-]?\d{6}/,parseTokenSignedNumber=/[+-]?\d+/,isoRegex=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,isoFormat="YYYY-MM-DDTHH:mm:ssZ",isoDates=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],isoTimes=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],parseTimezoneChunker=/([\+\-]|\d\d)/gi,proxyGettersAndSetters="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),unitMillisecondFactors={"Milliseconds":1,"Seconds":1000,"Minutes":60000,"Hours":3600000,"Days":86400000,"Months":2592000000,"Years":31536000000},unitAliases={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},camelFunctions={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},formatFunctions={},relativeTimeThresholds={s:45,m:45,h:22,d:26,M:11},ordinalizeTokens="DDD w W M D d".split(" "),paddedTokens="M D H h m s w W".split(" "),formatTokenFunctions={M:function(){return this.month()+1;},MMM:function(format){return this.localeData().monthsShort(this,format);},MMMM:function(format){return this.localeData().months(this,format);},D:function(){return this.date();},DDD:function(){return this.dayOfYear();},d:function(){return this.day();},dd:function(format){return this.localeData().weekdaysMin(this,format);},ddd:function(format){return this.localeData().weekdaysShort(this,format);},dddd:function(format){return this.localeData().weekdays(this,format);},w:function(){return this.week();},W:function(){return this.isoWeek();},YY:function(){return leftZeroFill(this.year()%100,2);},YYYY:function(){return leftZeroFill(this.year(),4);},YYYYY:function(){return leftZeroFill(this.year(),5);},YYYYYY:function(){var y=this.year(),sign=y>=0?"+":"-";return sign+leftZeroFill(Math.abs(y),6);},gg:function(){return leftZeroFill(this.weekYear()%100,2);},gggg:function(){return leftZeroFill(this.weekYear(),4);},ggggg:function(){return leftZeroFill(this.weekYear(),5);},GG:function(){return leftZeroFill(this.isoWeekYear()%100,2);},GGGG:function(){return leftZeroFill(this.isoWeekYear(),4);},GGGGG:function(){return leftZeroFill(this.isoWeekYear(),5);},e:function(){return this.weekday();},E:function(){return this.isoWeekday();},a:function(){return this.localeData().meridiem(this.hours(),this.minutes(),true);},A:function(){return this.localeData().meridiem(this.hours(),this.minutes(),false);},H:function(){return this.hours();},h:function(){return this.hours()%12||12;},m:function(){return this.minutes();},s:function(){return this.seconds();},S:function(){return toInt(this.milliseconds()/100);},SS:function(){return leftZeroFill(toInt(this.milliseconds()/10),2);},SSS:function(){return leftZeroFill(this.milliseconds(),3);},SSSS:function(){return leftZeroFill(this.milliseconds(),3);},Z:function(){var a=-this.zone(),b="+";if(a<0){a=-a;b="-";}return b+leftZeroFill(toInt(a/60),2)+":"+leftZeroFill(toInt(a)%60,2);},ZZ:function(){var a=-this.zone(),b="+";if(a<0){a=-a;b="-";}return b+leftZeroFill(toInt(a/60),2)+leftZeroFill(toInt(a)%60,2);},z:function(){return this.zoneAbbr();},zz:function(){return this.zoneName();},X:function(){return this.unix();},Q:function(){return this.quarter();}},deprecations={},lists=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];function dfl(a,b,c){switch(arguments.length){case 2:return a!=null?a:b;case 3:return a!=null?a:b!=null?b:c;default:throw new Error("Implement me");}}function hasOwnProp(a,b){return hasOwnProperty.call(a,b);}function defaultParsingFlags(){return{empty:false,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:false,invalidMonth:null,invalidFormat:false,userInvalidated:false,iso:false};}function printMsg(msg){if(moment.suppressDeprecationWarnings===false&&typeof console!=="undefined"&&console.warn){console.warn("Deprecation warning: "+msg);}}function deprecate(msg,fn){var firstTime=true;return extend(function(){if(firstTime){printMsg(msg);firstTime=false;}return fn.apply(this,arguments);},fn);}function deprecateSimple(name,msg){if(!deprecations[name]){printMsg(msg);deprecations[name]=true;}}function padToken(func,count){return function(a){return leftZeroFill(func.call(this,a),count);};}function ordinalizeToken(func,period){return function(a){return this.localeData().ordinal(func.call(this,a),period);};}while(ordinalizeTokens.length){i=ordinalizeTokens.pop();formatTokenFunctions[i+"o"]=ordinalizeToken(formatTokenFunctions[i],i);}while(paddedTokens.length){i=paddedTokens.pop();formatTokenFunctions[i+i]=padToken(formatTokenFunctions[i],2);}formatTokenFunctions.DDDD=padToken(formatTokenFunctions.DDD,3);function Locale(){}function Moment(config,skipOverflow){if(skipOverflow!==false){checkOverflow(config);}copyConfig(this,config);this._d=new Date(+config._d);}function Duration(duration){var normalizedInput=normalizeObjectUnits(duration),years=normalizedInput.year||0,quarters=normalizedInput.quarter||0,months=normalizedInput.month||0,weeks=normalizedInput.week||0,days=normalizedInput.day||0,hours=normalizedInput.hour||0,minutes=normalizedInput.minute||0,seconds=normalizedInput.second||0,milliseconds=normalizedInput.millisecond||0;this._milliseconds=+milliseconds+seconds*1000+minutes*60000+hours*3600000;this._days=+days+weeks*7;this._months=+months+quarters*3+years*12;this._data={};this._locale=moment.localeData();this._bubble();}function extend(a,b){for(var i in b){if(hasOwnProp(b,i)){a[i]=b[i];}}if(hasOwnProp(b,"toString")){a.toString=b.toString;}if(hasOwnProp(b,"valueOf")){a.valueOf=b.valueOf;}return a;}function copyConfig(to,from){var i,prop,val;if(typeof from._isAMomentObject!=="undefined"){to._isAMomentObject=from._isAMomentObject;}if(typeof from._i!=="undefined"){to._i=from._i;}if(typeof from._f!=="undefined"){to._f=from._f;}if(typeof from._l!=="undefined"){to._l=from._l;}if(typeof from._strict!=="undefined"){to._strict=from._strict;}if(typeof from._tzm!=="undefined"){to._tzm=from._tzm;}if(typeof from._isUTC!=="undefined"){to._isUTC=from._isUTC;}if(typeof from._offset!=="undefined"){to._offset=from._offset;}if(typeof from._pf!=="undefined"){to._pf=from._pf;}if(typeof from._locale!=="undefined"){to._locale=from._locale;}if(momentProperties.length>0){for(i in momentProperties){prop=momentProperties[i];val=from[prop];if(typeof val!=="undefined"){to[prop]=val;}}}return to;}function absRound(number){if(number<0){return Math.ceil(number);}else{return Math.floor(number);}}function leftZeroFill(number,targetLength,forceSign){var output=""+Math.abs(number),sign=number>=0;while(output.length<targetLength){output="0"+output;}return(sign?(forceSign?"+":""):"-")+output;}function positiveMomentsDifference(base,other){var res={milliseconds:0,months:0};res.months=other.month()-base.month()+(other.year()-base.year())*12;if(base.clone().add(res.months,"M").isAfter(other)){--res.months;}res.milliseconds=+other-+(base.clone().add(res.months,"M"));return res;}function momentsDifference(base,other){var res;other=makeAs(other,base);if(base.isBefore(other)){res=positiveMomentsDifference(base,other);}else{res=positiveMomentsDifference(other,base);res.milliseconds=-res.milliseconds;res.months=-res.months;}return res;}function createAdder(direction,name){return function(val,period){var dur,tmp;if(period!==null&&!isNaN(+period)){deprecateSimple(name,"moment()."+name+"(period, number) is deprecated. Please use moment()."+name+"(number, period).");tmp=val;val=period;period=tmp;}val=typeof val==="string"?+val:val;dur=moment.duration(val,period);addOrSubtractDurationFromMoment(this,dur,direction);return this;};}function addOrSubtractDurationFromMoment(mom,duration,isAdding,updateOffset){var milliseconds=duration._milliseconds,days=duration._days,months=duration._months;updateOffset=updateOffset==null?true:updateOffset;if(milliseconds){mom._d.setTime(+mom._d+milliseconds*isAdding);}if(days){rawSetter(mom,"Date",rawGetter(mom,"Date")+days*isAdding);}if(months){rawMonthSetter(mom,rawGetter(mom,"Month")+months*isAdding);}if(updateOffset){moment.updateOffset(mom,days||months);}}function isArray(input){return Object.prototype.toString.call(input)==="[object Array]";}function isDate(input){return Object.prototype.toString.call(input)==="[object Date]"||input instanceof Date;}function compareArrays(array1,array2,dontConvert){var len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0,i;for(i=0;i<len;i++){if((dontConvert&&array1[i]!==array2[i])||(!dontConvert&&toInt(array1[i])!==toInt(array2[i]))){diffs++;}}return diffs+lengthDiff;}function normalizeUnits(units){if(units){var lowered=units.toLowerCase().replace(/(.)s$/,"$1");units=unitAliases[units]||camelFunctions[lowered]||lowered;}return units;}function normalizeObjectUnits(inputObject){var normalizedInput={},normalizedProp,prop;for(prop in inputObject){if(hasOwnProp(inputObject,prop)){normalizedProp=normalizeUnits(prop);if(normalizedProp){normalizedInput[normalizedProp]=inputObject[prop];}}}return normalizedInput;}function makeList(field){var count,setter;if(field.indexOf("week")===0){count=7;setter="day";}else{if(field.indexOf("month")===0){count=12;setter="month";}else{return;}}moment[field]=function(format,index){var i,getter,method=moment._locale[field],results=[];if(typeof format==="number"){index=format;format=undefined;}getter=function(i){var m=moment().utc().set(setter,i);return method.call(moment._locale,m,format||"");};if(index!=null){return getter(index);}else{for(i=0;i<count;i++){results.push(getter(i));}return results;}};}function toInt(argumentForCoercion){var coercedNumber=+argumentForCoercion,value=0;if(coercedNumber!==0&&isFinite(coercedNumber)){if(coercedNumber>=0){value=Math.floor(coercedNumber);}else{value=Math.ceil(coercedNumber);}}return value;}function daysInMonth(year,month){return new Date(Date.UTC(year,month+1,0)).getUTCDate();}function weeksInYear(year,dow,doy){return weekOfYear(moment([year,11,31+dow-doy]),dow,doy).week;}function daysInYear(year){return isLeapYear(year)?366:365;}function isLeapYear(year){return(year%4===0&&year%100!==0)||year%400===0;}function checkOverflow(m){var overflow;if(m._a&&m._pf.overflow===-2){overflow=m._a[MONTH]<0||m._a[MONTH]>11?MONTH:m._a[DATE]<1||m._a[DATE]>daysInMonth(m._a[YEAR],m._a[MONTH])?DATE:m._a[HOUR]<0||m._a[HOUR]>23?HOUR:m._a[MINUTE]<0||m._a[MINUTE]>59?MINUTE:m._a[SECOND]<0||m._a[SECOND]>59?SECOND:m._a[MILLISECOND]<0||m._a[MILLISECOND]>999?MILLISECOND:-1;if(m._pf._overflowDayOfYear&&(overflow<YEAR||overflow>DATE)){overflow=DATE;}m._pf.overflow=overflow;}}function isValid(m){if(m._isValid==null){m._isValid=!isNaN(m._d.getTime())&&m._pf.overflow<0&&!m._pf.empty&&!m._pf.invalidMonth&&!m._pf.nullInput&&!m._pf.invalidFormat&&!m._pf.userInvalidated;if(m._strict){m._isValid=m._isValid&&m._pf.charsLeftOver===0&&m._pf.unusedTokens.length===0;}}return m._isValid;}function normalizeLocale(key){return key?key.toLowerCase().replace("_","-"):key;}function chooseLocale(names){var i=0,j,next,locale,split;while(i<names.length){split=normalizeLocale(names[i]).split("-");j=split.length;next=normalizeLocale(names[i+1]);next=next?next.split("-"):null;while(j>0){locale=loadLocale(split.slice(0,j).join("-"));if(locale){return locale;}if(next&&next.length>=j&&compareArrays(split,next,true)>=j-1){break;}j--;}i++;}return null;}function loadLocale(name){var oldLocale=null;if(!locales[name]&&hasModule){try{oldLocale=moment.locale();require("./locale/"+name);moment.locale(oldLocale);}catch(e){}}return locales[name];}function makeAs(input,model){return model._isUTC?moment(input).zone(model._offset||0):moment(input).local();}extend(Locale.prototype,{set:function(config){var prop,i;for(i in config){prop=config[i];if(typeof prop==="function"){this[i]=prop;}else{this["_"+i]=prop;}}},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(m){return this._months[m.month()];},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(m){return this._monthsShort[m.month()];},monthsParse:function(monthName){var i,mom,regex;if(!this._monthsParse){this._monthsParse=[];}for(i=0;i<12;i++){if(!this._monthsParse[i]){mom=moment.utc([2000,i]);regex="^"+this.months(mom,"")+"|^"+this.monthsShort(mom,"");this._monthsParse[i]=new RegExp(regex.replace(".",""),"i");}if(this._monthsParse[i].test(monthName)){return i;}}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(m){return this._weekdays[m.day()];},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(m){return this._weekdaysShort[m.day()];},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(m){return this._weekdaysMin[m.day()];},weekdaysParse:function(weekdayName){var i,mom,regex;if(!this._weekdaysParse){this._weekdaysParse=[];}for(i=0;i<7;i++){if(!this._weekdaysParse[i]){mom=moment([2000,1]).day(i);regex="^"+this.weekdays(mom,"")+"|^"+this.weekdaysShort(mom,"")+"|^"+this.weekdaysMin(mom,"");this._weekdaysParse[i]=new RegExp(regex.replace(".",""),"i");}if(this._weekdaysParse[i].test(weekdayName)){return i;}}},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},longDateFormat:function(key){var output=this._longDateFormat[key];if(!output&&this._longDateFormat[key.toUpperCase()]){output=this._longDateFormat[key.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(val){return val.slice(1);});this._longDateFormat[key]=output;}return output;},isPM:function(input){return((input+"").toLowerCase().charAt(0)==="p");},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(hours,minutes,isLower){if(hours>11){return isLower?"pm":"PM";}else{return isLower?"am":"AM";}},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(key,mom){var output=this._calendar[key];return typeof output==="function"?output.apply(mom):output;},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(number,withoutSuffix,string,isFuture){var output=this._relativeTime[string];return(typeof output==="function")?output(number,withoutSuffix,string,isFuture):output.replace(/%d/i,number);},pastFuture:function(diff,output){var format=this._relativeTime[diff>0?"future":"past"];return typeof format==="function"?format(output):format.replace(/%s/i,output);},ordinal:function(number){return this._ordinal.replace("%d",number);},_ordinal:"%d",preparse:function(string){return string;},postformat:function(string){return string;},week:function(mom){return weekOfYear(mom,this._week.dow,this._week.doy).week;},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate;}});function removeFormattingTokens(input){if(input.match(/\[[\s\S]/)){return input.replace(/^\[|\]$/g,"");}return input.replace(/\\/g,"");}function makeFormatFunction(format){var array=format.match(formattingTokens),i,length;for(i=0,length=array.length;i<length;i++){if(formatTokenFunctions[array[i]]){array[i]=formatTokenFunctions[array[i]];}else{array[i]=removeFormattingTokens(array[i]);}}return function(mom){var output="";for(i=0;i<length;i++){output+=array[i] instanceof Function?array[i].call(mom,format):array[i];}return output;};}function formatMoment(m,format){if(!m.isValid()){return m.localeData().invalidDate();}format=expandFormat(format,m.localeData());if(!formatFunctions[format]){formatFunctions[format]=makeFormatFunction(format);}return formatFunctions[format](m);}function expandFormat(format,locale){var i=5;function replaceLongDateFormatTokens(input){return locale.longDateFormat(input)||input;}localFormattingTokens.lastIndex=0;while(i>=0&&localFormattingTokens.test(format)){format=format.replace(localFormattingTokens,replaceLongDateFormatTokens);localFormattingTokens.lastIndex=0;i-=1;}return format;}function getParseRegexForToken(token,config){var a,strict=config._strict;switch(token){case"Q":return parseTokenOneDigit;case"DDDD":return parseTokenThreeDigits;case"YYYY":case"GGGG":case"gggg":return strict?parseTokenFourDigits:parseTokenOneToFourDigits;case"Y":case"G":case"g":return parseTokenSignedNumber;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return strict?parseTokenSixDigits:parseTokenOneToSixDigits;case"S":if(strict){return parseTokenOneDigit;}case"SS":if(strict){return parseTokenTwoDigits;}case"SSS":if(strict){return parseTokenThreeDigits;}case"DDD":return parseTokenOneToThreeDigits;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return parseTokenWord;case"a":case"A":return config._locale._meridiemParse;case"X":return parseTokenTimestampMs;case"Z":case"ZZ":return parseTokenTimezone;case"T":return parseTokenT;case"SSSS":return parseTokenDigits;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return strict?parseTokenTwoDigits:parseTokenOneOrTwoDigits;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return parseTokenOneOrTwoDigits;case"Do":return parseTokenOrdinal;default:a=new RegExp(regexpEscape(unescapeFormat(token.replace("\\","")),"i"));return a;}}function timezoneMinutesFromString(string){string=string||"";var possibleTzMatches=(string.match(parseTokenTimezone)||[]),tzChunk=possibleTzMatches[possibleTzMatches.length-1]||[],parts=(tzChunk+"").match(parseTimezoneChunker)||["-",0,0],minutes=+(parts[1]*60)+toInt(parts[2]);return parts[0]==="+"?-minutes:minutes;}function addTimeToArrayFromToken(token,input,config){var a,datePartArray=config._a;switch(token){case"Q":if(input!=null){datePartArray[MONTH]=(toInt(input)-1)*3;}break;case"M":case"MM":if(input!=null){datePartArray[MONTH]=toInt(input)-1;}break;case"MMM":case"MMMM":a=config._locale.monthsParse(input);if(a!=null){datePartArray[MONTH]=a;}else{config._pf.invalidMonth=input;}break;case"D":case"DD":if(input!=null){datePartArray[DATE]=toInt(input);}break;case"Do":if(input!=null){datePartArray[DATE]=toInt(parseInt(input,10));}break;case"DDD":case"DDDD":if(input!=null){config._dayOfYear=toInt(input);}break;case"YY":datePartArray[YEAR]=moment.parseTwoDigitYear(input);break;case"YYYY":case"YYYYY":case"YYYYYY":datePartArray[YEAR]=toInt(input);break;case"a":case"A":config._isPm=config._locale.isPM(input);break;case"H":case"HH":case"h":case"hh":datePartArray[HOUR]=toInt(input);break;case"m":case"mm":datePartArray[MINUTE]=toInt(input);break;case"s":case"ss":datePartArray[SECOND]=toInt(input);break;case"S":case"SS":case"SSS":case"SSSS":datePartArray[MILLISECOND]=toInt(("0."+input)*1000);break;case"X":config._d=new Date(parseFloat(input)*1000);break;case"Z":case"ZZ":config._useUTC=true;config._tzm=timezoneMinutesFromString(input);break;case"dd":case"ddd":case"dddd":a=config._locale.weekdaysParse(input);if(a!=null){config._w=config._w||{};config._w["d"]=a;}else{config._pf.invalidWeekday=input;}break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":token=token.substr(0,1);case"gggg":case"GGGG":case"GGGGG":token=token.substr(0,2);if(input){config._w=config._w||{};config._w[token]=toInt(input);}break;case"gg":case"GG":config._w=config._w||{};config._w[token]=moment.parseTwoDigitYear(input);}}function dayOfYearFromWeekInfo(config){var w,weekYear,week,weekday,dow,doy,temp;w=config._w;if(w.GG!=null||w.W!=null||w.E!=null){dow=1;doy=4;weekYear=dfl(w.GG,config._a[YEAR],weekOfYear(moment(),1,4).year);week=dfl(w.W,1);weekday=dfl(w.E,1);}else{dow=config._locale._week.dow;doy=config._locale._week.doy;weekYear=dfl(w.gg,config._a[YEAR],weekOfYear(moment(),dow,doy).year);week=dfl(w.w,1);if(w.d!=null){weekday=w.d;if(weekday<dow){++week;}}else{if(w.e!=null){weekday=w.e+dow;}else{weekday=dow;}}}temp=dayOfYearFromWeeks(weekYear,week,weekday,doy,dow);config._a[YEAR]=temp.year;config._dayOfYear=temp.dayOfYear;}function dateFromConfig(config){var i,date,input=[],currentDate,yearToUse;if(config._d){return;}currentDate=currentDateArray(config);if(config._w&&config._a[DATE]==null&&config._a[MONTH]==null){dayOfYearFromWeekInfo(config);}if(config._dayOfYear){yearToUse=dfl(config._a[YEAR],currentDate[YEAR]);if(config._dayOfYear>daysInYear(yearToUse)){config._pf._overflowDayOfYear=true;}date=makeUTCDate(yearToUse,0,config._dayOfYear);config._a[MONTH]=date.getUTCMonth();config._a[DATE]=date.getUTCDate();}for(i=0;i<3&&config._a[i]==null;++i){config._a[i]=input[i]=currentDate[i];}for(;i<7;i++){config._a[i]=input[i]=(config._a[i]==null)?(i===2?1:0):config._a[i];}config._d=(config._useUTC?makeUTCDate:makeDate).apply(null,input);if(config._tzm!=null){config._d.setUTCMinutes(config._d.getUTCMinutes()+config._tzm);}}function dateFromObject(config){var normalizedInput;if(config._d){return;}normalizedInput=normalizeObjectUnits(config._i);config._a=[normalizedInput.year,normalizedInput.month,normalizedInput.day,normalizedInput.hour,normalizedInput.minute,normalizedInput.second,normalizedInput.millisecond];dateFromConfig(config);}function currentDateArray(config){var now=new Date();if(config._useUTC){return[now.getUTCFullYear(),now.getUTCMonth(),now.getUTCDate()];}else{return[now.getFullYear(),now.getMonth(),now.getDate()];}}function makeDateFromStringAndFormat(config){if(config._f===moment.ISO_8601){parseISO(config);return;}config._a=[];config._pf.empty=true;var string=""+config._i,i,parsedInput,tokens,token,skipped,stringLength=string.length,totalParsedInputLength=0;tokens=expandFormat(config._f,config._locale).match(formattingTokens)||[];for(i=0;i<tokens.length;i++){token=tokens[i];parsedInput=(string.match(getParseRegexForToken(token,config))||[])[0];if(parsedInput){skipped=string.substr(0,string.indexOf(parsedInput));if(skipped.length>0){config._pf.unusedInput.push(skipped);}string=string.slice(string.indexOf(parsedInput)+parsedInput.length);totalParsedInputLength+=parsedInput.length;}if(formatTokenFunctions[token]){if(parsedInput){config._pf.empty=false;}else{config._pf.unusedTokens.push(token);}addTimeToArrayFromToken(token,parsedInput,config);}else{if(config._strict&&!parsedInput){config._pf.unusedTokens.push(token);}}}config._pf.charsLeftOver=stringLength-totalParsedInputLength;if(string.length>0){config._pf.unusedInput.push(string);}if(config._isPm&&config._a[HOUR]<12){config._a[HOUR]+=12;}if(config._isPm===false&&config._a[HOUR]===12){config._a[HOUR]=0;}dateFromConfig(config);checkOverflow(config);}function unescapeFormat(s){return s.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(matched,p1,p2,p3,p4){return p1||p2||p3||p4;});}function regexpEscape(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");}function makeDateFromStringAndArray(config){var tempConfig,bestMoment,scoreToBeat,i,currentScore;if(config._f.length===0){config._pf.invalidFormat=true;config._d=new Date(NaN);return;}for(i=0;i<config._f.length;i++){currentScore=0;tempConfig=copyConfig({},config);if(config._useUTC!=null){tempConfig._useUTC=config._useUTC;}tempConfig._pf=defaultParsingFlags();tempConfig._f=config._f[i];makeDateFromStringAndFormat(tempConfig);if(!isValid(tempConfig)){continue;}currentScore+=tempConfig._pf.charsLeftOver;currentScore+=tempConfig._pf.unusedTokens.length*10;tempConfig._pf.score=currentScore;if(scoreToBeat==null||currentScore<scoreToBeat){scoreToBeat=currentScore;bestMoment=tempConfig;}}extend(config,bestMoment||tempConfig);}function parseISO(config){var i,l,string=config._i,match=isoRegex.exec(string);if(match){config._pf.iso=true;for(i=0,l=isoDates.length;i<l;i++){if(isoDates[i][1].exec(string)){config._f=isoDates[i][0]+(match[6]||" ");break;}}for(i=0,l=isoTimes.length;i<l;i++){if(isoTimes[i][1].exec(string)){config._f+=isoTimes[i][0];break;}}if(string.match(parseTokenTimezone)){config._f+="Z";}makeDateFromStringAndFormat(config);}else{config._isValid=false;}}function makeDateFromString(config){parseISO(config);if(config._isValid===false){delete config._isValid;moment.createFromInputFallback(config);}}function map(arr,fn){var res=[],i;for(i=0;i<arr.length;++i){res.push(fn(arr[i],i));}return res;}function makeDateFromInput(config){var input=config._i,matched;if(input===undefined){config._d=new Date();}else{if(isDate(input)){config._d=new Date(+input);}else{if((matched=aspNetJsonRegex.exec(input))!==null){config._d=new Date(+matched[1]);}else{if(typeof input==="string"){makeDateFromString(config);}else{if(isArray(input)){config._a=map(input.slice(0),function(obj){return parseInt(obj,10);});dateFromConfig(config);}else{if(typeof(input)==="object"){dateFromObject(config);}else{if(typeof(input)==="number"){config._d=new Date(input);}else{moment.createFromInputFallback(config);}}}}}}}}function makeDate(y,m,d,h,M,s,ms){var date=new Date(y,m,d,h,M,s,ms);if(y<1970){date.setFullYear(y);}return date;}function makeUTCDate(y){var date=new Date(Date.UTC.apply(null,arguments));if(y<1970){date.setUTCFullYear(y);}return date;}function parseWeekday(input,locale){if(typeof input==="string"){if(!isNaN(input)){input=parseInt(input,10);}else{input=locale.weekdaysParse(input);if(typeof input!=="number"){return null;}}}return input;}function substituteTimeAgo(string,number,withoutSuffix,isFuture,locale){return locale.relativeTime(number||1,!!withoutSuffix,string,isFuture);}function relativeTime(posNegDuration,withoutSuffix,locale){var duration=moment.duration(posNegDuration).abs(),seconds=round(duration.as("s")),minutes=round(duration.as("m")),hours=round(duration.as("h")),days=round(duration.as("d")),months=round(duration.as("M")),years=round(duration.as("y")),args=seconds<relativeTimeThresholds.s&&["s",seconds]||minutes===1&&["m"]||minutes<relativeTimeThresholds.m&&["mm",minutes]||hours===1&&["h"]||hours<relativeTimeThresholds.h&&["hh",hours]||days===1&&["d"]||days<relativeTimeThresholds.d&&["dd",days]||months===1&&["M"]||months<relativeTimeThresholds.M&&["MM",months]||years===1&&["y"]||["yy",years];args[2]=withoutSuffix;args[3]=+posNegDuration>0;args[4]=locale;return substituteTimeAgo.apply({},args);}function weekOfYear(mom,firstDayOfWeek,firstDayOfWeekOfYear){var end=firstDayOfWeekOfYear-firstDayOfWeek,daysToDayOfWeek=firstDayOfWeekOfYear-mom.day(),adjustedMoment;if(daysToDayOfWeek>end){daysToDayOfWeek-=7;}if(daysToDayOfWeek<end-7){daysToDayOfWeek+=7;}adjustedMoment=moment(mom).add(daysToDayOfWeek,"d");return{week:Math.ceil(adjustedMoment.dayOfYear()/7),year:adjustedMoment.year()};}function dayOfYearFromWeeks(year,week,weekday,firstDayOfWeekOfYear,firstDayOfWeek){var d=makeUTCDate(year,0,1).getUTCDay(),daysToAdd,dayOfYear;d=d===0?7:d;weekday=weekday!=null?weekday:firstDayOfWeek;daysToAdd=firstDayOfWeek-d+(d>firstDayOfWeekOfYear?7:0)-(d<firstDayOfWeek?7:0);dayOfYear=7*(week-1)+(weekday-firstDayOfWeek)+daysToAdd+1;return{year:dayOfYear>0?year:year-1,dayOfYear:dayOfYear>0?dayOfYear:daysInYear(year-1)+dayOfYear};}function makeMoment(config){var input=config._i,format=config._f;config._locale=config._locale||moment.localeData(config._l);if(input===null||(format===undefined&&input==="")){return moment.invalid({nullInput:true});}if(typeof input==="string"){config._i=input=config._locale.preparse(input);}if(moment.isMoment(input)){return new Moment(input,true);}else{if(format){if(isArray(format)){makeDateFromStringAndArray(config);}else{makeDateFromStringAndFormat(config);}}else{makeDateFromInput(config);}}return new Moment(config);}moment=function(input,format,locale,strict){var c;if(typeof(locale)==="boolean"){strict=locale;locale=undefined;}c={};c._isAMomentObject=true;c._i=input;c._f=format;c._l=locale;c._strict=strict;c._isUTC=false;c._pf=defaultParsingFlags();return makeMoment(c);};moment.suppressDeprecationWarnings=false;moment.createFromInputFallback=deprecate("moment construction falls back to js Date. This is "+"discouraged and will be removed in upcoming major "+"release. Please refer to "+"https://github.com/moment/moment/issues/1407 for more info.",function(config){config._d=new Date(config._i);});function pickBy(fn,moments){var res,i;if(moments.length===1&&isArray(moments[0])){moments=moments[0];}if(!moments.length){return moment();}res=moments[0];for(i=1;i<moments.length;++i){if(moments[i][fn](res)){res=moments[i];}}return res;}moment.min=function(){var args=[].slice.call(arguments,0);return pickBy("isBefore",args);};moment.max=function(){var args=[].slice.call(arguments,0);return pickBy("isAfter",args);};moment.utc=function(input,format,locale,strict){var c;if(typeof(locale)==="boolean"){strict=locale;locale=undefined;}c={};c._isAMomentObject=true;c._useUTC=true;c._isUTC=true;c._l=locale;c._i=input;c._f=format;c._strict=strict;c._pf=defaultParsingFlags();return makeMoment(c).utc();};moment.unix=function(input){return moment(input*1000);};moment.duration=function(input,key){var duration=input,match=null,sign,ret,parseIso,diffRes;if(moment.isDuration(input)){duration={ms:input._milliseconds,d:input._days,M:input._months};}else{if(typeof input==="number"){duration={};if(key){duration[key]=input;}else{duration.milliseconds=input;}}else{if(!!(match=aspNetTimeSpanJsonRegex.exec(input))){sign=(match[1]==="-")?-1:1;duration={y:0,d:toInt(match[DATE])*sign,h:toInt(match[HOUR])*sign,m:toInt(match[MINUTE])*sign,s:toInt(match[SECOND])*sign,ms:toInt(match[MILLISECOND])*sign};}else{if(!!(match=isoDurationRegex.exec(input))){sign=(match[1]==="-")?-1:1;parseIso=function(inp){var res=inp&&parseFloat(inp.replace(",","."));return(isNaN(res)?0:res)*sign;};duration={y:parseIso(match[2]),M:parseIso(match[3]),d:parseIso(match[4]),h:parseIso(match[5]),m:parseIso(match[6]),s:parseIso(match[7]),w:parseIso(match[8])};}else{if(typeof duration==="object"&&("from" in duration||"to" in duration)){diffRes=momentsDifference(moment(duration.from),moment(duration.to));duration={};duration.ms=diffRes.milliseconds;duration.M=diffRes.months;}}}}}ret=new Duration(duration);if(moment.isDuration(input)&&hasOwnProp(input,"_locale")){ret._locale=input._locale;}return ret;};moment.version=VERSION;moment.defaultFormat=isoFormat;moment.ISO_8601=function(){};moment.momentProperties=momentProperties;moment.updateOffset=function(){};moment.relativeTimeThreshold=function(threshold,limit){if(relativeTimeThresholds[threshold]===undefined){return false;}if(limit===undefined){return relativeTimeThresholds[threshold];}relativeTimeThresholds[threshold]=limit;return true;};moment.lang=deprecate("moment.lang is deprecated. Use moment.locale instead.",function(key,value){return moment.locale(key,value);});moment.locale=function(key,values){var data;if(key){if(typeof(values)!=="undefined"){data=moment.defineLocale(key,values);}else{data=moment.localeData(key);}if(data){moment.duration._locale=moment._locale=data;}}return moment._locale._abbr;};moment.defineLocale=function(name,values){if(values!==null){values.abbr=name;if(!locales[name]){locales[name]=new Locale();}locales[name].set(values);moment.locale(name);return locales[name];}else{delete locales[name];return null;}};moment.langData=deprecate("moment.langData is deprecated. Use moment.localeData instead.",function(key){return moment.localeData(key);});moment.localeData=function(key){var locale;if(key&&key._locale&&key._locale._abbr){key=key._locale._abbr;}if(!key){return moment._locale;}if(!isArray(key)){locale=loadLocale(key);if(locale){return locale;}key=[key];}return chooseLocale(key);};moment.isMoment=function(obj){return obj instanceof Moment||(obj!=null&&hasOwnProp(obj,"_isAMomentObject"));};moment.isDuration=function(obj){return obj instanceof Duration;};for(i=lists.length-1;i>=0;--i){makeList(lists[i]);}moment.normalizeUnits=function(units){return normalizeUnits(units);};moment.invalid=function(flags){var m=moment.utc(NaN);if(flags!=null){extend(m._pf,flags);}else{m._pf.userInvalidated=true;}return m;};moment.parseZone=function(){return moment.apply(null,arguments).parseZone();};moment.parseTwoDigitYear=function(input){return toInt(input)+(toInt(input)>68?1900:2000);};extend(moment.fn=Moment.prototype,{clone:function(){return moment(this);},valueOf:function(){return +this._d+((this._offset||0)*60000);},unix:function(){return Math.floor(+this/1000);},toString:function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ");},toDate:function(){return this._offset?new Date(+this):this._d;},toISOString:function(){var m=moment(this).utc();if(0<m.year()&&m.year()<=9999){return formatMoment(m,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]");}else{return formatMoment(m,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]");}},toArray:function(){var m=this;return[m.year(),m.month(),m.date(),m.hours(),m.minutes(),m.seconds(),m.milliseconds()];},isValid:function(){return isValid(this);},isDSTShifted:function(){if(this._a){return this.isValid()&&compareArrays(this._a,(this._isUTC?moment.utc(this._a):moment(this._a)).toArray())>0;}return false;},parsingFlags:function(){return extend({},this._pf);},invalidAt:function(){return this._pf.overflow;},utc:function(keepLocalTime){return this.zone(0,keepLocalTime);},local:function(keepLocalTime){if(this._isUTC){this.zone(0,keepLocalTime);this._isUTC=false;if(keepLocalTime){this.add(this._dateTzOffset(),"m");}}return this;},format:function(inputString){var output=formatMoment(this,inputString||moment.defaultFormat);return this.localeData().postformat(output);},add:createAdder(1,"add"),subtract:createAdder(-1,"subtract"),diff:function(input,units,asFloat){var that=makeAs(input,this),zoneDiff=(this.zone()-that.zone())*60000,diff,output,daysAdjust;units=normalizeUnits(units);if(units==="year"||units==="month"){diff=(this.daysInMonth()+that.daysInMonth())*43200000;output=((this.year()-that.year())*12)+(this.month()-that.month());daysAdjust=(this-moment(this).startOf("month"))-(that-moment(that).startOf("month"));daysAdjust-=((this.zone()-moment(this).startOf("month").zone())-(that.zone()-moment(that).startOf("month").zone()))*60000;output+=daysAdjust/diff;if(units==="year"){output=output/12;}}else{diff=(this-that);output=units==="second"?diff/1000:units==="minute"?diff/60000:units==="hour"?diff/3600000:units==="day"?(diff-zoneDiff)/86400000:units==="week"?(diff-zoneDiff)/604800000:diff;}return asFloat?output:absRound(output);},from:function(time,withoutSuffix){return moment.duration({to:this,from:time}).locale(this.locale()).humanize(!withoutSuffix);},fromNow:function(withoutSuffix){return this.from(moment(),withoutSuffix);},calendar:function(time){var now=time||moment(),sod=makeAs(now,this).startOf("day"),diff=this.diff(sod,"days",true),format=diff<-6?"sameElse":diff<-1?"lastWeek":diff<0?"lastDay":diff<1?"sameDay":diff<2?"nextDay":diff<7?"nextWeek":"sameElse";return this.format(this.localeData().calendar(format,this));},isLeapYear:function(){return isLeapYear(this.year());},isDST:function(){return(this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone());},day:function(input){var day=this._isUTC?this._d.getUTCDay():this._d.getDay();if(input!=null){input=parseWeekday(input,this.localeData());return this.add(input-day,"d");}else{return day;}},month:makeAccessor("Month",true),startOf:function(units){units=normalizeUnits(units);switch(units){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0);}if(units==="week"){this.weekday(0);}else{if(units==="isoWeek"){this.isoWeekday(1);}}if(units==="quarter"){this.month(Math.floor(this.month()/3)*3);}return this;},endOf:function(units){units=normalizeUnits(units);return this.startOf(units).add(1,(units==="isoWeek"?"week":units)).subtract(1,"ms");},isAfter:function(input,units){units=normalizeUnits(typeof units!=="undefined"?units:"millisecond");if(units==="millisecond"){input=moment.isMoment(input)?input:moment(input);return +this>+input;}else{return +this.clone().startOf(units)>+moment(input).startOf(units);}},isBefore:function(input,units){units=normalizeUnits(typeof units!=="undefined"?units:"millisecond");if(units==="millisecond"){input=moment.isMoment(input)?input:moment(input);return +this<+input;}else{return +this.clone().startOf(units)<+moment(input).startOf(units);}},isSame:function(input,units){units=normalizeUnits(units||"millisecond");if(units==="millisecond"){input=moment.isMoment(input)?input:moment(input);return +this===+input;}else{return +this.clone().startOf(units)===+makeAs(input,this).startOf(units);}},min:deprecate("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(other){other=moment.apply(null,arguments);return other<this?this:other;}),max:deprecate("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(other){other=moment.apply(null,arguments);return other>this?this:other;}),zone:function(input,keepLocalTime){var offset=this._offset||0,localAdjust;if(input!=null){if(typeof input==="string"){input=timezoneMinutesFromString(input);}if(Math.abs(input)<16){input=input*60;}if(!this._isUTC&&keepLocalTime){localAdjust=this._dateTzOffset();}this._offset=input;this._isUTC=true;if(localAdjust!=null){this.subtract(localAdjust,"m");}if(offset!==input){if(!keepLocalTime||this._changeInProgress){addOrSubtractDurationFromMoment(this,moment.duration(offset-input,"m"),1,false);}else{if(!this._changeInProgress){this._changeInProgress=true;moment.updateOffset(this,true);this._changeInProgress=null;}}}}else{return this._isUTC?offset:this._dateTzOffset();}return this;},zoneAbbr:function(){return this._isUTC?"UTC":"";},zoneName:function(){return this._isUTC?"Coordinated Universal Time":"";},parseZone:function(){if(this._tzm){this.zone(this._tzm);}else{if(typeof this._i==="string"){this.zone(this._i);}}return this;},hasAlignedHourOffset:function(input){if(!input){input=0;}else{input=moment(input).zone();}return(this.zone()-input)%60===0;},daysInMonth:function(){return daysInMonth(this.year(),this.month());},dayOfYear:function(input){var dayOfYear=round((moment(this).startOf("day")-moment(this).startOf("year"))/86400000)+1;return input==null?dayOfYear:this.add((input-dayOfYear),"d");},quarter:function(input){return input==null?Math.ceil((this.month()+1)/3):this.month((input-1)*3+this.month()%3);},weekYear:function(input){var year=weekOfYear(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return input==null?year:this.add((input-year),"y");},isoWeekYear:function(input){var year=weekOfYear(this,1,4).year;return input==null?year:this.add((input-year),"y");},week:function(input){var week=this.localeData().week(this);return input==null?week:this.add((input-week)*7,"d");},isoWeek:function(input){var week=weekOfYear(this,1,4).week;return input==null?week:this.add((input-week)*7,"d");},weekday:function(input){var weekday=(this.day()+7-this.localeData()._week.dow)%7;return input==null?weekday:this.add(input-weekday,"d");},isoWeekday:function(input){return input==null?this.day()||7:this.day(this.day()%7?input:input-7);},isoWeeksInYear:function(){return weeksInYear(this.year(),1,4);},weeksInYear:function(){var weekInfo=this.localeData()._week;return weeksInYear(this.year(),weekInfo.dow,weekInfo.doy);},get:function(units){units=normalizeUnits(units);return this[units]();},set:function(units,value){units=normalizeUnits(units);if(typeof this[units]==="function"){this[units](value);}return this;},locale:function(key){var newLocaleData;if(key===undefined){return this._locale._abbr;}else{newLocaleData=moment.localeData(key);if(newLocaleData!=null){this._locale=newLocaleData;}return this;}},lang:deprecate("moment().lang() is deprecated. Use moment().localeData() instead.",function(key){if(key===undefined){return this.localeData();}else{return this.locale(key);}}),localeData:function(){return this._locale;},_dateTzOffset:function(){return Math.round(this._d.getTimezoneOffset()/15)*15;}});function rawMonthSetter(mom,value){var dayOfMonth;if(typeof value==="string"){value=mom.localeData().monthsParse(value);if(typeof value!=="number"){return mom;}}dayOfMonth=Math.min(mom.date(),daysInMonth(mom.year(),value));mom._d["set"+(mom._isUTC?"UTC":"")+"Month"](value,dayOfMonth);return mom;}function rawGetter(mom,unit){return mom._d["get"+(mom._isUTC?"UTC":"")+unit]();}function rawSetter(mom,unit,value){if(unit==="Month"){return rawMonthSetter(mom,value);}else{return mom._d["set"+(mom._isUTC?"UTC":"")+unit](value);}}function makeAccessor(unit,keepTime){return function(value){if(value!=null){rawSetter(this,unit,value);moment.updateOffset(this,keepTime);return this;}else{return rawGetter(this,unit);}};}moment.fn.millisecond=moment.fn.milliseconds=makeAccessor("Milliseconds",false);moment.fn.second=moment.fn.seconds=makeAccessor("Seconds",false);moment.fn.minute=moment.fn.minutes=makeAccessor("Minutes",false);moment.fn.hour=moment.fn.hours=makeAccessor("Hours",true);moment.fn.date=makeAccessor("Date",true);moment.fn.dates=deprecate("dates accessor is deprecated. Use date instead.",makeAccessor("Date",true));moment.fn.year=makeAccessor("FullYear",true);moment.fn.years=deprecate("years accessor is deprecated. Use year instead.",makeAccessor("FullYear",true));moment.fn.days=moment.fn.day;moment.fn.months=moment.fn.month;moment.fn.weeks=moment.fn.week;moment.fn.isoWeeks=moment.fn.isoWeek;moment.fn.quarters=moment.fn.quarter;moment.fn.toJSON=moment.fn.toISOString;function daysToYears(days){return days*400/146097;}function yearsToDays(years){return years*146097/400;}extend(moment.duration.fn=Duration.prototype,{_bubble:function(){var milliseconds=this._milliseconds,days=this._days,months=this._months,data=this._data,seconds,minutes,hours,years=0;data.milliseconds=milliseconds%1000;seconds=absRound(milliseconds/1000);data.seconds=seconds%60;minutes=absRound(seconds/60);data.minutes=minutes%60;hours=absRound(minutes/60);data.hours=hours%24;days+=absRound(hours/24);years=absRound(daysToYears(days));days-=absRound(yearsToDays(years));months+=absRound(days/30);days%=30;years+=absRound(months/12);months%=12;data.days=days;data.months=months;data.years=years;},abs:function(){this._milliseconds=Math.abs(this._milliseconds);this._days=Math.abs(this._days);this._months=Math.abs(this._months);this._data.milliseconds=Math.abs(this._data.milliseconds);this._data.seconds=Math.abs(this._data.seconds);this._data.minutes=Math.abs(this._data.minutes);this._data.hours=Math.abs(this._data.hours);this._data.months=Math.abs(this._data.months);this._data.years=Math.abs(this._data.years);return this;},weeks:function(){return absRound(this.days()/7);},valueOf:function(){return this._milliseconds+this._days*86400000+(this._months%12)*2592000000+toInt(this._months/12)*31536000000;},humanize:function(withSuffix){var output=relativeTime(this,!withSuffix,this.localeData());if(withSuffix){output=this.localeData().pastFuture(+this,output);}return this.localeData().postformat(output);},add:function(input,val){var dur=moment.duration(input,val);this._milliseconds+=dur._milliseconds;this._days+=dur._days;this._months+=dur._months;this._bubble();return this;},subtract:function(input,val){var dur=moment.duration(input,val);this._milliseconds-=dur._milliseconds;this._days-=dur._days;this._months-=dur._months;this._bubble();return this;},get:function(units){units=normalizeUnits(units);return this[units.toLowerCase()+"s"]();},as:function(units){var days,months;units=normalizeUnits(units);if(units==="month"||units==="year"){days=this._days+this._milliseconds/86400000;months=this._months+daysToYears(days)*12;return units==="month"?months:months/12;}else{days=this._days+yearsToDays(this._months/12);switch(units){case"week":return days/7+this._milliseconds/604800000;case"day":return days+this._milliseconds/86400000;case"hour":return days*24+this._milliseconds/3600000;case"minute":return days*24*60+this._milliseconds/60000;case"second":return days*24*60*60+this._milliseconds/1000;case"millisecond":return Math.floor(days*24*60*60*1000)+this._milliseconds;default:throw new Error("Unknown unit "+units);}}},lang:moment.fn.lang,locale:moment.fn.locale,toIsoString:deprecate("toIsoString() is deprecated. Please use toISOString() instead "+"(notice the capitals)",function(){return this.toISOString();}),toISOString:function(){var years=Math.abs(this.years()),months=Math.abs(this.months()),days=Math.abs(this.days()),hours=Math.abs(this.hours()),minutes=Math.abs(this.minutes()),seconds=Math.abs(this.seconds()+this.milliseconds()/1000);if(!this.asSeconds()){return"P0D";}return(this.asSeconds()<0?"-":"")+"P"+(years?years+"Y":"")+(months?months+"M":"")+(days?days+"D":"")+((hours||minutes||seconds)?"T":"")+(hours?hours+"H":"")+(minutes?minutes+"M":"")+(seconds?seconds+"S":"");},localeData:function(){return this._locale;}});moment.duration.fn.toString=moment.duration.fn.toISOString;function makeDurationGetter(name){moment.duration.fn[name]=function(){return this._data[name];};}for(i in unitMillisecondFactors){if(hasOwnProp(unitMillisecondFactors,i)){makeDurationGetter(i.toLowerCase());}}moment.duration.fn.asMilliseconds=function(){return this.as("ms");};moment.duration.fn.asSeconds=function(){return this.as("s");};moment.duration.fn.asMinutes=function(){return this.as("m");};moment.duration.fn.asHours=function(){return this.as("h");};moment.duration.fn.asDays=function(){return this.as("d");};moment.duration.fn.asWeeks=function(){return this.as("weeks");};moment.duration.fn.asMonths=function(){return this.as("M");};moment.duration.fn.asYears=function(){return this.as("y");};moment.locale("en",{ordinal:function(number){var b=number%10,output=(toInt(number%100/10)===1)?"th":(b===1)?"st":(b===2)?"nd":(b===3)?"rd":"th";return number+output;}});function makeGlobal(shouldDeprecate){if(typeof ender!=="undefined"){return;}oldGlobalMoment=globalScope.moment;if(shouldDeprecate){globalScope.moment=deprecate("Accessing Moment through the global scope is "+"deprecated, and will be removed in an upcoming "+"release.",moment);}else{globalScope.moment=moment;}}if(hasModule){module.exports=moment;}else{if(typeof define==="function"&&define.amd){define("moment",function(require,exports,module){if(module.config&&module.config()&&module.config().noGlobal===true){globalScope.moment=oldGlobalMoment;}return moment;});makeGlobal(true);}else{makeGlobal();}}}).call(this);if(typeof ksConfig==="undefined"){throw"There is no ksConfig.";}if(window.KS_Utils){throw"There is another instance of KS_Utils! Check JS includes.";}var KS_Utils=(function($){var log=function(msg){if(ksConfig.isDevMode){try{if(window.logOffline){window.logOffline.info(msg);}else{if(window.console){window.console.log(msg);}}}catch(ex){}}return false;};var currentTime=function(){return new Date().getTime();};var encodeForJS=function(value){if(!value||!value.replace){return value;}value=value.replace(/"/g,"&quot;").replace(/'/g,"&#39;");value=value.replace(/</g,"&#60;").replace(/>/g,"&#62;");return value;};var decodeFromJS=function(value){return value&&value.replace?value.replace(/(&quot;)/g,'"').replace(/(&#39;)/g,"'"):value;};var escapeForJQuery=function(value){if(!value||!value.replace){return value;}value=value.replace(/(&quot;)/g,"\\&quot;").replace(/(&#39;)/g,"\\&#39;").replace(/"/g,"\\&quot;").replace(/'/g,"\\&#39;");value=value.replace(/(&#60;)/g,"\\&#60;").replace(/(&#62;)/g,"\\&#62;").replace(/</g,"\\&#60;").replace(/>/g,"\\&#62;");return value;};var isValueExistsAndNotEmpty=function(value){return !(typeof value==="undefined"||value==null||$.trim(""+value).length==0);};var decodeHtmlEntities=function(str){var textArea=document.createElement("textarea");textArea.innerHTML=str;return textArea.value;};var isSmallScreen=function(){var body=$("body");try{return window.devicePixelRatio&&window.devicePixelRatio>1.3;}catch(ex){LQ_Utils.log("[ERROR] Cant resolve pixel ratio: "+ex);return false;}};var isWin7=function(){try{return window.appRoot&&window.appRoot.getPlatform()=="win7";}catch(ex){log("[ERROR] Cant check win7: "+ex);return false;}};var disableBrowserAutocomplete=function(){$("input:text").attr("autocomplete","off");};return{log:log,currentTime:currentTime,encodeForJS:encodeForJS,decodeFromJS:decodeFromJS,escapeForJQuery:escapeForJQuery,isValueExistsAndNotEmpty:isValueExistsAndNotEmpty,decodeHtmlEntities:decodeHtmlEntities,removeTags:decodeHtmlEntities,isSmallScreen:isSmallScreen,isWin7:isWin7,disableBrowserAutocomplete:disableBrowserAutocomplete};})(jQuery);if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=KS_Utils;}if(window.KS_ValueType){throw"There is another instance of KS_ValueType! Check JS includes.";}if(typeof ksConfig==="undefined"){throw"There is no ksConfig.";}if(typeof ksConfig.serverTimeZoneOffset==="undefined"){throw'"ksConfig.serverTimeZoneOffset" variable is not set.';}function ValueType(type,precision,decimalDivider,thousandDivider,dateFormat,prefix,suffix){this.type=type;this.precision=precision;this.decimalDivider=decimalDivider;this.thousandDivider=thousandDivider;this.dateFormat=dateFormat;this.prefix=prefix;this.suffix=suffix;}ValueType.prototype.toString=function(){return"Type: "+this.type+", DateFormat: "+this.dateFormat+", Prefix: >"+this.prefix+"<"+", Suffix: >"+this.suffix+"<";};ValueType.prototype.isDecimal=function(){return this.type?this.type==="NUMBER"||this.type==="PERCENT"||this.type==="AMOUNT":false;};ValueType.prototype.isNumber=function(){return this.type?this.type==="NUMBER_NATURAL"||this.isDecimal():false;};ValueType.prototype.isDate=function(){return this.type?this.type==="DATE":false;};ValueType.prototype.isText=function(){return this.type?this.type==="STRING"||this.type==="EMAIL":false;};var KS_ValueType=(function($){var NUMBER_REGEXP=new RegExp("^-?\\d+?$");var ONE_HOUR_MINUTE=60;Number.prototype.formatDouble=function(decPlaces,thouSeparator,decSeparator){var n=this,decPlaces=isNaN(decPlaces=Math.abs(decPlaces))?2:decPlaces,decSeparator=decSeparator==undefined?".":decSeparator,thouSeparator=thouSeparator==undefined?",":thouSeparator,sign=n<0?"-":"",i=parseInt(n=Math.abs(+n||0).toFixed(decPlaces))+"",j=(i.length>3)?i.length%3:0;return sign+(j?i.substr(0,j)+thouSeparator:"")+i.substr(j).replace(/(\d{3})(?=\d)/g,"$1"+thouSeparator)+(decPlaces?decSeparator+Math.abs(n-i).toFixed(decPlaces).slice(2):"");};var log=function(msg){if(ksConfig.isDevMode){try{if(window.logOffline){window.logOffline.info(msg);}else{if(window.console){window.console.log(msg);}}}catch(ex){}}return false;};var convertNumber=function(valueType,value){var num=Number(value);return num.formatDouble(0,valueType.thousandDivider,null);};var convertDouble=function(valueType,value){var num=Number(value);return num.formatDouble(valueType.precision,valueType.thousandDivider,valueType.decimalDivider);};var convertDate=function(valueType,value){var ms=Number(value);var date=convertToJulian(ms);var momentPattern=valueType.dateFormat.toUpperCase();var serverDate=moment(date);serverDate.zone(getServerTimeZoneOffsetMinute());if(serverDate.get("h")==23){serverDate.add(1,"h");}serverDate.set("h",0);serverDate.set("m",0);serverDate.set("s",0);serverDate.set("ms",0);log("[DATE -> TEXT] Convert: Local["+date.toString()+"] ->>> Server["+serverDate.format("YYYY-MM-DD HH:mm:ss.SSS Z")+"]. Value["+value+"], Format["+momentPattern+"]");return serverDate.format(momentPattern);};var isValueExistsAndNotEmpty=function(value){return !(typeof value==="undefined"||value==null||$.trim(""+value).length==0);};var convertValue=function(valueType,value){if(!isValueExistsAndNotEmpty(value)){return"";}if(valueType==null){return value;}var result;switch(valueType.type){case"NUMBER_NATURAL":result=convertNumber(valueType,value);break;case"NUMBER":case"PERCENT":case"AMOUNT":result=convertDouble(valueType,value);break;case"DATE":result=convertDate(valueType,value);break;default:result=value;break;}if(valueType.prefix!=null&&valueType.prefix.length>0){result=valueType.prefix+" "+result;}if(valueType.suffix!=null&&valueType.suffix.length>0){result=result+" "+valueType.suffix;}return result;};var convertToValue=function(valueType,value){var result;if(valueType!=null&&valueType.isNumber()){result=value.split(valueType.thousandDivider).join("");result=result.split(valueType.prefix).join("");result=result.split(valueType.suffix).join("");result=result.split(" ").join("");result=$.trim(result);var digitParts=result.split(valueType.decimalDivider);var partsCount=digitParts.length;if(partsCount>1){var fractionalPart=digitParts[partsCount-1];fractionalPart=fractionalPart.replace(/0+?$/g,"");digitParts[partsCount-1]=fractionalPart;if(fractionalPart.length==0){result=digitParts.join("");}else{result=digitParts.join(".");}}var pureNumber=result;var regexp=new RegExp("[\\d.+-]+","mi");if(regexp.test(result)){pureNumber=regexp.exec(result);}result=Number(pureNumber);log("Converted text to number: "+value+" > "+result);}else{if(valueType!=null&&valueType.isDate()){if(NUMBER_REGEXP.test(value)){result=value;log("[TEXT -> DATE] Text is already milliseconds: "+value);}else{var format=valueType.dateFormat.toUpperCase();var jsDate=moment(value,format).valueOf();if(jsDate<getJulianToGregorianSwitchTime()){var javaDate=convertToGregorian(jsDate).valueOf();log("[TEXT -> DATE] Date "+value+"(JS:"+jsDate+") converted to Java:"+javaDate+" // pattern: "+format);result=javaDate;}else{result=jsDate;}log("[TEXT -> DATE] Converted text to date: "+value+" / "+format+" > "+result);return result;}}else{result=value;}}return result;};var normalizeNumber=function(valueType,value){if(valueType==null||!valueType.isDecimal()){return value;}var num=Number(value);return num.toFixed(valueType.precision);};var getJulianToGregorianSwitchTime=function(){return -12219303600000;};var getLocalTimeZoneOffsetMinute=function(){return moment().zone();};var getServerTimeZoneOffsetMinute=function(){return -1*ksConfig.serverTimeZoneOffset;};var getServerTimeZoneOffsetForSQLite=function(){var offset=getServerTimeZoneOffsetMinute();return -1*dstFixMinute(offset);};var dstFixMinute=function(timeZoneOffsetMinuteJS){log("Fix DST Java/JS diff. Add 1 hour.");return timeZoneOffsetMinuteJS-ONE_HOUR_MINUTE;};var convertToJulian=function(ms){var date=new Date(ms);if(ms<getJulianToGregorianSwitchTime()){var jdn=getJulianDay(ms,false);date=getJulianDateByJDN(jdn,date.getUTCHours(),date.getUTCMinutes(),date.getUTCSeconds(),date.getUTCMilliseconds());}return date;};var convertToGregorian=function(ms){var date=new Date(ms);if(ms<getJulianToGregorianSwitchTime()){var jdn=getJulianDay(ms,true);date=getGregorianDateByJDN(jdn,date.getUTCHours(),date.getUTCMinutes(),date.getUTCSeconds(),date.getUTCMilliseconds());}return date;};var getJulianDay=function(ms,isJulian){var date=new Date(ms);var year=date.getUTCFullYear();var month=date.getUTCMonth()+1;var day=date.getUTCDate();var a=Math.floor((14-month)/12);var y=year+4800-a;var m=month+12*a-3;var n=day+Math.floor((153*m+2)/5)+365*y+Math.floor(y/4);var jdn;if(isJulian){jdn=n-32083;}else{jdn=n-Math.floor(y/100)+Math.floor(y/400)-32045;}return jdn;};var getJulianDateByJDN=function(jdn,hour,min,sec,ms){var c=jdn+32082;var d=Math.floor((4*c+3)/1461);var e=c-Math.floor((1461*d)/4);var m=Math.floor((5*e+2)/153);var jDay=e-Math.floor((153*m+2)/5)+1;var jMonth=m+3-12*Math.floor(m/10);var jYear=d-4800+Math.floor(m/10);return createDate(jYear,jMonth-1,jDay,hour,min,sec,ms);};var getGregorianDateByJDN=function(jdn,hour,min,sec,ms){var a=jdn+32044;var b=Math.floor((4*a+3)/146097);var c=a-Math.floor((146097*b)/4);var d=Math.floor((4*c+3)/1461);var e=c-Math.floor((1461*d)/4);var m=Math.floor((5*e+2)/153);var gDay=e-Math.floor((153*m+2)/5)+1;var gMonth=m+3-12*Math.floor(m/10);var gYear=100*b+d-4800+Math.floor(m/10);return createDate(gYear,gMonth-1,gDay,hour,min,sec,ms);};var createDate=function(year,month,day,hour,min,sec,ms){var date=new Date();date.setUTCFullYear(year);date.setUTCMonth(month);date.setUTCDate(day);date.setUTCHours(hour);date.setUTCMinutes(min);date.setUTCSeconds(sec);date.setUTCMilliseconds(ms);return date;};log("Value Types JS is successfully connected.");log("Server time zone: "+getServerTimeZoneOffsetMinute());log("Client time zone: "+getLocalTimeZoneOffsetMinute());return{convertValue:convertValue,convertToValue:convertToValue,normalizeNumber:normalizeNumber,getJulianToGregorianSwitchTime:getJulianToGregorianSwitchTime,getServerTimeZoneOffsetForSQLite:getServerTimeZoneOffsetForSQLite};})(jQuery);(function($){var root=this;if(!root.ks){root.ks={};}if(!root.ks.ui){root.ks.ui={};}var holdBody=function(hold){$("html").toggleClass("holdBodyForDialog",hold);};var dialogBody='<div class="placeWrap" id="messageDialog" style="display: none">'+'<div class="dialog">'+'<div class="dilHeader">'+'<span class="headerContent"></span>'+"</div>"+'<div class="dilCont">'+'<div class="textCont"></div>'+"</div>"+'<div class="formLine"></div>'+"</div>"+"</div>";var findDialog=function(){var $dialog=$("div#messageDialog");if($dialog.length===0){$dialog=$(dialogBody).appendTo("body");}return $dialog;};var preventScroll=function(e){e=e||window.event;if(e.preventDefault){e.preventDefault();}e.returnValue=false;};var disableScroll=function(){console.log("disableScroll");if(window.addEventListener){window.addEventListener("DOMMouseScroll",preventScroll,false);}window.onwheel=preventScroll;window.onmousewheel=document.onmousewheel=preventScroll;window.ontouchmove=preventScroll;document.onkeydown=preventDefaultForScrollKeys;};var enableScroll=function(){if(window.removeEventListener){window.removeEventListener("DOMMouseScroll",preventScroll,false);}window.onmousewheel=document.onmousewheel=null;window.onwheel=null;window.ontouchmove=null;document.onkeydown=null;};var preventDefaultForScrollKeys=function(e){if(keys&&keys[e.keyCode]){preventScroll(e);return false;}};var messageDialog=root.ks.ui.messageDialog=function(options){var $dialog=findDialog(),dHeader=$dialog.find(".dilHeader"),dCont=$dialog.find(".dilCont"),dFooter=$dialog.find(".formLine"),dContDial=$dialog.find(".dialog");if(typeof options==="object"){window.scrollFixModule.disableScroll();$dialog.find("div.textCont").html(options.messageText||"");$dialog.find("span.headerContent").html(options.headerText||"");$dialog.find(".formLine").empty();var firstBtn,lastBtn=null;if(options.buttons&&$.isArray(options.buttons)&&options.buttons.length>0){var firstTabIndex=10000;$.each(options.buttons,function(idx,buttonOptions){var b=$("<a/>");if(idx==0){firstBtn=b;}if(idx+1==options.buttons.length){lastBtn=b;}b.addClass("BTNoffline");b.addClass(buttonOptions.id);b.attr("tabindex",++firstTabIndex);b.html(buttonOptions.text);b.click(buttonOptions.handler);b.on("keypress",function(e){if(e.keyCode===13){buttonOptions.handler();}});$dialog.find(".formLine").append(b);});}if(options.beforeShow){options.beforeShow();}$dialog.show();if(firstBtn!=null){firstBtn.focus();}if(lastBtn!=null){lastBtn.on("focusout",function(){firstBtn.focus();});}if(options.afterShow){options.afterShow($dialog);}}else{if(typeof options==="string"){if(options==="close"){$dialog.hide();$dialog.find(".headerContent").empty();$dialog.find(".textCont").empty();$dialog.find(".formLine").empty();$dialog.removeClass("darkPopup");enableScroll();}else{if(options==="refresh"){dCont.css("height","auto").css("top","auto");dContDial.css("height","auto").css("margin-top","auto");dCont.css("top",dHeader.outerHeight());var popUpheight=(dHeader.outerHeight()+dCont.outerHeight()+dFooter.outerHeight()),winHeight=$(window).height();if(popUpheight>=winHeight){dCont.height(winHeight-200);popUpheight=(dHeader.outerHeight()+dCont.outerHeight()+dFooter.outerHeight());}var marginTop="-"+(popUpheight/2)+"px";dContDial.css("height",popUpheight).css("margin-top",marginTop);}}}}$(window).off("orientationchange.messageDialog").on("orientationchange.messageDialog",function(event){setTimeout(function(){messageDialog("refresh");},500);});};root.ks.ui.confirm=function(msg,title){var dfd=$.Deferred();var options={headerText:title,messageText:msg,afterShow:function(){messageDialog("refresh");},buttons:[{id:"okButton",text:window.fileUploadTranslations&&window.fileUploadTranslations.okButton?window.fileUploadTranslations.okButton:"OK",handler:function(){messageDialog("close");dfd.resolve();}},{id:"cancelButton",text:window.fileUploadTranslations&&window.fileUploadTranslations.cancelButton?window.fileUploadTranslations.cancelButton:"Cancel",handler:function(){messageDialog("close");dfd.reject();}}]};messageDialog(options);return dfd;};root.ks.ui.alert=function(msg,title){var dfd=$.Deferred();var options={headerText:title,messageText:msg,buttons:[{id:"okButton",text:window.fileUploadTranslations&&window.fileUploadTranslations.okButton?window.fileUploadTranslations.okButton:"OK",handler:function(){messageDialog("close");dfd.resolve();}}]};messageDialog(options);messageDialog("refresh");return dfd;};}).call(this,jQuery);(function($){if($.fn.loadingOn&&$.fn.loadingOff){return;}var keyAlreadyOff="loadingOff",keyPositionBeforeLoading="positionBeforeLoading",style="filter: alpha(opacity=80);opacity: 0.80;"+"position:absolute;left:0px;top:0px;z-index:10002;width:100%;height:100%;"+"background-color:#ffffff;",buildId=function(elemId){return"wl_"+elemId;},sunHtml=function(sunId){return'<div id="'+sunId+'" class="sunload" style="'+style+'">'+'<div id="LayerLoad" style="position:absolute;z-index:10002;left:48%;top:48%;">'+'<b class="sunloadImage" title="Loading..."></b>'+"</div>"+"</div>";},adjustPositionOnScreen=function(sunId,$container){var $sun=$("#"+sunId).find("div");if($sun.length==0){return;}var containerBoundingRect=$container[0].getBoundingClientRect(),viewPortTop=Math.max(0,containerBoundingRect.top),viewPortBottom=Math.min(window.innerHeight,containerBoundingRect.bottom),sunTop=(viewPortBottom-viewPortTop-$sun.outerHeight())/2+(containerBoundingRect.top<0?-containerBoundingRect.top:$(window).scrollTop());if(sunTop>0){$sun.css("top",sunTop+"px");}};$.fn.loadingOn=function(delay){var t=$(this),func=function(){if(!t.data(keyAlreadyOff)){var prevPos=t.css("position");t.data(keyPositionBeforeLoading,prevPos);if(prevPos!=="relative"&&prevPos!=="absolute"&&prevPos!=="fixed"){t.css("position","relative");}var elemId=t.attr("id");if(elemId){var sunId=buildId(elemId);if(!$("#"+sunId).length){t.append(sunHtml(sunId));adjustPositionOnScreen(sunId,t);}}}};t.removeData(keyAlreadyOff);if(delay){setTimeout(func,delay);}else{func();}return t;};$.fn.loadingOff=function(){var t=$(this);t.data(keyAlreadyOff,keyAlreadyOff);var prevPos=t.data(keyPositionBeforeLoading);t.css("position",prevPos);$("#"+buildId(t.attr("id"))).remove();return t;};})(jQuery);var SIMPLE_CALLOUT_DIV="simpleCalloutDiv";var j$=jQuery.noConflict();var currentElementSimpleCallout;var timeAfterClose=0;var mousePosSimpleCallout={posX:0,posY:0};var closeTimeoutSimpleCallout;var timeForShow=2000;var calloutOutTheObject=true;function simpleCalloutMouseOut(e){calloutOutTheObject=true;if(currentElementSimpleCallout){closeSimpleCallOutDiv();currentElementSimpleCallout=null;}}function simpleCalloutMouseMove(e){e=e||window.event;if(e.pageX||e.pageY){mousePosSimpleCallout.posX=e.pageX;mousePosSimpleCallout.posY=e.pageY;}if(e.clientX||e.clientY){mousePosSimpleCallout.posX=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;mousePosSimpleCallout.posY=e.clientY+document.body.scrollTop+document.documentElement.scrollTop;}}function simpleCalloutMouseOverByObject(e,obj,time){calloutOutTheObject=false;e=e||window.event;timeForShow=time;var divObject=document.getElementById("div"+obj.id);if(divObject!=null){simpleCalloutMouseOver(e,"",divObject.innerHTML);}divObject=null;}function simpleCalloutMouseOver(e,headerName,mainText,time){calloutOutTheObject=false;e=e||window.event;if(time){timeForShow=time;}var currentTime=new Date().getTime();if((currentTime-timeAfterClose)<200){return;}var div=j$("#"+SIMPLE_CALLOUT_DIV);var currentTarget=(e.target||e.srcElement);if(div!=null&&div.is(":visible")&&currentElementSimpleCallout==currentTarget){return;}currentElementSimpleCallout=currentTarget;var calloutHeaderName=(headerName==null?"":headerName);var calloutMainText=(mainText==null?"":mainText);if(div==null||div.length==0){initPipingCalloutDialog();}showSimpleCallout(calloutHeaderName,calloutMainText);currentTime=div=currentTarget=calloutHeaderName=calloutMainText=null;}function showSimpleCallout(headerName,mainText){showCalloutTimeout(headerName,mainText);}function setSimpleCalloutData(headerName,mainText){j$("#calloutHeaderSpan").html(headerName);j$("#calloutTextDiv").html(mainText);}function showCalloutTimeout(headerName,mainText){setTimeout(function(){showCalloutNearCursor(headerName,mainText);},500);}function showCalloutNearCursor(headerName,mainText){if(calloutOutTheObject){return;}setSimpleCalloutData(headerName,mainText);var tPosX=mousePosSimpleCallout.posX+"px";var tPosY=(mousePosSimpleCallout.posY+20)+"px";j$("#"+SIMPLE_CALLOUT_DIV).css({top:tPosY,left:tPosX}).show();closeSimpleCallOutDivTimeOut();tPosX=tPosY=null;}function initPipingCalloutDialog(){appendPipingCalloutDiv();}function appendPipingCalloutDiv(){j$("body").append(""+'<div style="border: 1px gray solid; display: none; z-index: 900; position: absolute; min-height:0;" id="'+SIMPLE_CALLOUT_DIV+'" class="flora ui-dialog-content calloutMainDiv">'+'<table cellpadding="3" cellspacing="0" bgcolor="white" >'+"<tbody>"+'<tr class="calloutHeaderTr">'+'<td align="left">'+'<span id="calloutHeaderSpan" style="padding-left:3px;"></span>'+"</td>"+'<td align="right">'+'<a id="pipingCalloutCloseElement" onclick="closeSimpleCallOutDiv();" class="pipingCalloutCloseA">X</a>'+"</td>"+"</tr>"+"<tr>"+'<td colspan="2">'+'<div id="calloutTextDiv" class="calloutTextDiv"></div>'+"</td>"+"</tr>"+"</tbody>"+"</table>"+"</div>");}function closeSimpleCallOutDiv(){timeAfterClose=new Date().getTime();j$("#"+SIMPLE_CALLOUT_DIV).hide();}function closeSimpleCallOutDivTimeOut(){if(closeTimeoutSimpleCallout!=null){clearTimeout(closeTimeoutSimpleCallout);}closeTimeoutSimpleCallout=setTimeout(function(){closeSimpleCallOutDiv();},timeForShow);}String.prototype.trim=function(){return this.leftTrim().rightTrim();};String.prototype.leftTrim=function(){return this.replace(/^\s*(.*)/,"$1");};String.prototype.rightTrim=function(){return this.replace(/^(.*\S)(\s*)$/,"$1");};function StringBuffer(){this.buffer=[];}StringBuffer.prototype.append=function append(string){this.buffer.push(string);return this;};StringBuffer.prototype.toString=function toString(){return this.buffer.join("");};var version=0;if(navigator.appVersion.indexOf("MSIE")!=-1){temp=navigator.appVersion.split("MSIE");version=parseFloat(temp[1]);}var is_IE=false;if(version>=5.5){is_IE=true;}function isPressedEnter(evt){try{if(is_IE){evt=window.event;try{if(evt!="undefined"&&evt.keyCode!="undefined"&&evt.keyCode==13){return true;}}catch(e){alert(e);}}else{event=evt;if(event!=null&&event!="undefined"&&event.keyCode!="undefined"&&event.keyCode==13){return true;}}}catch(e){alert(e);}return false;}function isPressedTab(evt){try{if(is_IE){evt=window.event;try{if(evt!=null&&evt!="undefined"&&evt.keyCode!="undefined"&&evt.keyCode==9){return true;}}catch(e){alert(e);}}else{event=evt;if(event!=null&&event!="undefined"&&event.keyCode!="undefined"&&event.keyCode==9){return true;}}}catch(e){alert(e);}return false;}function MM_HideLayer(name,hide){var obj=document.getElementById(name);if(obj!=null){var v=(hide)?"hidden":"visible";obj.style.visibility=v;}}function MM_swapImgRestore(){var i,x,a=document.MM_sr;for(i=0;a&&i<a.length&&(x=a[i])&&x.oSrc;i++){x.src=x.oSrc;}}function MM_findObj(n,d){var p,i,x;if(!d){d=document;}if((p=n.indexOf("?"))>0&&parent.frames.length){d=parent.frames[n.substring(p+1)].document;n=n.substring(0,p);}if(!(x=d[n])&&d.all){x=d.all[n];}for(i=0;!x&&i<d.forms.length;i++){x=d.forms[i][n];}for(i=0;!x&&d.layers&&i<d.layers.length;i++){x=MM_findObj(n,d.layers[i].document);}if(!x&&document.getElementById){x=document.getElementById(n);}return x;}function MM_swapImage(){var i,j=0,x,a=MM_swapImage.arguments;document.MM_sr=new Array;for(i=0;i<(a.length-2);i+=3){if((x=MM_findObj(a[i]))!=null){document.MM_sr[j++]=x;if(!x.oSrc){x.oSrc=x.src;}x.src=a[i+2];}}}BigNumber=function(n,p,r){var o=this,i;if(n instanceof BigNumber){for(i in {precision:0,roundType:0,_s:0,_f:0}){o[i]=n[i];}o._d=n._d.slice();return;}o.precision=isNaN(p=Math.abs(p))?BigNumber.defaultPrecision:p;o.roundType=isNaN(r=Math.abs(r))?BigNumber.defaultRoundType:r;o._s=(n+="").charAt(0)=="-";o._f=((n=n.replace(/[^\d.]/g,"").split(".",2))[0]=n[0].replace(/^0+/,"")||"0").length;for(i=(n=o._d=(n.join("")||"0").split("")).length;i;n[--i]=+n[i]){}o.round();};with({$:BigNumber,o:BigNumber.prototype}){$.ROUND_HALF_EVEN=($.ROUND_HALF_DOWN=($.ROUND_HALF_UP=($.ROUND_FLOOR=($.ROUND_CEIL=($.ROUND_DOWN=($.ROUND_UP=0)+1)+1)+1)+1)+1)+1;$.defaultPrecision=40;$.defaultRoundType=$.ROUND_HALF_UP;o.add=function(n){if(this._s!=(n=new BigNumber(n))._s){return n._s^=1,this.subtract(n);}var o=new BigNumber(this),a=o._d,b=n._d,la=o._f,lb=n._f,n=Math.max(la,lb),i,r;la!=lb&&((lb=la-lb)>0?o._zeroes(b,lb,1):o._zeroes(a,-lb,1));i=(la=a.length)==(lb=b.length)?a.length:((lb=la-lb)>0?o._zeroes(b,lb):o._zeroes(a,-lb)).length;for(r=0;i;r=(a[--i]=a[i]+b[i]+r)/10>>>0,a[i]%=10){}return r&&++n&&a.unshift(r),o._f=n,o.round();};o.subtract=function(n){if(this._s!=(n=new BigNumber(n))._s){return n._s^=1,this.add(n);}var o=new BigNumber(this),c=o.abs().compare(n.abs())+1,a=c?o:n,b=c?n:o,la=a._f,lb=b._f,d=la,i,j;a=a._d,b=b._d,la!=lb&&((lb=la-lb)>0?o._zeroes(b,lb,1):o._zeroes(a,-lb,1));for(i=(la=a.length)==(lb=b.length)?a.length:((lb=la-lb)>0?o._zeroes(b,lb):o._zeroes(a,-lb)).length;i;){if(a[--i]<b[i]){for(j=i;j&&!a[--j];a[j]=9){}--a[j],a[i]+=10;}b[i]=a[i]-b[i];}return c||(o._s^=1),o._f=d,o._d=b,o.round();};o.multiply=function(n){var o=new BigNumber(this),r=o._d.length>=(n=new BigNumber(n))._d.length,a=(r?o:n)._d,b=(r?n:o)._d,la=a.length,lb=b.length,x=new BigNumber,i,j,s;for(i=lb;i;r&&s.unshift(r),x.set(x.add(new BigNumber(s.join(""))))){for(s=(new Array(lb- --i)).join("0").split(""),r=0,j=la;j;r+=a[--j]*b[i],s.unshift(r%10),r=(r/10)>>>0){}}return o._s=o._s!=n._s,o._f=((r=la+lb-o._f-n._f)>=(j=(o._d=x._d).length)?this._zeroes(o._d,r-j+1,1).length:j)-r,o.round();};o.divide=function(n){if((n=new BigNumber(n))=="0"){throw new Error("Division by 0");}else{if(this=="0"){return new BigNumber;}}var o=new BigNumber(this),a=o._d,b=n._d,la=a.length-o._f,lb=b.length-n._f,r=new BigNumber,i=0,j,s,l,f=1,c=0,e=0;r._s=o._s!=n._s,r.precision=Math.max(o.precision,n.precision),r._f=+r._d.pop(),la!=lb&&o._zeroes(la>lb?b:a,Math.abs(la-lb));n._f=b.length,b=n,b._s=false,b=b.round();for(n=new BigNumber;a[0]=="0";a.shift()){}out:do{for(l=c=0,n=="0"&&(n._d=[],n._f=0);i<a.length&&n.compare(b)==-1;++i){(l=i+1==a.length,(!f&&++c>1||(e=l&&n=="0"&&a[i]=="0")))&&(r._f==r._d.length&&++r._f,r._d.push(0));(a[i]=="0"&&n=="0")||(n._d.push(a[i]),++n._f);if(e){break out;}if((l&&n.compare(b)==-1&&(r._f==r._d.length&&++r._f,1))||(l=0)){while(r._d.push(0),n._d.push(0),++n._f,n.compare(b)==-1){}}}if(f=0,n.compare(b)==-1&&!(l=0)){while(l?r._d.push(0):l=1,n._d.push(0),++n._f,n.compare(b)==-1){}}for(s=new BigNumber,j=0;n.compare(y=s.add(b))+1&&++j;s.set(y)){}n.set(n.subtract(s)),!l&&r._f==r._d.length&&++r._f,r._d.push(j);}while((i<a.length||n!="0")&&(r._d.length-r._f)<=r.precision);return r.round();};o.mod=function(n){return this.subtract(this.divide(n).intPart().multiply(n));};o.pow=function(n){var o=new BigNumber(this),i;if((n=(new BigNumber(n)).intPart())==0){return o.set(1);}for(i=Math.abs(n);--i;o.set(o.multiply(this))){}return n<0?o.set((new BigNumber(1)).divide(o)):o;};o.set=function(n){return this.constructor(n),this;};o.compare=function(n){var a=this,la=this._f,b=new BigNumber(n),lb=b._f,r=[-1,1],i,l;if(a._s!=b._s){return a._s?-1:1;}if(la!=lb){return r[(la>lb)^a._s];}for(la=(a=a._d).length,lb=(b=b._d).length,i=-1,l=Math.min(la,lb);++i<l;){if(a[i]!=b[i]){return r[(a[i]>b[i])^a._s];}}return la!=lb?r[(la>lb)^a._s]:0;};o.negate=function(){var n=new BigNumber(this);return n._s^=1,n;};o.abs=function(){var n=new BigNumber(this);return n._s=0,n;};o.intPart=function(){return new BigNumber((this._s?"-":"")+(this._d.slice(0,this._f).join("")||"0"));};o.valueOf=o.toString=function(){var o=this;return(o._s?"-":"")+(o._d.slice(0,o._f).join("")||"0")+(o._f!=o._d.length?"."+o._d.slice(o._f).join(""):"");};o._zeroes=function(n,l,t){var s=["push","unshift"][t||0];for(++l;--l;n[s](0)){}return n;};o.round=function(){if("_rounding" in this){return this;}var $=BigNumber,r=this.roundType,b=this._d,d,p,n,x;for(this._rounding=true;this._f>1&&!b[0];--this._f,b.shift()){}for(d=this._f,p=this.precision+d,n=b[p];b.length>d&&!b[b.length-1];b.pop()){}x=(this._s?"-":"")+(p-d?"0."+this._zeroes([],p-d-1).join(""):"")+1;if(b.length>p){n&&(r==$.DOWN?false:r==$.UP?true:r==$.CEIL?!this._s:r==$.FLOOR?this._s:r==$.HALF_UP?n>=5:r==$.HALF_DOWN?n>5:r==$.HALF_EVEN?n>=5&&b[p-1]&1:false)&&this.add(x);b.splice(p,b.length-p);}return delete this._rounding,this;};}var isValidClickSubmit=false;var isValidClickBackNext=false;var isValidInverseSelectGoTo=false;var isValidClickGo=false;var questionForms=[];var showBeforeAlert=true;var noScrollBrowser=false;var scrollToQuestion=null;var debug=false;var _current_form=null;var validationErrorHighliteElements=[];var validationError3dAllRows=[];var validationErrorElement=null;var validationErrorAlert=null;var isPreviewMode=false;var selTN="SELECT";var inpTN="INPUT";var j$=jQuery.noConflict();j$.fn.switchClass1=function(cOld,cNew){j$(this).removeClass(cOld).addClass(cNew);};function scrollToSomeQuestion(){var sname=scrollToQuestion;if(sname==null||sname.length==0){return;}if(sname.charAt(0)=="#"){sname=sname.substring(1);}var elem=document.getElementById(sname);if(elem==null){return;}if(sname.charAt(0)=="Q"){var labelName="QuestionLabel"+sname.substring(1);var labelElem=document.getElementById(labelName);if(labelElem!=null){labelElem.focus();}}window.location.hash=sname;}function disableShowBeforeAlert(){showBeforeAlert=false;}function getShowBeforeAlert(){return showBeforeAlert;}function fillForms(){if(document.theForm==null||(questionForms!=null&&questionForms.length>0)){return;}var documentForms=document.forms;var documentFormsLength=documentForms.length;for(var j=0;j<documentFormsLength;j++){var currForm=documentForms[j];for(var i=0;i<currForm.length;i++){var elem=currForm[i];var qid=findQID(elem.name);if(qid<=0){continue;}var form=questionForms[qid];if(form==null||form.length==0){form=[];questionForms[qid]=form;}form[form.length]=elem;}}}function findForm(frm_name){if(questionForms.length==0){fillForms();}var index=0;var questionString="Question";if(frm_name.indexOf(questionString)==0){index=parseInt(frm_name.substring(questionString.length));}isNaN(index)&&alert("findForm("+frm_name+"),\n index==isNaN <= "+frm_name.substring(questionString.length));var arr=questionForms[index];return(arr==null||arr.length==0)?[]:arr;}function openLink(uri){if(uri!=null&&uri.length>0){var windowname="new"+(Math.round(Math.random()*1000000));OpenWindow=window.open(uri,windowname,"");if(OpenWindow.focus){OpenWindow.focus();}}}function removeLeadingZeroes(text){text=""+text;text=j$.trim(text);var negative=(text.indexOf("-")==0);while(text.indexOf("-")==0){text=text.substring(1);}if(text!=null&&text.length>0){if(text.search("^0+$")==0){return"0";}var result=text.replace(/^(0+)(.*)$/,"$2");if(result==null||result.length==0){return"0";}if(result.indexOf(".")==0){result="0"+result;}if(negative){result="-"+result;}if(result==0){result="0";}return result;}return(negative)?"0":"";}function transform(sometext){var i=0;var transformedtext="";if(sometext!=null&&sometext.length>0){while(i<sometext.length){if(sometext.charCodeAt(i)==39){transformedtext+="&#39;";}else{if(sometext.charCodeAt(i)==38){transformedtext+="&#38;";}else{transformedtext+=sometext.charAt(i);}}i++;}}return transformedtext;}function findQID(name){if(name==null||name.length==0){return"0";}var qid=name.replace(/(R|other|total)(\d+)(_\d+(_\d+)?)?/,"$2");var intQID=parseInt(qid);if(isNaN(intQID)){return 0;}return intQID;}function findAID(name){if(name==null||name.length==0){return 0;}var aid=name.replace(/[a-z]+\d+(_(\d+)(_\d+)?)?/i,"$2");var intAID=parseInt(aid);if(isNaN(intAID)){return 0;}return intAID;}function processRadio(a,doDrop,nativeClick){var ja=j$(a);if(ja.is(":radio")){if(doDrop&&ja.data("tallinn")){ja.removeAttr("checked");ja.data("tallinn",false);var elm=getTextForRadio(a);if(elm){elm.value="";}ja.change();}else{var inputElements=j$('input[name="'+ja.attr("name")+'"]');inputElements.data("tallinn",false);ja.attr("checked",true);ja.data("tallinn",true);if(!nativeClick){ja.change();}}}if(ja.is(":checkbox")){if(!nativeClick){ja.change();}}}function moveRadio(form_name,name,value,fromOther,isRadio,obj,eventSource){if(name!=null&&value!=null){var i=0;var frm=findForm(form_name);while(i<frm.length){var frmElem=frm[i];if(obj!=null&&frmElem.form.name!=obj.form.name){i++;continue;}if(frmElem!=null&&frmElem.name!=null&&frmElem.name.indexOf(name)==0&&frmElem.value==value&&(obj==null||frmElem.form.name==obj.form.name)){var checkedBefore=frmElem.checked;var checkedManualy=j$(obj).data("checkedManualy");if(fromOther){if(isRadio||(eventSource&&((eventSource=="blur"||eventSource=="keyUp")&&!checkedManualy))||!checkedBefore){frmElem.checked=obj.value.length>0;}}else{if(!isRadio&&frmElem.checked){frmElem.checked=false;}else{frmElem.checked=obj.value.length>0;}}processRadio(frmElem,!fromOther);}i++;}}}var formQuestions=[];function fillFormQuestions(){if(formQuestions["theForm"]!=null){return;}var documentForms=document.forms;var generalFormQuestions=[];fillFormQuestionsArrayByForm(documentForms[0],generalFormQuestions);formQuestions[documentForms[0].name]=generalFormQuestions;for(var i=1;i<documentForms.length;i++){var subjectFormQuestions=[];fillFormQuestionsArrayByForm(documentForms[i],subjectFormQuestions);formQuestions[documentForms[i].name]=subjectFormQuestions;}}function fillFormQuestionsArrayByForm(form,array){var elems=form.elements;for(var i=0;i<elems.length;i++){var foundQid=findQID(elems[i].name);if(!isNaN(foundQid)&&foundQid>0){var questionElements=array[foundQid];if(questionElements==null){questionElements=[];}questionElements.push(elems[i]);array[foundQid]=questionElements;}}}function findQuestionElementsOnForm(QID,currentForm){fillFormQuestions();var formName;if(currentForm==null){formName="theForm";}else{formName=currentForm.name;}var questionsArray=formQuestions[formName];if(questionsArray==null){return[];}else{if(questionsArray[QID]==null){return[];}return questionsArray[QID];}}function validateOtherState(QID,qtext){var frm=findQuestionElementsOnForm(QID,_current_form);var AID=0;var elementOther;var elementsExceptOther=[];for(var i=0;i<frm.length;i++){var elem=frm[i];var answerId;if(elem.name.indexOf("other"+QID)==0){answerId=findAID(elem.name);if(isNaN(answerId)||answerId<=0){continue;}AID=answerId;elementOther=elem;}else{answerId=elem.value;elementsExceptOther[answerId]=elem;}}if(elementOther!=null&&elementOther.value.length==0){var elementNearOther=elementsExceptOther[AID];if(elementNearOther!=null&&elementNearOther.checked){beforeSubmitErrorAlert(qtext,elementOther,QID,AID);return false;}}return true;}function validateDependent3DMatrix(QID,qtext,isRequired,isPreferred,hasQText){if(isRequired&&!validateRequiredGeneral(QID,qtext,hasQText)){return false;}var queData=window.survData.questionsMap[QID];if(queData==null){return true;}for(var i=0;i<queData.answersSorted.length;i++){var ansId=queData.answersSorted[i];if(!showHideModule.isVisibleAnswer(ansId,QID)){continue;}var tokenResult=votingResultsModule.getVotingResult(QID,ansId,null,null);if(tokenResult==null){pleaseAnswerAllRowsErrorAlert(hasQText,qtext,j$(null),QID);return false;}}return true;}function addElementForHighlite3dMatrixAllRows(form,QID){var highliteTdElement=findElementForHiglite(form,QID);if(highliteTdElement!=null){validationError3dAllRows.push(highliteTdElement);}}function getAnswer(text){return text.replace(/other\d+_(\d+)(_.*)?/i,"$1");}function checkMandatoryAnswersNormal(qid,aids,aTexts){var error=false;var visibleTextForReaction=[];var unanswerdAids=[];for(var i=0;i<aids.length;i++){var aid=aids[i];var answered=(votingResultsModule.getVotingResult(qid,aid,null)!=null);if(!answered){error=true;visibleTextForReaction.push(aTexts[aid]);unanswerdAids.push(aid);}}if(error){reactionOnMandatoryAnswerError(qid,unanswerdAids,visibleTextForReaction);}return error;}function checkMandatoryAnswers360Internal(formsContext,qid,aids,aTexts){var error=false;var visibleTextForReaction=[];var unanswerdAids=[];for(var i=0;i<aids.length;i++){var aid=aids[i];var answered=true;formsContext.each(function(){answered&=checkMandatoryAnswered(qid,aid,j$(this));});if(!answered){error=true;visibleTextForReaction.push(aTexts[aid]);unanswerdAids.push(aid);}}if(error){reactionOnMandatoryAnswerError(qid,unanswerdAids,aTexts);}return error;}function checkMandatoryAnswers360(formsContext,qid,aids,aTexts){return isQuestionInGeneralSection(qid)?checkMandatoryAnswers360Internal(getFormFromCache("theForm"),qid,aids,aTexts):checkMandatoryAnswers360Internal(formsContext,qid,aids,aTexts);}function checkMandatoryAnswers(qid,aids,aTexts){if(!isCheckErrorsFromAllPages()&&!isQuestionExistInForm(qid,_current_form)){return false;}if(showHideModule&&!showHideModule.isVisibleQuestion(qid)){return false;}var visibleAnswers=_filterVisibleAnswers(qid,aids);if(!visibleAnswers||visibleAnswers.length===0){return false;}var trForms=j$("tr.trWithRespInputs");removeMarkupMandatoryAnswer();removeMarkupAnswer();return trForms.length?checkMandatoryAnswers360(trForms,qid,visibleAnswers,aTexts):checkMandatoryAnswersNormal(qid,visibleAnswers,aTexts);}function _filterVisibleAnswers(qid,aids){if(aids){return window._.filter(aids,function(aid){return showHideModule.isVisibleAnswer(aid,qid);});}return null;}function checkMandatoryAnswered(qid,aid,context){var tokenResult=votingResultsModule.getVotingResult(qid,aid,null,null);var answered=(tokenResult!=null);var jAnswerTr=context?j$("[id^='AnswerElementTd"+qid+"_"+aid+"']",context):j$("#AnswerElementTd"+qid+"_"+aid);return markupMandatoryAnswer(jAnswerTr,answered);}function markupMandatoryAnswer(jElem,answerState){if(answerState){jElem.switchClass1("MandatoryAnswerError","MandatoryAnswerNormal");}else{jElem.switchClass1("MandatoryAnswerNormal","MandatoryAnswerError");}return answerState;}function markupMustAnswer(jElem){var stopIterator=false;if(!jElem){return stopIterator;}var tagName=jElem.prop("tagName").toLowerCase();if(tagName=="input"){var typeProp=jElem.prop("type").toLowerCase();if(typeProp=="radio"||typeProp=="checkbox"){jElem.parent().addClass("MustAnswerError");}else{if(jElem.hasClass("inputUploadFile")){j$("input:file",jElem.parent()).addClass("MustAnswerError");}else{jElem.addClass("MustAnswerError");}}}else{if(tagName=="option"){stopIterator=true;jElem.parent().parent().addClass("MustAnswerError");}else{if(tagName=="select"){stopIterator=true;jElem.parent().addClass("MustAnswerError");}else{if(tagName=="textarea"){stopIterator=true;jElem.addClass("MustAnswerError");}else{if(tagName=="div"){jElem.addClass("MustAnswerError");}else{if(tagName=="fieldset"){jElem.addClass("MustAnswerError");}else{if(tagName=="tr"){jElem.addClass("MustAnswerErrorTr");}}}}}}}return stopIterator;}function checkMustAnswerAllFields3D(qid,aids,qtext){var trForms=j$("tr[id^='trForm']");if(trForms.length){var answered=true;trForms.each(function(){answered&=checkAnsweredAllFields3DFull(qid,aids);});if(!answered){reactionOnErrorMustAnswerAllFields3D(qid,qtext);return true;}}else{if(!checkAnsweredAllFields3DFull(qid,aids)){reactionOnErrorMustAnswerAllFields3D(qid,qtext);return true;}}return false;}function checkAnsweredAllFields3DFull(qid,aids){var res=true;for(var i=0;i<aids.length;i++){if(!showHideModule.isVisibleAnswer(aids[i],qid)){continue;}res&=checkAnsweredAllFields3D(j$("[name*='"+qid+"_"+aids[i]+"']"));}return res;}function checkAnsweredAllFields3D(jAnswer){var answered=true;var answeredPickOne=false;var hasPickOne=false;var jPickOneParents=[];jAnswer.each(function(){var jThis=j$(this);var jParent=j$(this.parentNode);var tagName=this.tagName.toUpperCase();if(tagName==selTN){answered&=markupMustAnswerAllFields3D(jParent,(j$.trim(jThis.val()).length>0));}else{var type=jThis.attr("type");if(type){type=type.toLowerCase();}if(type=="radio"){hasPickOne=true;jPickOneParents.push(jParent);answeredPickOne|=jThis.is(":checked");}else{answered&=markupMustAnswerAllFields3D(jParent,(j$.trim(jThis.val()).length>0));}}});if(hasPickOne){answered&=markupMustAnswerAllFields3DPickOne(jPickOneParents,answeredPickOne);}return answered;}function markupMustAnswerAllFields3DPickOne(jParents,answerState){j$.each(jParents,function(){markupMustAnswerAllFields3D(this,answerState);});return answerState;}function markupMustAnswerAllFields3D(jParentElem,answerState){if(answerState){jParentElem.switchClass1("MustAnswerAllFields3DError","MustAnswerAllFields3DNormal");}else{jParentElem.switchClass1("MustAnswerAllFields3DNormal","MustAnswerAllFields3DError");}return answerState;}function validateRequiredGeneral(QID,qtext,hasQText,answerRequiredCondition){if(!isCheckErrorsFromAllPages()&&!isQuestionExistInForm(QID,_current_form)){return true;}if(showHideModule&&!showHideModule.isVisibleQuestion(QID)){return true;}var isMustAnswerConditional=answerRequiredCondition!=null&&answerRequiredCondition.length>0;removeMarkupMandatoryAnswer();removeMarkupAnswer();if(!isMustAnswerConditional&&validateRequiredGeneralSilent(QID)){return true;}else{if(isMustAnswerConditional){if(validateRequiredConditional(answerRequiredCondition)){if(validateRequiredGeneralSilent(QID)){return true;}}else{return true;}}}reactionOnError(QID,qtext);return false;}function addElementForHighlite(form,QID){var highliteTdElement=findElementForHiglite(form,QID);if(highliteTdElement!=null){validationErrorHighliteElements.push(highliteTdElement);}}function isCheckErrorsFromAllPages(){return votingSubmitModule.isOfflineVoting()&&window.survData.pageSelectorMode&&window.dirSubmit!=null&&window.dirSubmit=="";}function isQuestionExistInForm(QID,form){var elementsOnForm=findQuestionElementsOnForm(QID,_current_form);for(var i=0;i<elementsOnForm.length;i++){var elem=elementsOnForm[i];if(elem&&(!elem.type||elem.type.toLowerCase()!="hidden")){return true;}}if(isLookupPresentOnCurrentPage(QID)){return true;}return isFileUploadPresentOnCurrentPage(QID);}function isFileUploadPresentOnCurrentPage(QID){var queData=window.survData.questionsMap[QID];if(queData!=null&&queData.type=="UPLOAD_FILE"){for(var i=0;i<queData.answersSorted.length;i++){var ansId=queData.answersSorted[i];var fileInput=j$("#fileInput_"+QID+"_"+ansId);if(fileInput&&fileInput.length){return true;}}var found=false;var searchElemForCurrentQuestion=function(elem){elem.each(function(){var queIdAttr=j$(this).attr("questionid");if(queIdAttr==QID){found=true;return false;}return true;});};searchElemForCurrentQuestion(j$(".dev_insertCameraButton"));if(found){return true;}searchElemForCurrentQuestion(j$(".dev_insertGalleryButton"));return found;}return false;}function isLookupPresentOnCurrentPage(QID){var queData=window.survData.questionsMap[QID];if(queData==null||(queData.type!="MULTIPLE_LOOKUP"&&queData.type!="LOOKUP")){return false;}return(window.LQ_Core&&window.LQ_Core.isPresentOnVisualPage&&window.LQ_Core.isPresentOnVisualPage(QID));}function findElementForHiglite(form,QID){var formId=form.name.substr(7);if(formId==null||isNaN(formId)){return null;}var posibleElementIds=[];posibleElementIds.push("tdAnswersCellForm"+formId+"Id"+QID);posibleElementIds.push("questionMainTableId"+QID+"_Form"+formId);posibleElementIds.push("QuestionAnswersTableId"+QID+"_Form"+formId);for(var i=0;i<posibleElementIds.length;i++){var highliteElement=document.getElementById(posibleElementIds[i]);if(highliteElement!=null){return highliteElement;}}}function validateRequiredConditional(answerRequiredCondition){return parseExpressionLogic_ROW_LOGIC(answerRequiredCondition,false);}function validateRequiredGeneralSilent(QID){var tokenResult=votingResultsModule.getVotingResult(QID,null,null,null);return tokenResult!=null;}window.formCache={};function getFormFromCache(formName){var form=window.formCache[formName];if(!form){form=j$("form[name="+formName+"]");window.formCache[formName]=form.length?form:null;}return form;}function validateRequiredElement(QID,AID,columnNum,matchResult,expression){var tokenResult=calculationModule.getResultForConditionJS(expression);if(tokenResult!=null){if(matchResult){return validateTextResult(matchResult,tokenResult);}return true;}return false;}function normalizeResults(frm){var sortedFrm=[];for(var i=0;i<frm.length;i++){var elem=frm[i];if(elem.name.indexOf("other")==0){sortedFrm.unshift(elem);}else{sortedFrm.push(elem);}}return sortedFrm;}function validateTextResult(condition,result){var conditionValue=condition.substring(2,condition.length);var isMatches=getResultForMatches(conditionValue,result);if(condition.indexOf("==")==0){return isMatches;}if(condition.indexOf("<>")==0||condition.indexOf("!=")==0){return !isMatches;}return false;}function getResultForMatches(condition,result){result+="";var condUpperCase=condition.toUpperCase();if(condUpperCase.indexOf("LIKE")==0){return result.trim().indexOf(condition.replace("LIKE",""))>=0;}else{if(condUpperCase.indexOf("RMATCHES")==0){var matchingText=result.trim().match(condition.replace("RMATCHES",""));return matchingText!=null&&matchingText[0]==result;}else{if(condUpperCase.indexOf("RLIKE")==0){return result.trim().search(condition.replace("RLIKE",""))>=0;}}}return condition==result.trim();}function checkPreferredCompareMatrix(QID,qtext,isRequired,isPreferred,total_lines,hasQText,answerRequiredCondition){if(_current_form!=null&&validationErrorElement!=null){return true;}if(isRequired){if(!validateRequiredGeneral(QID,qtext,hasQText,answerRequiredCondition)){return false;}}var k=0;var frm=findQuestionElementsOnForm(QID,_current_form);for(var i=0;i<frm.length;i++){var elem=frm[i];if(elem==null||elem.name==null){continue;}if(elem.name.indexOf("R"+QID+"_")>=0){if(elem.checked){k++;}}}if(k==total_lines||k==0){return true;}pleaseAnswerErrorAlert(qtext,QID);return false;}function checkCheckboxes(QID,qtext,isRequired,isPreferred,minRequired,maxAllowed,exclusiveAID,hasQText,answerRequiredCondition){if(_current_form!=null&&validationErrorElement!=null){return true;}if(exclusiveAID>0){var checkedElems=j$("input:checkbox[name='R"+QID+"']:checked",_current_form);var checkedExclusive=checkedElems.filter(function(){return j$(this).hasClass("exclusive");});if(checkedExclusive.length>0&&checkedElems.length>1){alertExclusive(qtext);scrollToQuestion="#Q"+QID;window.setTimeout(scrollToSomeQuestion,250);return false;}}if(isPreferred&&validateRequiredGeneralSilent(QID)){removeFromPreferredArrays(QID);}if(isRequired){if(!validateRequiredGeneral(QID,qtext,hasQText,answerRequiredCondition)){return false;}}var queData=window.survData.questionsMap[QID];if(!queData){return true;}var visibleAnswersCount=0;for(var i=0;i<queData.answersSorted.length;i++){var ansId=queData.answersSorted[i];if(showHideModule.isVisibleAnswer(ansId,QID)){visibleAnswersCount++;}}if(visibleAnswersCount==0){return true;}var minRequiredVisible=minRequired;var maxAllowedVisible=maxAllowed;if(visibleAnswersCount>0&&visibleAnswersCount<minRequired){minRequiredVisible=visibleAnswersCount;}if(visibleAnswersCount>0&&visibleAnswersCount<maxAllowed){maxAllowedVisible=visibleAnswersCount;}if(maxAllowedVisible==0&&minRequiredVisible<=1){return true;}var count=getCountCheckedCheckboxes(QID,_current_form);if((count<=maxAllowedVisible||maxAllowedVisible==0)&&(count==0||count>=minRequiredVisible)){return true;}alertMinMaxReq(QID,qtext,minRequiredVisible,maxAllowedVisible,_current_form);return false;}function getCountCheckedCheckboxes(QID,currentForm){var count=0;var queData=window.survData.questionsMap[QID];for(var i=0;i<queData.answersSorted.length;i++){var ansId=queData.answersSorted[i];if(showHideModule.isVisibleAnswer(ansId,QID)&&votingResultsModule.getVotingResult(QID,ansId,null)!=null){count++;}}return count;}function getCountCheckedInListbox(QID,currentForm){var count=0;var frm=findQuestionElementsOnForm(QID,currentForm);for(var i=0;i<frm.length;i++){var elem=frm[i];if(elem==null){continue;}var ename=elem.name;if(ename==null){continue;}if(ename.indexOf("R"+QID)==0){var opts=elem.options;for(var j=1;j<opts.length;j++){if(opts[j].selected){count++;}}}}return count;}function checkListbox(QID,qtext,isRequired,isPreferred,minRequired,maxAllowed,hasQText,answerRequiredCondition){if(_current_form!=null&&validationErrorElement!=null){return true;}var checkedElems=j$("[id^='AnswerOption"+QID+"']:selected",_current_form);var checkedExclusive=checkedElems.filter(function(){return j$(this).hasClass("exclusive");});if(checkedExclusive.length>0&&checkedElems.length>1){alertExclusive(qtext);scrollToQuestion="#Q"+QID;window.setTimeout(scrollToSomeQuestion,250);return false;}if(isRequired){if(!validateRequiredGeneral(QID,qtext,hasQText,answerRequiredCondition)){return false;}}if(maxAllowed==0&&minRequired<=1){return true;}var count=getCountCheckedInListbox(QID,_current_form);if((count<=maxAllowed||maxAllowed==0)&&(count==0||count>=minRequired)){return true;}alertMinMaxReq(QID,qtext,minRequired,maxAllowed,_current_form);return false;}function fillArray(frm){var retArray=[];var count=1;for(var i=0;i<frm.length;i++){var elem=frm[i];if(elem!=null&&elem.name!=null&&elem.name.indexOf("other")==0&&(frm[i].type.toUpperCase())!="HIDDEN"){retArray[count]=elem;count++;}}retArray[0]=0;return retArray;}function getTotalElement(frm,currentForm){for(var i=0;i<frm.length;i++){var elem=frm[i];if(elem!=null&&elem.name!=null&&elem.name.indexOf("total")==0){if(currentForm==null||currentForm.name==elem.form.name){return frm[i];}}}return null;}function checkvalue(focusObj,alert_on,preffix,suffix,decimal_place,decimal_divider,thousend_divider){var value=subStringInteger(focusObj.value,preffix,suffix,decimal_place,decimal_divider,thousend_divider);if(value.length==0||isNaN(parseInt(value,10))){if(alert_on){focusObj.focus();}return false;}return true;}function fixFormat(value,preffix,suffix,decimal_place,decimal_divider,thousend_divider){value=""+removeLeadingZeroes(value);var stopSignal=false;if(value.charAt(0)=="0"){var res="";var stopSignal=false;var i=0;var decimalDividerFirstChar=decimal_divider.charAt(0);while(i<value.length){if(stopSignal){res+=value.charAt(i);}else{if(value.charAt(i)!="0"||value.charAt(i+1)==decimalDividerFirstChar){stopSignal=true;res+=value.charAt(i);}}i++;}value=res;}var foundDot=value.indexOf(decimal_divider);if(foundDot<0){var i=0;if(decimal_place>=0){value+=decimal_divider;}while(i<decimal_place){value+="0";i++;}}else{var i=0;var len=value.length-foundDot;while(len+i<=decimal_place){value+="0";i++;}}var negativeValue=value.indexOf("-")>=0;var i=value.indexOf(decimal_divider)-1;var res="";var j=0;while(i>=0){if(j==3&&negativeValue&&i>0||j==3&&!negativeValue){res+=thousend_divider;j=0;}j++;res+=value.charAt(i);i-=1;}var dotIdx=value.indexOf(decimal_divider);var suf=value.substring(dotIdx+1,dotIdx+1+decimal_place);value="";i=res.length-1;while(i>=0){value+=res.charAt(i);i-=1;}if(value.length==0){value="0";}if(decimal_place>0){value+=decimal_divider+suf;}var result=value;if(preffix.length>0){result=preffix+" "+value;}if(suffix.length>0){result+=" "+suffix;}return result;}function intvalue(focusObj,dontFill,value_obj,preffix,suffix,decimal_place,decimal_divider,thousend_divider){if(focusObj!=null&&focusObj!=window&&value_obj.form.name!=focusObj.form.name){return 0;}return intvalueWithAlert(focusObj,dontFill,value_obj,preffix,suffix,decimal_place,decimal_divider,thousend_divider);}function removeDecimal(value,decimal_place,decimal_divider){var res=value;var decimalIndex=value.indexOf(decimal_divider);if(decimalIndex>0){var cutIndex=decimalIndex+decimal_place+((decimal_place>0)?1:0);res=value.substring(0,cutIndex);}return res;}function appendZeroes(value,decimal_place,decimal_divider){var idx=value.indexOf(decimal_divider);if(idx>0&&value.lastIndexOf(decimal_divider)!=idx){value=""+parseFloat(value);idx=value.indexOf(decimal_divider);}while(idx>0&&decimal_place>0&&value.length-idx<=decimal_place){value+="0";}return value;}function removePreffix(value,preffix){if(preffix.length>0){var idx=value.indexOf(preffix);if(idx>=0){value=value.substring(idx+preffix.length,value.length);}}return value;}function removeSuffix(value,suffix){if(value==null||value.length==0){return value;}if(value.indexOf(suffix)>0){return value.substring(0,value.indexOf(suffix));}return value;}function removeNaNs(value,decimal_divider,thousend_divider){var regexp=new RegExp("[^-0-9"+decimal_divider.charAt(0)+"]+","gi");return value.replace(regexp,"");}function extractNumbers(value,decimal_divider){var i=0;var res="";while(i<value.length){if(value.charAt(i)==decimal_divider.charAt(0)||value.charAt(i)=="-"&&i==0||!isNaN(parseInt(value.charAt(i),10))){res+=value.charAt(i);}i++;}return res;}function normalizeNumber(value,decimal_place,decimal_divider){if(value.length==0){value="0";}var indexOfDecDiv=value.indexOf(decimal_divider);if(indexOfDecDiv==0){value="0"+value;indexOfDecDiv++;}if(indexOfDecDiv>=0){var begin=value.substring(0,indexOfDecDiv);var end=value.substring(indexOfDecDiv+1);if(end.length>decimal_place){end=end.substring(0,decimal_place);}while(end.length<decimal_place){end+="0";}value=begin+decimal_divider+end;}else{if(decimal_place>0){value+=decimal_divider;}while(decimal_place>0){value+="0";decimal_place--;}}return value;}function removeSpaces(value){return value.replace(/\s+/g,"");}function subStringAsInteger(value,preffix,suffix,decimal_place,decimal_divider){var ret=removeSpaces(value);ret=removeSuffix(ret,suffix);ret=appendZeroes(ret,decimal_place,decimal_divider);ret=removeDecimal(ret,decimal_place,decimal_divider);ret=removePreffix(ret,preffix);ret=removeLeadingZeroes(ret);return ret;}function subStringInteger(value,preffix,suffix,decimal_place,decimal_divider,thousend_divider){value=subStringAsInteger(value,preffix,suffix,decimal_place,decimal_divider);if(value==null||value.length==0){return"";}value=removeNaNs(value,decimal_divider,thousend_divider);value=extractNumbers(value,decimal_divider);value=normalizeNumber(value,decimal_place,decimal_divider);return value;}function checkSum1(focusObj,fromBody,output_alert,qtext,QID,total_min,total_max,answer_required,preffix,suffix,decimal_place,decimal_divider,thousend_divider){if(_current_form!=null&&validationErrorElement!=null){return true;}var currentForm=(focusObj==null||focusObj==window)?_current_form:focusObj.form;var foundForm=findQuestionElementsOnForm(QID,currentForm);if(foundForm.length==0){return true;}var checkArray1=fillArray(foundForm);var totalElement1=getTotalElement(foundForm,currentForm);if(isNaN(checkArray1.length)){return true;}var empty1=1;var i1=1;while(i1<checkArray1.length){var el=checkArray1[i1];if(el!=null){if(el.value==""){empty1++;}}i1++;}if(empty1==checkArray1.length){if(totalElement1){totalElement1.value="";j$(totalElement1).trigger("change");}return true;}return checkSum(focusObj,fromBody,output_alert,qtext,QID,total_min,total_max,answer_required,preffix,suffix,decimal_place,decimal_divider,thousend_divider);}function onunloadSaving(onsubmit,onbefore){if(document.theForm==null){return false;}var hasData=false;for(var i=0;i<document.theForm.elements.length;i++){var elem=document.theForm.elements[i];if(elem.tagName=="FIELDSET"){continue;}if(elem.value!=null||elem.selectedIndex>0){if(elem.value!=null&&elem.name.indexOf("other")>=0&&elem.value.length>0){hasData=true;break;}}if(elem.name.indexOf("other")>=0){continue;}if(elem.value!=null&&elem.checked){hasData=true;break;}else{if(elem.selectedIndex>0){hasData=true;break;}}}return false;}function removeFromPreferredArrays(QID){if(QID<=0){return;}var i=0;while(i<prefAnsweredQue.length){var prefAnsweredQueOldValue=prefAnsweredQue[i];if(prefAnsweredQueOldValue==QID&&prefAnsweredQueOldValue>0){prefAnsweredQueBackup[i]=prefAnsweredQueOldValue;prefAnsweredQueTextsBackup[i]=prefAnsweredQueTexts[i];prefAnsweredQue[i]=0;prefAnsweredQueTexts[i]="";}i++;}}function addToPreferredArrays(QID){if(QID<=0){return;}var i=0;while(i<prefAnsweredQue.length){if(prefAnsweredQueBackup[i]==QID){prefAnsweredQue[i]=prefAnsweredQueBackup[i];prefAnsweredQueTexts[i]=prefAnsweredQueTextsBackup[i];prefAnsweredQueBackup[i]=0;prefAnsweredQueTextsBackup[i]="";}i++;}}function intvalueWithAlert(focusObj,dontFill,value_obj,preffix,suffix,decimal_place,decimal_divider,thousend_divider){var value=subStringInteger(value_obj.value,preffix,suffix,decimal_place,decimal_divider,thousend_divider);if(!dontFill&&value_obj==focusObj&&value_obj.value!=null&&value_obj.value.length>0){value_obj.value=fixFormat(value,preffix,suffix,decimal_place,decimal_divider,thousend_divider);}var res=parseFloat(value);if(isNaN(res)){value=0;}if(!dontFill&&value_obj.value!=null&&value_obj.value.length>0){value_obj.value=fixFormat(value,preffix,suffix,decimal_place,decimal_divider,thousend_divider);}return value;}function subStringIntegerWithErrorCode(value,preffix,suffix,decimal_place,decimal_divider,thousend_divider){value=subStringAsInteger(value,preffix,suffix,decimal_place,decimal_divider);if(value==null||value.length==0){return{val:""};}var regexp_ch=new RegExp("[^-0-9"+decimal_divider.charAt(0)+thousend_divider.charAt(0)+"]+","gi");var err_flg=regexp_ch.test(value);value=removeNaNs(value,decimal_divider,thousend_divider);value=extractNumbers(value,decimal_divider);value=normalizeNumber(value,decimal_place,decimal_divider);return{val:value,err_flg:err_flg};}function getIndexByColumnId(columnId){var allColumnsElement=document.getElementById("ALL_COLUMNS");if(allColumnsElement==null){return -1;}var allColumns=allColumnsElement.value;var indexOf=allColumns.indexOf(","+columnId+"=");var foundLength=(","+columnId+"=").length;if(indexOf<0){indexOf=allColumns.indexOf(columnId+"=");foundLength=(columnId+"=").length;}if(indexOf<0){return -1;}var afterFound=allColumns.substring(indexOf+foundLength);var indexOfComa=afterFound.indexOf(",");if(indexOfComa<0){return afterFound;}else{return afterFound.substring(0,indexOfComa);}}function selectTextInTextBox(obj){if(obj==null){return;}var iCaretPos=obj.value.length;if(document.selection){try{var range=document.selection.createRange();if(obj.type=="text"){range.moveStart("character",0);range.moveEnd("character",iCaretPos);range.select();}}catch(ex){}}else{if(obj.selectionStart||obj.selectionStart=="0"){obj.setSelectionRange(0,iCaretPos);}}}function alertExclusive(qtext){if(qtext.length>150){qtext=qtext.substr(0,150)+"...";}alert(exclusiveAlert.replace(/\{0\}/,qtext));}function checkSum(focusObj,fromBody,output_alert,qtext,QID,total_min,total_max,answer_required,preffix,suffix,decimal_place,decimal_divider,thousend_divider){var ok=false,i=1,total_sum=new BigNumber(0),count=0,missing_value=null,currentForm=(focusObj==null||focusObj==window)?_current_form:focusObj.form,foundForm=findQuestionElementsOnForm(QID,currentForm);if(foundForm.length==0){return true;}var checkArray=fillArray(foundForm),totalElement=getTotalElement(foundForm,currentForm);if(isNaN(checkArray.length)){return true;}if(total_min==null){total_min=-Number.MAX_VALUE;}if(total_max==null){total_max=Number.MAX_VALUE;}var emptyElementsCount=1;while(i<checkArray.length){var elementCheck=checkArray[i];if(checkvalue(elementCheck,false,preffix,suffix,decimal_place,decimal_divider,thousend_divider)){count++;}else{missing_value=elementCheck;}if(elementCheck.value==""){emptyElementsCount++;}i++;}i=1;if(totalElement!=null&&emptyElementsCount==checkArray.length){totalElement.value="";j$(totalElement).trigger("change");return true;}while(i<checkArray.length){if(totalElement!=null&&focusObj!=null&&focusObj!=window){if(totalElement.form.name==focusObj.form.name){var n=intvalue(focusObj,fromBody,checkArray[i],preffix,suffix,decimal_place,decimal_divider,thousend_divider);total_sum=total_sum.add(new BigNumber(n));}}else{if(totalElement!=null){var n=intvalue(focusObj,fromBody,checkArray[i],preffix,suffix,decimal_place,decimal_divider,thousend_divider);total_sum=total_sum.add(new BigNumber(n));}}i++;}var tmp_str=new String(total_sum);if(totalElement!=null){totalElement.value=total_sum;j$(totalElement).trigger("change");}if(count==0){if(!answer_required){ok=true;return ok;}}if(total_sum!=total_min&&total_min==total_max){if(count+2>=checkArray.length&&missing_value!=null){var diff=new BigNumber(total_min).subtract(total_sum);if(diff.compare(0)==0){ok=false;if(totalElement!=null){totalElement.value=fixFormat(tmp_str,preffix,suffix,decimal_place,decimal_divider,thousend_divider);j$(totalElement).trigger("change");}return ok;}}else{if(answer_required){i=1;while(i<checkArray.length){if(!checkvalue(checkArray[i],output_alert,preffix,suffix,decimal_place,decimal_divider,thousend_divider)){break;}i++;}}}}else{ok=true;}if(totalElement!=null){totalElement.value=fixFormat(tmp_str,preffix,suffix,decimal_place,decimal_divider,thousend_divider);j$(totalElement).trigger("change");}if(total_min<total_max&&total_sum>=total_min&&total_sum<=total_max){ok=true;return ok;}if(missing_value==null&&!isNaN(checkArray.length)&&checkArray.length>1){missing_value=checkArray[checkArray.length-1];}var msg=null;if(total_min<=total_max&&total_sum<total_min){ok=false;msg=inTheQue+'"'+qtext+'" \n\n ';msg+=summLess.replace("{0}",total_min);}else{if(total_min<=total_max&&total_sum>total_max){ok=false;msg=inTheQue+'"'+qtext+'" \n\n ';msg+=summExceeds.replace("{0}",total_max);}}if(!(!ok&&msg!=null&&output_alert)){return ok;}if(_current_form==null){alert(msg);scrollToQuestion="#Q"+QID;window.setTimeout(scrollToSomeQuestion,250);missing_value.focus();}else{validationErrorAlert=msg;validationErrorElement=findElementForHiglite(_current_form,QID);}return ok;}function beforeSubmitErrorAlert(qtext,elem,QID,AID){var msg="    "+beforeSubmitMsg+qtext;var question=window.survData.questionsMap[QID];if(question){var answer=question.answers[AID];if(answer){msg=msg+"\n\n"+answer.name+" - "+window.answerOtherMissingTextMsg;}}if(_current_form==null){alert(msg);elem.focus();scrollToQuestion="#Q"+QID;window.setTimeout(scrollToSomeQuestion,250);}else{validationErrorAlert=msg;validationErrorElement=findElementForHiglite(_current_form,QID);}}function pleaseAnswerAllRowsErrorAlert(hasQText,qtext,elem,QID){if(_current_form==null){var answerFromBundle=pleaseAnswerAllRowsMsg.replace(/(.*)\s*$/,"$1");alert("    "+answerFromBundle+(hasQText?"\n"+qtext:""));elem.focus();scrollToQuestion="#Q"+QID;window.setTimeout(scrollToSomeQuestion,250);}else{addElementForHighlite3dMatrixAllRows(_current_form,QID);}}function reactionOnErrorFromOtherPage(QID){if(isCheckErrorsFromAllPages()){var queData=window.survData.questionsMap[QID];if(queData&&queData.pageNum!=window.votingSubmitModule.getPageNumber()){window.votingSubmitModule.goToVotingPage(queData.pageNum,true);return true;}}return false;}function reactionOnError(QID,qtext){if(reactionOnErrorFromOtherPage(QID)){return;}if(_current_form==null){var answerFromBundle=pleaseAnswerMsg.replace(/(.*)\s*$/,"$1");markupAnswerElements(QID);var queText=qtext;var pipingModule=window.pipingModuleProvider.getModule();if(survData.questionsMap[QID].hasPiping){queText=j$("<div/>").html(pipingModule.replacePipingText(survData.questionsMap[QID].name)).text();}alert("    "+answerFromBundle+"\n"+queText);scrollToQuestion="#Q"+QID;window.setTimeout(scrollToSomeQuestion,250);}else{addElementForHighlite(_current_form,QID);}}function removeMarkupAnswer(){j$(".MustAnswerError").removeClass("MustAnswerError");}function removeMarkupMandatoryAnswer(){j$(".MustAnswerErrorTr").removeClass("MustAnswerErrorTr");}function markupAnswerElements(QID,visibleAnswers){var question=vpGetQuestionByQuestionId(QID);var noRes;var notAnsweredAnswers=[];if(visibleAnswers){noRes=false;var ii=0;for(var k=0;k<visibleAnswers.length;k++){var ansId=parseInt(visibleAnswers[k]);if(votingResultsModule.getVotingResult(QID,ansId,null)==null){noRes=true;notAnsweredAnswers[ii]=ansId;ii++;}}}else{noRes=(votingResultsModule.getVotingResult(QID,null,null)==null);}if(noRes){if(ksConfig.isEform){var el=vpGetElements(question.prefix);var ret=true;if(question.isRateDifferent()||question.is3DMatrix()){for(var i=0;i<el.length;i++){ret=markupElementsMustAnswer(el[i],true,notAnsweredAnswers);}}else{ret=markupElementsMustAnswer(el,false,notAnsweredAnswers);}return ret;}else{if(notAnsweredAnswers.length){for(var j=0;j<notAnsweredAnswers.length;j++){markupMustAnswer(j$("#AnswerTr"+QID+"_"+notAnsweredAnswers[j]));}return true;}else{markupMustAnswer(j$("#questionFieldsetId"+QID));}}}return false;}function markupElementsMustAnswer(el,continueIterator,visibleAnswers){if(el.length>0){var stopIterator=false;for(var i=0;i<el.length;i++){if(el[i].length>0){for(var j=0;j<el[i].length;j++){if(visibleAnswers!=null&&visibleAnswers.length>0){for(var v=0;v<visibleAnswers.length;v++){if(el[i][j]!=null&&el[i][j].id.search(visibleAnswers[v])>-1){markupMustAnswer(j$("#"+el[i][j].id));stopIterator=true;}}}else{if(el[i][j]!=null){stopIterator=markupMustAnswer(j$("#"+el[i][j].id));}}}}else{if(el[i]!=null){if(visibleAnswers!=null&&visibleAnswers.length>0){for(var c=0;c<visibleAnswers.length;c++){if(el[i].id.search(visibleAnswers[c])>-1){markupMustAnswer(j$("#"+el[i].id));stopIterator=true;}}}else{if(el[i]!=null){stopIterator=markupMustAnswer(j$("#"+el[i].id));}}}}}}if(visibleAnswers){return stopIterator;}return true;}function reactionOnMandatoryAnswerError(QID,aids,aTexts){if(reactionOnErrorFromOtherPage(QID)){return;}markupAnswerElements(QID,aids);if(_current_form==null){var answerFromBundle=pleaseRespondToTheFollowingItems.replace(/(.*)\s*$/,"$1"),prevStr="    ",msg=prevStr+answerFromBundle+"\n",length=0;var idx=0;for(var aText in aTexts){var aTxt=aTexts[aText];var aid=aids[idx];var ansText=aText;idx++;var answerLabelElement=j$("#AnswerLabel"+QID+"_"+aid);if(answerLabelElement.length>0){ansText=answerLabelElement.text();}msg+=(prevStr+(aTxt.length>128?aTxt.substring(0,128)+"...\n":ansText+",\n"));length++;if(length>20){msg+=(prevStr+"... \n");break;}}if(length>0){msg=msg.substring(0,msg.length-2);}alert(msg);scrollToQuestion="#Q"+QID;window.setTimeout(scrollToSomeQuestion,250);}else{addElementForHighlite(_current_form,QID);}}function pleaseAnswerErrorAlert(qtext,QID){var answerFromBundle=pleaseAnswerMsg.replace(/(.*)\s*$/,"$1");var msg="    "+answerFromBundle+"\n"+qtext;if(_current_form==null){markupAnswerElements(QID);alert(msg);scrollToQuestion="#Q"+QID;window.setTimeout(scrollToSomeQuestion,250);}else{validationErrorAlert=msg;validationErrorElement=findElementForHiglite(_current_form,QID);}}function reactionOnErrorMustAnswerAllFields3D(QID,qtext){if(_current_form==null){var answerFromBundle=pleaseAnswerAllMatrixFieldsMsg.replace(/(.*)\s*$/,"$1");alert("    "+answerFromBundle+"\n"+qtext);scrollToQuestion="#Q"+QID;window.setTimeout(scrollToSomeQuestion,250);}else{addElementForHighlite(_current_form,QID);}}function showPreferredAlert(){var i=0;var j=0;var msg=""+notAnsweredButPreferredMsg;while(i<prefAnsweredQue.length){var QID=prefAnsweredQue[i];if(QID>0&&document.getElementById("QuestionAnswersTableId"+QID)&&showHideModule.isVisibleQuestion(QID)&&!validateRequiredGeneralSilent(QID)){msg+=" - "+prefAnsweredQueTexts[i]+"\n";if(j==0){scrollToQuestion="#Q"+QID;}j++;}i++;}msg+=isItOkMsg;if(j==0){return true;}if(confirm(msg)>0){return true;}window.setTimeout(scrollToSomeQuestion,250);return false;}function alertMinMaxReq(QID,qtext,minRequired,maxAllowed,form){var msg="";if(minRequired<=1){msg="   "+mayCheckFullMsg.replace(/\{0\}/,maxAllowed).replace(/\{1\}/,qtext);}else{if(maxAllowed==0){msg="   "+chooseAtLeastFullMsg.replace(/\{0\}/,minRequired).replace(/\{1\}/,qtext);}else{if(minRequired==maxAllowed){msg="   "+exactlyFullMsg.replace(/\{0\}/,minRequired).replace(/\{1\}/,qtext);}else{msg="   "+checkFromFullMsg.replace(/\{0\}/,minRequired).replace(/\{1\}/,maxAllowed).replace(/\{2\}/,qtext);}}}if(form==null){alert(msg);validationErrorAlert=msg;scrollToQuestion="#Q"+QID;window.setTimeout(scrollToSomeQuestion,250);}else{validationErrorAlert=msg;validationErrorElement=findElementForHiglite(form,QID);}}function checkRankGrid(QID,qtext,isRequired,isPreferred,requiredCount,rowCount,uniqueAnswers){if(_current_form&&validationErrorElement){return true;}if(!isCheckErrorsFromAllPages()&&!isQuestionExistInForm(QID,_current_form)){return true;}if(isPreferred){return true;}var queData=window.survData.questionsMap[QID];if(queData==null){return true;}var visibleAnswersCount=0;var visibleAnswers=[];for(var i=0;i<queData.answersSorted.length;i++){var ansId=queData.answersSorted[i];if(showHideModule.isVisibleAnswer(ansId,QID)){visibleAnswers.push(ansId);visibleAnswersCount++;}}var requiredCountVisible=(requiredCount>visibleAnswersCount)?visibleAnswersCount:requiredCount;var requiredMsg;if(requiredCount===rowCount){requiredMsg="   "+pleaseAnswerAllRowsMsg+qtext;}else{requiredMsg="   "+atLeastMsg+" ";if(requiredCountVisible!==1){requiredMsg+=requiredCountVisible+" "+rowsMsg;}else{requiredMsg+=oneRowMsg;}requiredMsg+=" "+inQueMsg+qtext;}if(isRequired&&requiredCountVisible>0){if(!validateRequiredGeneralSilent(QID)){showRequiredMsg(requiredMsg,QID);markupAnswerElements(QID);return false;}}var checkedCount=0;var usedColumns={};var duplicateColumns=false;for(var q=0;q<queData.answersSorted.length;q++){var ansId=queData.answersSorted[q];if(!showHideModule.isVisibleAnswer(ansId,QID)){continue;}for(var j=0;j<queData.columnsSorted.length;j++){var colId=queData.columnsSorted[j];var tokenResult=votingResultsModule.getVotingResult(QID,ansId,j,null);if(tokenResult!=null){checkedCount++;if(uniqueAnswers&&!duplicateColumns){if(usedColumns[colId]===1){duplicateColumns=true;}else{usedColumns[colId]=1;}}break;}}}if(!duplicateColumns){if(checkedCount>=requiredCountVisible){return true;}if(checkedCount===0){return true;}}var msg="";if(duplicateColumns){msg=""+inTheQueMsg+'"'+qtext+'" \n\n ';msg+=youCanChooseMsg;}else{msg=requiredMsg;}markupAnswerElements(QID,visibleAnswers);showRequiredMsg(msg,QID);return false;}function showRequiredMsg(msg,QID){if(!_current_form){alert(msg);scrollToQuestion="#Q"+QID;window.setTimeout(scrollToSomeQuestion,250);}else{validationErrorAlert=msg;validationErrorElement=findElementForHiglite(_current_form,QID);}}function isQuestionInGeneralSection(qid){return j$("#generalSection").find("#questionMainTableId"+qid).length>0;}var stopFormEnter=function(e){e=e||window.event;if(e&&isEventFromInputOrSelect(e)){return !((e.keyCode||e.which)==13);}else{return true;}};var isEventFromInputOrSelect=function(e){return(e.target&&"input"==e.target.tagName.toLowerCase()||e.srcElement&&"input"==e.srcElement.tagName.toLowerCase())||(e.target&&"select"==e.target.tagName.toLowerCase()||e.srcElement&&"select"==e.srcElement.tagName.toLowerCase());};function getRadioForText(textElem){return document.getElementById("RC"+textElem.id.substring(14));}function getTextForRadio(radioElem){return document.getElementById("inputtextother"+radioElem.id.substring(2));}function log(level,data,paramsExtractor){j$.ajax({url:"/servlet/voting/AjaxLoggerServlet",data:{level:level,msg:data,params:paramsExtractor()}});}window.imgButtonOver=function(target){target.src=document.getElementById("hidden_src_over_"+target.id).src;};window.imgButtonOut=function(target){target.src=document.getElementById("hidden_src_"+target.id).src;};function minEnlargeReferenceImage(){window.disableShowBeforeAlert();var $img=j$(this);var reflink=$img.data("reflink");if(reflink){window.openLink(reflink);}else{$img.toggleClass("SmallRefImgBox").toggleClass("LargeRefImgBox");}}var showHideModule=(function($,_,a,votingSubmitModule){if(!_||!a){return{init:$.noop,isVisibleQuestion:function(){return true;},isVisibleAnswer:function(){return true;},isVisibleColumn:function(){return true;},isVisibleElement:function(){return true;}};}var showHides={};var _showHideCommentOrTotal=function(humanKey,qid){var showHideQue=showHides["Q"+qid];var queData=window.survData.questionsMap[qid];if(queData&&(queData.type=="PICK_ONE_WITH_COMMENT"||queData.type=="NUMERIC_ALLOCATION")){var atLeastOneAnswerVisible=false;var commentOrTotalId=null;var commentOrTotalPos=0;for(var i=0;i<queData.answersSorted.length;i++){var ansId=queData.answersSorted[i];var ansData=queData.answers[ansId];if((queData.type=="PICK_ONE_WITH_COMMENT"&&ansData.type=="ATYPE_SINGLE_LINE")||ansData.total){commentOrTotalId=ansId;commentOrTotalPos=i+1;}else{var hidden=showHideQue["A"+ansId];if(hidden==null||hidden==undefined||!hidden){atLeastOneAnswerVisible=true;}}}if(commentOrTotalId){var aIndex=humanKey.indexOf("A");var humanFormat=humanKey.substring(0,aIndex+1)+commentOrTotalPos;if(humanKey!==humanFormat){var shouldHide=!atLeastOneAnswerVisible;showHideQue["A"+commentOrTotalId]=shouldHide;a.toggle(humanFormat,shouldHide);}}}};return{setAnswerColumnVisibility:function(humanKey,qid,aid,cid,hide){var showHideQue=showHides["Q"+qid];if(!showHideQue){showHides["Q"+qid]={};showHideQue=showHides["Q"+qid];}var queData=window.survData.questionsMap[qid];if(!aid&&!cid){if(queData.answersSorted){for(var i=0;i<queData.answersSorted.length;i++){showHideQue["A"+queData.answersSorted[i]]=hide;if(queData.columnsSorted){for(var j=0;j<queData.columnsSorted.length;j++){showHideQue["A"+queData.answersSorted[i]+"C"+queData.columnsSorted[j]]=hide;}}}}}if(aid>0){if(cid>0){showHideQue["A"+aid+"C"+cid]=hide;}else{if(queData.columnsSorted){for(var j=0;j<queData.columnsSorted.length;j++){showHideQue["A"+aid+"C"+queData.columnsSorted[j]]=hide;}}else{showHideQue["A"+aid]=hide;}}}else{if(cid>0){for(var j=0;j<queData.answersSorted.length;j++){showHideQue["A"+queData.answersSorted[j]+"C"+cid]=hide;}}}a.toggle(humanKey,hide);_showHideCommentOrTotal(humanKey,qid);},isVisibleQuestion:function(qid){var showHideQue=showHides["Q"+qid];var queData=window.survData.questionsMap[qid];if(!showHideQue||!queData||queData&&queData.type==="HEADER"){return true;}var cid;if(queData.answersSorted){for(var i=0;i<queData.answersSorted.length;i++){var aid=queData.answersSorted[i];var hidden=showHideQue["A"+aid];if(hidden==null||hidden==undefined||!hidden){if(queData.columnsSorted){for(var j=0;j<queData.columnsSorted.length;j++){cid=queData.columnsSorted[j];hidden=showHideQue["A"+aid+"C"+cid];if(hidden==null||hidden==undefined||!hidden){return !hidden;}}}else{return !hidden;}}else{if(queData.columnsSorted){for(var j=0;j<queData.columnsSorted.length;j++){cid=queData.columnsSorted[j];hidden=showHideQue["A"+aid+"C"+cid];if(hidden==null||hidden==undefined||!hidden){return !hidden;}}}}}}return false;},isVisibleAnswer:function(aid,qid){var queData=window.survData.questionsMap[qid];var showHideQue=showHides["Q"+qid];if(!showHideQue||!queData||queData&&queData.type==="HEADER"){return true;}var cid;var hidden=showHideQue["A"+aid];if(hidden==null||hidden==undefined||!hidden){if(queData.columnsSorted){for(var j=0;j<queData.columnsSorted.length;j++){cid=queData.columnsSorted[j];hidden=showHideQue["A"+aid+"C"+cid];if(hidden==null||hidden==undefined||!hidden){return !hidden;}}}else{return !hidden;}}else{if(queData.columnsSorted){for(var j=0;j<queData.columnsSorted.length;j++){cid=queData.columnsSorted[j];hidden=showHideQue["A"+aid+"C"+cid];if(hidden==null||hidden==undefined||!hidden){return !hidden;}}}}return false;},isVisibleColumn:function(cIndex,qid){var queData=window.survData.questionsMap[qid];var showHideQue=showHides["Q"+qid];if(!showHideQue||!queData||queData&&queData.type!=="MATRIX_3D"&&queData.type!=="RANK_GRID_INDEPENDENT"&&queData.type!=="RANK_GRID_DEPENDENT"){return true;}if(queData.columnsSorted&&queData.columnsSorted.length>cIndex){var cid=queData.columnsSorted[cIndex];if(queData.answersSorted){for(var j=0;j<queData.answersSorted.length;j++){var aid=queData.answersSorted[j];var hidden=showHideQue["A"+aid+"C"+cid];if(hidden==null||hidden==undefined||!hidden){return !hidden;}}}}return false;},isVisibleElement:function(cIndex,aid,qid){var queData=window.survData.questionsMap[qid];var showHideQue=showHides["Q"+qid];if(!showHideQue||!queData||queData&&queData.type!=="MATRIX_3D"&&queData.type!=="RANK_GRID_INDEPENDENT"&&queData.type!=="RANK_GRID_DEPENDENT"){return true;}if(queData.columnsSorted&&queData.columnsSorted.length>cIndex){var cid=queData.columnsSorted[cIndex];var hidden=showHideQue["A"+aid+"C"+cid];if(hidden==null||hidden==undefined||!hidden){return !hidden;}}return false;}};})(jQuery,window._,window.ksAPI,window.votingSubmitModule);var ksTooltipsModule=(function($,_){function isEform(){return $("#isEform")&&$("#isEform").val()==="true";}function is360(){return window.survData.survey360;}$().ready(function(){if($(".kshoverable").length===0){return false;}if(is360()){$(document).on("tempThElementCreated",function(){$(document).unbind("tempThElementCreated");return buildToolTips(true);});}else{buildToolTips(false);}});function buildEachToolTip(hoverableElements){var defaultColor="rgb(51, 51, 51)";$.each(hoverableElements,function(index,elem){var $elem=$(elem);if($elem.hasClass("ksHoverBlock")){return;}$elem.addClass("ksHoverBlock");var nameCss;var dataTitle=$elem.attr("data-title");var $parent=$elem.parent();$parent.removeClass("ks_tooltip_container");if(dataTitle){$elem.attr("data-title",_.unescape(dataTitle));}if($elem.hasClass("withTooltipImage")){var cssClass=isEform()?"ksQuestionTooltipForm":"ksQuestionTooltipSurvey";var questionTooltip="<span class="+cssClass+">?</span>";$elem.append(questionTooltip);if(is360){$elem.find("."+cssClass).css("bottom","0");}}else{if($elem.hasClass("withUnderline")){$elem.css("border-bottom","1px dashed #999");}}var color=determineBgdColor(elem);createStyle(".ks_tooltip.hoverBackGroundColor"+index+"c",color);nameCss="hoverBackGroundColor"+index+"c";var params={position:"t",dontHideOnTooltipHover:true,selector:elem,cls:nameCss};$parent.addClass("ks_tooltip_container");$elem.ks_tooltip(params);});function createStyle(name,color){$("<style type='text/css'> "+name+" { background-color:"+color+";border-top-color:"+color+";} </style>").appendTo("head");return true;}function lookForBackGroundStyleInElement($elem){if($elem.css("background-color")){return $elem;}else{if($elem.children().length==0){return false;}else{if($elem.children()&&$elem.children().css("background-color")!=""){return $elem.children();}else{var findNextElem=$elem.children().children();return lookForBackGroundStyleInElement(findNextElem);}}}}function hasTextBackGroundColor(text){if(typeof text===typeof undefined){return false;}if(_.isNumber(text)){text=text.toString();}if(text.indexOf("background-color")!=-1){return true;}return false;}function determineBgdColor(e){var $elementToBeHovered=$(e);var text=$elementToBeHovered.is("[data-title]")?$elementToBeHovered.data("title"):undefined;if(!text){text=$($elementToBeHovered.parentElement).attr("data-title");}var colorAttr=defaultColor,elemWithBackGroundStyle;if(hasTextBackGroundColor(text)){var bGrnd=$(text);elemWithBackGroundStyle=lookForBackGroundStyleInElement(bGrnd);}if(elemWithBackGroundStyle){colorAttr=elemWithBackGroundStyle.css("background-color");}return colorAttr;}}function buildToolTips(is360){var hoverableElement=is360&&jQuery("#fixedHeader.fixedHeader").length>0?jQuery("#fixedHeader.fixedHeader").find("tr:first:not(.tempTh)").find(".kshoverable"):$(".kshoverable");buildEachToolTip(hoverableElement);buildObserver();return false;}function buildObserver(){$(".ks_tooltip_container").bind("DOMNodeInserted",function(e){var $container=$(e.currentTarget);var elements=$container.find(".kshoverable");buildEachToolTip(elements);});}return{initTooltops:function(elements){if(elements&&elements.length>0){buildEachToolTip(elements);buildObserver();}return false;}};})(jQuery,window._);(function($){var _root=this;var pipingModule=function(cfg,window,$,survData,eventsModuleProvider,calculationModule,votingSubmitModule,commonVotingModule,votingResultsModule,votingWaitModule){var pipingModule={};var bracketsLeft="(\\\\*[\\[\\{])";var bracketsRight="(\\]|\\})";var regExpSlashes=new RegExp("\\\\\\\\","g");var regExpLeftSquareBracket=new RegExp("\\\\\\[","g");var regExpRightSquareBracket=new RegExp("\\\\\\{","g");var rowLogicRegExpWithBrackets=new RegExp("(URL:|TEXT:|LINK:)?"+bracketsLeft+"Q(\\d+)(?:.A([0-9*?]+))?(?:.C(\\d+))?"+bracketsRight);var rowLogicRegExpWithoutBrackets=new RegExp("Q(\\d+)(?:.A([0-9*?]+))?(?:.C(\\d+))?");if(cfg==null){cfg={};}pipingModule.replacePipingText=function(text,withoutBrackets,ignoreSquareBrackets){var rowLogicRegExp=withoutBrackets?rowLogicRegExpWithoutBrackets:rowLogicRegExpWithBrackets;var token;var replacements=[];var i=0;var textTmp=text;while((token=rowLogicRegExp.exec(textTmp))!=null&&token.length>0){if(!withoutBrackets&&token[2].indexOf("\\")==0){if(token[2].length%2==0){textTmp=textTmp.replace(token[0],"");var cleaned=token[0].replace(regExpSlashes,"\\").replace(regExpLeftSquareBracket,"[").replace(regExpRightSquareBracket,"{");replacements[i]={text:token[0],replacement:cleaned};i++;continue;}}var squareBrackets=withoutBrackets?false:(token[2].indexOf("[")>=0);if(ignoreSquareBrackets){squareBrackets=false;}var additionalInfo=token[1];var criteria=new votingResultsModule.ResultCriteria();var link=additionalInfo=="LINK:";if(additionalInfo&&link){criteria.fileUploadAsLink=true;}var logicTokenResult=calculationModule.getLogicTokenResult(token[0],true,criteria);var noResult=logicTokenResult==null;if(noResult){logicTokenResult=(!withoutBrackets&&squareBrackets)?"_____":"";}if(additionalInfo&&additionalInfo.length&&logicTokenResult.length){if(additionalInfo=="TEXT:"){logicTokenResult=logicTokenResult;}if(additionalInfo=="URL:"){logicTokenResult=encodeURIComponent(logicTokenResult);}}else{logicTokenResult=logicTokenResult.replace(/<\/?[^>]+>/gi,"");}if(!withoutBrackets&&squareBrackets&&!noResult){logicTokenResult="<b><i>"+logicTokenResult+"</i></b>";}if(!withoutBrackets&&token[2].indexOf("\\")==0){var slashes=token[2].substring(0,token[2].length-1).replace(regExpSlashes,"\\");logicTokenResult=slashes+logicTokenResult;}replacements[i]={text:token[0],replacement:logicTokenResult};textTmp=textTmp.replace(token[0],"");i++;}for(var ii=0;ii<replacements.length;ii++){var replacementObject=replacements[ii];text=text.replace(replacementObject.text,function(){var replacerValue=replacementObject.replacement;if(replacerValue.indexOf("$&")>=0){replacerValue=replacerValue.replace("$&","$&");}return replacerValue;});}text=replaceReviewTagWithPiping(text);return text;};var replaceReviewTagWithPiping=function(text){if(window.isOfflineVoting){return text;}var reviewPatternExec=/<REVIEW>(.*?)<\/REVIEW>/ig.exec(text);if(reviewPatternExec!=null&&reviewPatternExec.length==2){var reviewPatternTemplate='<a href="javascript:pressedReview();" onclick="javascript:disableShowBeforeAlert();">'+reviewPatternExec[1]+"</a>";text=text.replace(reviewPatternExec[0],reviewPatternTemplate);}return text;};pipingModule.replacePipingTextForHtml=function(text,withoutBrackets){return pipingModule.replacePipingText(text,withoutBrackets).replace(/\r\n/g,"<br/>").replace(/\n/g,"<br/>");};var scriptRegExp=/<\/?(script)[^>]*>/;function replaceHeader(){if(survData.surveyHeader&&!scriptRegExp.test(survData.surveyHeader)){var replacedH=pipingModule.replacePipingTextForHtml(survData.surveyHeader);if(replacedH!=survData.surveyHeader){$("div.HHeader").html(replacedH);$("td.H1header").html(replacedH);}}}function replaceFooter(){if(survData.surveyFooter&&!scriptRegExp.test(survData.surveyFooter)){var replacedF=pipingModule.replacePipingTextForHtml(survData.surveyFooter);if(replacedF!=survData.surveyFooter){$("div.HFooter").html(replacedF);$("td.HFooter").html(replacedF);}}}function replaceTitle(){if(survData.surveyTitle&&!scriptRegExp.test(survData.surveyTitle)){var replacedF=pipingModule.replacePipingTextForHtml(survData.surveyTitle);if(replacedF!=survData.surveyTitle){$("tr.uptable").find("td.H1").html(replacedF);}}}function replaceSurveyName(){if(survData.surveyName&&!scriptRegExp.test(survData.surveyName)){var replacedF=pipingModule.replacePipingTextForHtml(survData.surveyName);if(replacedF!=survData.surveyName){$("tr.uptable").find("td.H1").html(replacedF);}}}function replaceQuestion(queData){if(queData.hasPiping){var replaced=pipingModule.replacePipingTextForHtml(queData.name);if(queData.name!=replaced){$("#QuestionLabel"+queData.questionId).html(replaced);}}if(queData.lookup&&queData.lookup.hasPiping){pipingModule.replaceLookupQuestion(queData.lookup,queData.questionId);}}pipingModule.replaceLookupQuestion=function(lookupData,qid){var replacedLabel=pipingModule.replacePipingTextForHtml(lookupData.label);if(lookupData.label!=replacedLabel){$("#lookupContainter_"+qid).find("label#lqLabel_"+qid).text(replacedLabel);}$.map(lookupData.fieldLabelMap,function(val,index){var fieldId=index;var replacedLabel=pipingModule.replacePipingTextForHtml(val);if(val!=replacedLabel){$("#lookupContainter_"+fieldId).find("label#lqLabel_"+qid).text(replacedLabel);}});};function replaceAnswers(queData){if(!queData.answersSorted){return;}for(var k=0;k<queData.answersSorted.length;k++){var answerId=queData.answersSorted[k];var answer=queData.answers[answerId];if(!answer.hasPiping){continue;}var replaced=pipingModule.replacePipingTextForHtml(answer.name);if(answer.name!=replaced){replaceAnswerText(queData,answer,replaced);}}}function replaceColumns(queData){if(!queData.columnsSorted){return;}for(var j=0;j<queData.columnsSorted.length;j++){var column=queData.columns[queData.columnsSorted[j]];if(!column.hasPiping){continue;}var replaced=pipingModule.replacePipingTextForHtml(column.name);if(column.name!=replaced){$("#ColumnLabel"+queData.questionId+"_"+j).html(replaced);}if(!column.options){continue;}for(var i=0;i<column.options.length;i++){var option=column.options[i];if(!option.hasPiping){continue;}var replacedOptionText=pipingModule.replacePipingTextForHtml(option.text);if(option.text!=replacedOptionText){for(var a=0;a<queData.answersSorted.length;a++){var ansId=queData.answersSorted[a];$("#AnswerOption"+queId+"_"+ansId+"_"+j+""+i).html(replacedOptionText);}}}}}pipingModule.replacePipingOnPage=function(){if(!votingWaitModule.isEmptyAll()){setTimeout(function(){pipingModule.replacePipingOnPage();},10);return;}replaceHeader();replaceFooter();replaceSurveyName();replaceTitle();var questionsOnPage=survData.questionsByVP[votingSubmitModule.getPageNumber()];if(!questionsOnPage){return;}for(var q=0;q<questionsOnPage.length;q++){var queId=questionsOnPage[q];var queData=survData.questionsMap[queId];replaceQuestion(queData);replaceAnswers(queData);replaceColumns(queData);}};var replaceAnswerText=function(queData,ansData,newText){if(queData.type=="DROPDOWN"||queData.type=="LISTBOX"){$("#AnswerOption"+queData.questionId+"_"+ansData.answerId).html(newText);}if(queData.type=="COMPARE"){$("label[id=AnswerLabel"+queData.questionId+"_"+ansData.answerId+"]").html(newText);}var answerLabelElement=$("#AnswerLabel"+queData.questionId+"_"+ansData.answerId);if(validateBeforePiping(queData,ansData,newText,answerLabelElement)){answerLabelElement.html(newText);}};var verifyBeforePiping=[];function validateBeforePiping(queData,ansData,newText,answerLabelElement){for(var i=0;i<verifyBeforePiping.length;i++){var res=runValidateBeforePiping(verifyBeforePiping[i],[queData,ansData,newText,answerLabelElement]);if(!res){return false;}}return true;}function runValidateBeforePiping(name,args){if(!window[name]||!window[name].hasOwnProperty("validate")){return true;}var fn=window[name].validate;if(typeof fn!=="function"){return true;}return fn.apply(window,args);}pipingModule.pushVerifyBeforePiping=function(objectName){verifyBeforePiping.push(objectName);};eventsModuleProvider.getModule().addEventHandlerToAllItems(function(){pipingModule.replacePipingOnPage();});commonVotingModule.allDataRestored.done(function(){pipingModule.replacePipingOnPage();});return pipingModule;};_root.pipingModuleProvider=(function(window,$,survData,eventsModuleProvider,calculationModule,votingSubmitModule,commonVotingModule,votingResultsModule,votingWaitModule){var pipingModuleInstance=null;return{resetModule:function(){pipingModuleInstance=null;},getModule:function(cfg){if(arguments.length){if(!pipingModuleInstance){pipingModuleInstance=pipingModule(cfg,window,$,survData,eventsModuleProvider,calculationModule,votingSubmitModule,commonVotingModule,votingResultsModule,votingWaitModule);}else{throw new Error("Piping module already initialized");}}if(!pipingModuleInstance){throw new Error("Piping module not initialized");}return pipingModuleInstance;}};})(window,$,window.survData,window.eventsModuleProvider,window.calculationModule,window.votingSubmitModule,window.commonVotingModule,window.votingResultsModule,window.votingWaitModule);if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=_root.pipingModuleProvider;window.pipingModuleProvider=_root.pipingModuleProvider;}}).call(this,jQuery);var valBlurModule=(function(window,$,calculationModule,eventsModuleProvider){var singleLineBlurNoReenter=false;var module={};var getValueType=function(questionId,answerId,colIdOrIdx){return calculationModule.getValueType(questionId,answerId,colIdOrIdx);};var isRemoveAlert=function(){return window.removeAlert;};var isDevice=function(){return window.isDevice;};var isEmpty=function(str){return typeof str=="string"&&!str.trim()||typeof str=="undefined"||str===null;};var relevantAlert=function(isBlur,elem,message){var removeAlert=isRemoveAlert();if(!(isBlur&&removeAlert||window.screenLeft>10000)){var vp_cBox=document.getElementById("commentBox");if(vp_cBox!=null&&vp_cBox.className=="vp_commentbox"){vp_cBox.className="vp_commentboxc";}alert(message);}if(isDevice()){var $elem1=jQuery(elem);if($elem1.length>0&&$elem1.is(":visible")&&!$elem1.prop("readOnly")){$elem1.focus();}}};var buildScriptForNum=function(isBlur,elem,elem_value,valueType,checkErrorFlag,bundleKey){return(function(element_value,elem){if(element_value!=null&&element_value.length>0){elem.value=element_value=removeLeadingZeroes(element_value);var subStrWithError=subStringIntegerWithErrorCode(element_value,valueType.preffix,valueType.suffix,valueType.decimalPlaces,valueType.decimal_divider,valueType.thousend_divider);var testRE=subStrWithError.val;var error=false;error|=!new RegExp(valueType.unescapedPattern).test(testRE);if(checkErrorFlag){error|=subStrWithError.err_flg;}if(!isEmpty(valueType.valMin)){error|=parseFloat(testRE)<parseFloat(valueType.valMin);}if(!isEmpty(valueType.valMax)){error|=parseFloat(testRE)>parseFloat(valueType.valMax);}if(error&&(!window.lastFocusedDateInput||window.lastFocusedDateInput==null)){relevantAlert(isBlur,elem,valueType.errorMessage);if(elem!=null&&elem.style.display!="none"&&!elem.readOnly){elem.value=0;elem.focus();}return true;}else{elem.value=testRE;}}return false;})(elem_value,elem);};module.valBlur=function(questionId,answerId,indexId,isBlur,elem,callOnBlur){var removeAlert=isRemoveAlert();var valueType=getValueType(questionId,answerId,indexId);if(isBlur){if(singleLineBlurNoReenter){return true;}singleLineBlurNoReenter=true;}var valueError=false;var valueBefore;if(elem){valueBefore=jQuery(elem).val();var elem_value=jQuery(elem).val();if(elem_value){elem.value=elem_value=jQuery.trim(elem_value);if(valueType!=null){if(valueType.valType=="PERCENT"||valueType.valType=="AMOUNT"){if(elem_value!=null&&elem_value.length>0){elem.value=fixFormat(intvalueWithAlert(elem,false,elem,valueType.preffix,valueType.suffix,valueType.decimalPlaces,valueType.decimal_divider,valueType.thousend_divider),valueType.preffix,valueType.suffix,valueType.decimalPlaces,valueType.decimal_divider,valueType.thousend_divider);}}else{if(valueType.valType=="STRING"||valueType.valType=="EMAIL"){valueError=(function(elem_value){if(elem_value!=null&&elem_value.length>0){var error=false;if(!isEmpty(valueType.unescapedPattern)){error|=!new RegExp(valueType.unescapedPattern).test(jQuery.trim(elem_value));}if(!isEmpty(valueType.valMin)){error|=elem_value.length<parseInt(valueType.valMin);}if(!isEmpty(valueType.valMax)){error|=elem_value.length>parseInt(valueType.valMax);}if(error&&(!window.lastFocusedDateInput||window.lastFocusedDateInput==null)){relevantAlert(isBlur,elem,valueType.errorMessage);if(elem!=null&&elem.style.display!="none"&&!elem.readOnly){elem.focus();}return true;}}return false;})(elem_value);}else{if(valueType.valType=="NUMBER"){valueError=buildScriptForNum(isBlur,elem,elem_value,valueType,true,"DEFAULT_DECIMAL");}else{if(valueType.valType=="NUMBER_NATURAL"){valueError=buildScriptForNum(isBlur,elem,elem_value,valueType,false,"DEFAULT_NUMBER_NATURAL");}else{if(valueType.valType=="DATE"){valueError=(function(elem_value){var $elem=jQuery(elem);if(elem_value!=null&&elem_value.length>0){var error=false;if(!isEmpty(valueType.unescapedPattern)){error|=!new RegExp(valueType.unescapedPattern).test(jQuery.trim(elem_value));}if(error){var blurFire=(callOnBlur?callOnBlur:false);if(($elem.hasClass("hasDatepicker")&&!blurFire)||!$elem.hasClass("hasDatepicker")){relevantAlert(isBlur,elem,valueType.errorMessage);if($elem.length>0&&$elem.is(":visible")&&!$elem.prop("readOnly")){$elem.focus();}}return true;}}return false;})(elem_value);}}}}}}}}if(isBlur){if(removeAlert){singleLineBlurNoReenter=false;}else{window.setTimeout(function(){singleLineBlurNoReenter=false;},0);}}if(isBlur&&!valueError&&elem&&elem.value!=valueBefore){eventsModuleProvider.getModule().triggerByElement(elem);}if(!isBlur){return !valueError;}return !valueError;};return module;})(window,jQuery,window.calculationModule,window.eventsModuleProvider);if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=valBlurModule;window.valBlurModule=valBlurModule;}