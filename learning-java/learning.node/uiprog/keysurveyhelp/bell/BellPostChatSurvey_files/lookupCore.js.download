function LQ_Event(c,a,f,h,g,e,d,b){this.elementId=c;this.view=a;this.value=f;this.qid=h;this.row=g;this.selected=e;this.ignoreListeners=d;this.type=LQ_Utils.isFinalSelect(c)?1:2;this.clearAnyway=b;this.toString=function(){return"[elementId="+c+", view= "+a+", value = "+f+", qid = "+h+", row="+g+", selected="+e+", type="+this.type+"]";};}if(window.LQ_Core){throw"There is another instance of LQ_Core! Check JS includes.";}var LQ_Core=(function(b0,b7,M,p,cf,E,W,V,bo,z){if(typeof bo==="undefined"){throw"There is no ksConfig.";}var aj=function(){return bo.isOffline;};var al=function(){return window.survData.surveyId;};var av=function(){return window.survData.lookupEnv;};var q=function(ci){return window.survData.questionsMap[ci].lookup;};var h=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;var bv;var ah=null;var bQ=null;var bS=false;var ba=[null,null];var A={};var bz={};var a5={};var ax={};var bL={};var aF={};var ch={};var a={};var d={};var aV={};var a8={};var ae={};var bl={};var a9={};var H={};var b4={};var bk={};var bU={};var cb=[];var aJ=function(){if(ah==null){ah=b0("#main_frame");}if(b0("div[data-role='page']").length>0&&b0("body").hasClass("mobile")){ah=b0("div[data-role='page']:visible, .placeWrap:visible");}return ah;};var am=function(ci){return b0("#"+ci+"_scroll");};var bx=function(cj,ci){if(aj()){return aE(cj,ci)?b0("#"+ci):am(ci);}return aJ();};var ai=function(ck,cj){if(bQ!=null&&d[cj]==null){return;}M.log("[ SUN ] Progress bar initialization: visibleSelect="+ba[1]+", loadingSelect="+bQ);bQ=cj;if(aj()){if(!a5[cj]||a5[cj]>5000){bx(ck,cj).loadingOn(0);}}else{var ci=700;setTimeout(function(){M.log("[ SUN ] After "+ci+" ms. progress bar is checking for active loading... loadingSelect="+bQ);if(bQ!=null){bx().loadingOn(0);M.log("[ SUN ] Progress bar is ACTIVATED");}},ci);}};var aP=function(cj,ci){bQ=null;bx(cj,ci).loadingOff();M.log("[ SUN ] Progress bar is CLOSED");};var aY=function(ci,ck){var cl=KS_Utils.currentTime();var cj=b0("#"+ci+"_table");M.log("Seting HTML content to "+ci+" ... ");cj.empty();cj.append(ck);M.log("HTML model rendered in "+(KS_Utils.currentTime()-cl)+" ms.");return false;};var y=function(ci,cj){var ck=cj.indexOf(av().valueDelimiter);if(ck<0){a5[ci]=0;cj=null;}else{a5[ci]=cj.substring(0,ck);cj=cj.substring(ck+av().valueDelimiter.length);}M.log("Global count is recieved for "+ci+" = "+a5[ci]);return cj;};var J=function(ck,ci,cj){return bY(ck,ci).createOptionsHtml(ck,ci,cj);};var bi=function(ci){var cj=b0("#lookupPage_"+ci);cj.attr("size",br(ci));cj.val(b(ci));};var ar=function(cj){var ck=b(cj);var ci=A[cj];var cl=Math.ceil(a5[cj]/ci);if(ck==1){M.log("NAVIGATION: Disable PREV and FIRST buttons for "+cj);b0("#btnFirst_"+cj).attr("disabled",true);b0("#btnPrev_"+cj).attr("disabled",true);}else{b0("#btnFirst_"+cj).attr("disabled",false);b0("#btnPrev_"+cj).attr("disabled",false);}if(ck==cl){M.log("NAVIGATION: Disable NEXT and LAST buttons for "+cj);b0("#btnNext_"+cj).attr("disabled",true);b0("#btnLast_"+cj).attr("disabled",true);}else{b0("#btnNext_"+cj).attr("disabled",false);b0("#btnLast_"+cj).attr("disabled",false);}if(cl==1){b0("#lookupPage_"+cj).attr("disabled",true);}else{b0("#lookupPage_"+cj).attr("disabled",false);}};var at=function(ck){var cj={};var cl=r(ck);for(var ci=0;ci<cl.length;ci++){cd(cj,cl[ci].computerIds,cl[ci].humanValue);}return cj;};var cd=function(cl,cj,ck){var cm=new window.votingResultsModule.ResultCriteria();cm.includePickOneComment=false;var ci=window.vpGetTextResults(ck,cm);if(ci==null||ci.length==0){M.log("There are no results for "+cj+" ["+ck+"]");return false;}if(cl["respondentResults["+cj+"]"]==null){M.log("Found result for "+cj+" ["+ck+"] = "+ci);cl["respondentResults["+cj+"]"]=ci;}};var bb=function(ci,ck){var cj={};b0.each(b0(".lookupFieldFilter_"+ck),function(cn,cl){var cm=b0(cl).attr("id");var co=H[cm];M.log("Process field filter: elementId="+cm+", value="+co);if(cm==ci){return;}if(co==null||aQ(ck,cm)==co){return;}M.log("Found filter: "+co);if(b0.trim(co).length==0){co="EMPTY_FILTER";}cj[b0(cl).attr("name")]=co;});return cj;};var ay=function(cj,ci){M.log("[ FILTER CHANGED ] predefinedFilterChanged for "+cj);if(ba[0]&&ba[0]==cj){bV(cj,null);}v(cj,null);bR(cj);return false;};var aO=function(cj,ci){ay(cj,ci);bh(cj,true,ci,false);};var bm=function(ci,cj){V.getModule().addEventHandlerToManyTokens(cj,function(ck){aO(ci);});M.log("Add filter listener for lookupId="+ci+", tokens="+cj);};var aq=function(ci,cj){bw(ci,function(){M.log("Fire lookup listener. QID="+cj+" depends on QID="+ci);aO(cj,ci);});M.log("Add filter listener for lookup qid="+ci);};var Z=function(ci){setTimeout(function(){b0("#lookupPage_"+ci).select();},10);};var bs=function(cj){var ci=A[cj];var ck=a5[cj]%ci;M.log("lastPageSize="+ck);if(ck==0){ck=ci;}return a5[cj]-ck;};var b=function(ci){return bz[ci]/A[ci]+1;};var br=function(ci){return(""+(a5[ci]/A[ci])).length;};var b9=function(cj,ci){bz[ci]=0;A[ci]=be(cj,ci);a5[ci]=null;};var bG=function(cj,ci){s(ci,0);if(bY(cj,ci).isCursorSupported(ci)){bT(LQ_Core,ci);}};var by=function(cp,cm,cq,ck){M.log("Change page: "+cm+" / "+cq);var cu=b0("#lookupPage_"+cm).val();var co=b(cm);var cr=A[cm];var cs=bz[cm];var ct=bY(cp,cm);switch(cq){case 1:if(bz[cm]==0){M.log("Page is not changed. No actions are required.");b0("#lookupPage_"+cm).val(co);if(ct.isCursorSupported(cm)){bt(cm);}return;}bz[cm]=0;b0("#lookupPage_"+cm).focus();break;case 2:if(cs==0){if(ct.isCursorSupported(cm)){bt(cm);}return;}var cj=cs-cr;bz[cm]=cj>=0?cj:0;b0("#lookupPage_"+cm).focus();break;case 3:var cn=bs(cm);var cl=cs+cr;M.log("lastPageIndex="+cn+", nextPageStart="+cl+", indexStart[elementId]="+bz[cm]);if(cl>cn){cl=cn;}if(bz[cm]>=cl){if(ct.isCursorSupported(cm)){bt(cm);}return;}bz[cm]=cl;b0("#lookupPage_"+cm).focus();break;case 4:var ci=bs(cm);if(bz[cm]>=ci){M.log("Page is not changed. No actions are required.");b0("#lookupPage_"+cm).val(co);if(ct.isCursorSupported(cm)){bt(cm);}return;}bz[cm]=ci;b0("#lookupPage_"+cm).focus();break;case 5:if(ck.keyCode==13){M.log("Manual page: "+cu+", Current page: "+co);if(cu==co){M.log("Page is not changed. No actions are required.");if(ct.isCursorSupported(cm)){bt(cm);}return;}cs=cu*cr-cr;if(!cs){cs=0;}if(cs<0){return by(cp,cm,1,null);}else{if(cs>a5[cm]-cr){return by(cp,cm,4,null);}else{M.log("Calculated index: "+cs);bz[cm]=cs;}}}else{return;}break;}if(ct.isCursorSupported(cm)){U(cm);}bG(cp,cm);if(ct.isCursorSupported(cm)){bt(cm);}aF[cm](true);};var aC=function(ck,ci,cj){bY(ck,M.getFinalSelectId(ck)).populateResult(ck,ci,cj);};var P=function(ck,cj,ci){j(b0("#LookupControl_"+ck),ck,cj,ci);};var j=function(ci,cl,ck,cj){ci.find("#lookupFinalSelect_"+cl+"_input").val(cj);if(!l(cl)){ci.find("#lookupFinalSelect_"+cl+"_reset").show();}bl[cl]=true;LQ_Core.setDropdownValue("lookupFinalSelect_"+cl,ck);M.log("Final result: value = "+ck+", view = "+cj);};var bP=function(cm,ck,cj,cl,ci){if(ci&&ci.length>0){b0("#lookupField_"+cl+"_input").val(ci);M.log("Field result ["+cl+"] = "+ci);}};var N=function(cm,cj,ci,cl,ck){return I(cm,cj,true,ci,ci,ck);};var a2=function(cm,cl,ci,ck,cj){return I(cm,cl,false,ci,ck,cj);};var I=function(co,cm,cl,cj,cn,ck){var ci=M.getFinalSelectId(co);var cp=function(cr,cq){bY(co,ci).selectValue(ci,co,cq);};if(cl){if(aj()){return cf.loadFinalResultsById(LQ_Core,co,cm,cp,cj,cn,ck);}else{return p.loadFinalResultsById(LQ_Core,co,cm,false,cp,cj,cn,ck);}}else{if(aj()){return cf.loadFinalResultsByKey(LQ_Core,co,cm,cp,cj,cn,ck);}else{return p.loadFinalResultsByKey(LQ_Core,co,cm,false,cp,cj,cn,ck);}}};var bF=function(cl,ci,ck){var cj=b0("#"+ci);M.log("triggerSelect: "+ci+" / Current state: "+cj.css("display"));if(cj.css("display")=="block"){bV(cl,cj,ck);if(ck&&bY(cl,ci).isCursorSupported(ci)){bt(ci);}}else{a7(cl,ci,cj,true,null);b0("#"+ci+"_input").select();}return false;};var bj=function(){return(aj()||b7.isExpand||KS_Utils.isSmallScreen())&&!KS_Utils.isWin7();};var a7=function(cn,ci,ck,cm,co,cl){if(k(cn,ci)){return;}var cj=ba[1];M.log("showSelect() is called. loadingSelect="+bQ+", visibleElement="+cj);if(bQ!=null&&bQ!=ci){M.log("Another select is active and loading data: "+bQ);if(bY(cn,ci).isCursorSupported(ci)){bt(bQ);}return;}if(cj!=null&&cj!=ci){bV(cn,null);}ba[0]=cn;ba[1]=ci;if(ck==null){ck=b0("#"+ci);}if(bo.isEform){M.zIndexUp(ck);}if(ck.css("display")!="block"){ck.css("display","block");if(bj()){aX(LQ_Core,ck,ci,(cl),function(){bD(cn,ci,cm,co);});}else{bD(cn,ci,cm,co);}bI(ci,true);}else{M.log("Select is already visible.");if(co!=null){co();}}};var bD=function(ck,ci,cj,cl){if(cj){aF[ci](false,cl);}if(!b3(ci)){am(ci).scrollTop(0);}if(!h){setTimeout(function(){am(ci).scroll(function(){if(bY(ck,ci).isCursorSupported(ci)){bt(ci);}});},200);}if(cl!=null&&!cj){cl();}};var bV=function(cl,cj,ck){var ci=ba[1];if(ci==null&&cj==null){return;}if(cj==null){cj=b0("#"+ci);}if(k(cl,cj.attr("id"))){return;}M.log("Hide select: "+cj);cj.css("display","none");if(bj()){bc(cj,ci);}aP(cl,ci);if(bo.isEform){M.zIndexDown(cj);}if(d[ci]!=null){M.log("Search is present: "+d[ci]);Y(cl,ci);bn(cl,ci,true);}b0(".lastSelectedLookup").removeClass("lastSelectedLookup");b0("#"+ci+"_input").addClass("lastSelectedLookup");ba[0]=null;ba[1]=null;if(ck!=true){bI(ci,false);}};var ap=function(ci){b0("#"+ci).attr("disabled",true);b0("#"+ci+"_input").attr("disabled",true);b0("#"+ci+"_cursor").attr("disabled",true);b0("#"+ci+"_reset").attr("disabled",true);};var aK=function(cj,ci){bV(cj,null);ce(cj,ci,false);C(ci);};var e=function(ci,ck,cj){M.log(ci);if(ci.relatedTarget&&!b0(ci.relatedTarget).hasClass("dropdownBtn")){var cl=b0(ci.target).closest("#lookupContainter_"+ck);if(cl.find(b0(ci.relatedTarget)).length==0){bV(ck,null);}}};var aL=function(cl,ci){M.log("Clear all for question: "+cl);var ck=b4[cl];if(ck){for(var cj=0;cj<ck.length;cj++){if(ck[cj]&&ck[cj]!=M.getFinalSelectId(cl)&&ci&&ci===cl){M.log("Clear element: "+ck[cj]);bV(cl,null);ce(cl,ck[cj],true);}}}};var ag=function(ck,ci){var cj=ba[1];if(cj!=null&&cj!=ci){bV(ck,null);}M.log("loadingSelect: "+bQ);if(bQ!=null){return;}M.log("Search started for: "+ci+". Filter["+ci+"]: "+d[ci]);b9(ck,ci);bG(ck,ci);aF[ci](true,function(){a7(ck,ci,null,false,null);});};var bn=function(ck,ci,cj){M.log("Reset search for: "+ci);a[ci]=null;d[ci]=null;a5[ci]=null;bz[ci]=0;if(cj){bK(ck,ci);}};var aU=function(ck,ci,cj){Y(ck,ci);bn(ck,ci,cj);aV[ci]=null;aF[ci](true,null);};var Y=function(cl,cj){var cm=b0("#"+cj+"_input");var ck=a[cj];M.log('Restore value "'+ck+'" for '+cj);var ci=aQ(cl,cj);if(ck==null||ck.length==0){ck=ci;}cm.val(ck);a8[cj]=true;if(ck==ci){C(cj);}};var aG=function(ci,ck){if(a8[ci]){if(!ck){ck=b0("#"+ci+"_input");}var cj=ck.val();a[ci]=cj;M.log('Backup value "'+cj+'" and reseting field...');}};var t=function(cj,ci){var ck=b0("#"+ci+"_input");a8[ci]=true;ck.focus(function(){M.log("Input text gain focus. Search value: >"+b0.trim(ck.val())+"<");if(aj()&&b0.trim(ck.val())==0){M.log("Double Focus Detected! No action required.");return;}aG(ci,ck);M.log("searchFilter[elementId]="+d[ci]);if(d[ci]==null||d[ci].length==0){ck.val("");}a7(cj,ci,null,true,null,true);return false;});ck.focusout(function(){M.log("Input text lost focus.");if(b0.trim(ck.val()).length==0){Y(cj,ci);}});ck.keyup(function(cl){var cm=ck.val();M.log("User printing text in search field [elementId="+ci+"]... Current text: "+cm);d[ci]=(aQ(cj,ci)==cm)?null:cm;if(cl.keyCode==13){if(bY(cj,ci).isCursorSupported(ci)){if(!aV[ci]&&b3(ci)>0){bt(ci);D(cj,ci,1);}else{ag(cj,ci);}}else{if(k(cj,ci)){ag(cj,ci);}}aV[ci]=null;return false;}else{if(cl.keyCode==27){M.log("Escape: cancel all actions and restore value.");if(k(cj,ci)){aU(cj,ci,false);}else{aV[ci]=null;bV(cj,null);if(bY(cj,ci).isCursorSupported(ci)){bt(ci);}}ck.blur();}else{if(cl.keyCode==40||cl.keyCode==38){aV[ci]=null;return false;}else{if(cl.keyCode==9||cl.keyCode==16||cl.keyCode==17||cl.keyCode==18){return false;}else{a8[ci]=false;aV[ci]=new Date().getTime();setTimeout(function(){M.log("Is user active? ... [keyCode: "+cl.keyCode+"]");if(aV[ci]!=null&&new Date().getTime()-aV[ci]>=900){aV[ci]=null;M.log("No! Start search...");if(d[ci]&&b0.trim(d[ci]).length>0){bN(ci);}else{C(ci);}ag(cj,ci);}else{M.log("Yes. No action is required.");}return false;},1100);}}}}});M.log("Search listener is added for: "+ci);};var bN=function(ci){M.log("showResetButton: "+ci);b0("#"+ci+"_reset").show();};var C=function(ci){M.log("hideResetButton: "+ci);b0("#"+ci+"_reset").hide();};var v=function(cm,cl){var ck=b4[cm];if(ck){for(var cj=0;cj<ck.length;cj++){var ci=ck[cj];if(ci==cl){continue;}if(aN(ci)){bK(cm,ci);}}}if(cl!=null){K(cl,true);}M.log("All selectors [qid="+cm+"] are marked as not-loaded.");return false;};var bK=function(cj,ci){K(ci,false);b9(cj,ci);bG(cj,ci);};var bR=function(ck){var ci=aA(ck);for(var cj=0;cj<ci.length;cj++){a6(ck,ci[cj]);}};var cg=function(cj,ci){return bY(cj,M.getFinalSelectId(cj)).resetFinalSelect(cj,ci);};var aS=function(cj,ci){bY(cj,M.getFinalSelectId(cj)).resetFilters(cj,ci);};var a6=function(cj,ci){bf(cj,"lookupField_"+ci);return false;};var bf=function(cj,ci){M.log("Reset select for: "+ci);b0("#"+ci+"_input").val(aQ(cj,ci));a8[ci]=true;if(bY(cj,ci).isCursorSupported(ci)){U(ci);}bG(cj,ci);bn(cj,ci,false);H[ci]=null;C(ci);return false;};var bO=function(cj){if(b7.isSelectorTag){bl[cj]=true;return;}var ci=bM(cj);if(!ci){M.log("We lost our selected element -> reset results.");aC(cj,null,null);}bl[cj]=true;M.log("isFinalDataLoaded["+cj+"] -> true");};var G=function(cj,ci){bK(cj,ci);bf(cj,ci);};var bh=function(cl,ck,cj,ci){aS(cl,cj);f(cl);return cg(cl,new LQ_Event(M.getFinalSelectId(cl),null,null,cl,0,ck,undefined,ci==false?false:true));};var D=function(ck,ci,cj){bd(E.getSelectionDropdownEvent(ck,ci,cj));};var bJ=function(cn,cj,cm,ci){var cl=b0("#"+cj+"_"+cm);var ck=cl.prop("checked");cl.prop("checked",!ck);bA(cn,cj,cm,ci);};var bA=function(cm,cj,cl,ci){var cn="#"+cj+"_"+cl;var ck=b0(cn).prop("checked");if(ck){b0(cn+"_container").parent().addClass("lookupCheckboxSelected");}else{b0(cn+"_container").parent().removeClass("lookupCheckboxSelected");}aB(new LQ_Event(cj,ci,cl,cm,0,ck));};var ce=function(cl,ci,cj){M.log("doUnselect: "+cl+", "+ci+", "+cj);var ck=new LQ_Event(ci,null,null,cl,0,false,cj);bd(ck);bK(cl,ci);};var bd=function(ck){var cj=ck.elementId;var cl=ck.row;var ci=ck.view;if(bY(ck.qid,cj).isCursorSupported(cj)){bp(LQ_Core,cj,cl);}s(cj,cl);aV[cj]=null;b0("#"+cj+"_input").val(ci==null?aQ(ck.qid,cj):ci);ch[cj](ck,function(){a[cj]=null;a8[cj]=true;M.log("searchFilter["+cj+"]="+d[cj]);if(d[cj]!=null){M.log("Reset search results: "+cj);bn(ck.qid,cj,true);}bV(ck.qid,null);bW(ck.qid,cj,cl);if(bY(ck.qid,cj).isCursorSupported(cj)){bt(cj);}});};var aB=function(cj){var ci=cj.elementId;ch[ci](cj);};var bW=function(ck,ci,cj){if(cj==0||l(ck)){C(ci);}else{bN(ci);}};var a0=function(cu,cp,cr,cl){if(aN(cp)){M.log("Selector is actual for "+cp);return;}b0("#"+cp+"_table").empty();ai(cu,cp);var ci=isNaN(bz[cp])?0:bz[cp];var cy=ci+(isNaN(A[cp])?400:A[cp]);var cx=a5[cp];var cm={};cm.LoadOptions="1";cm.fieldId=cr;cm.listId=cc(cu);cm.questionId=cu;cm.surveyId=al();cm.fieldSelectedValue=b0("#"+cp).val();cm.indexStart=ci;cm.indexEnd=cy;cm.complexName=cr==-1?"true":"false";cm.needGlobalCount=(cx==null)?"true":"false";var cv=c(cu);if(b0.isArray(cv)){for(var co=0;co<cv.length;co++){var cq=cv[co];if(!b0.isArray(cq)){throw"Filter by views supports only array of arrays. Example: [[1,2],[3]]";}for(var cn=0;cn<cq.length;cn++){cm["viewIds["+co+"]["+cn+"]"]=cq[cn];}}}else{cm.viewId=cv;}var ct=at(cu);var cs=bb(cp,cu);if(d[cp]!=null){cm.searchFieldId=cr;cm.searchFilter=d[cp];}if(aj()){cf.loadDataOffline(LQ_Core,cm,ct,cs,cu,cp,cl);}else{var cw=bk[cp];var ck=(cw)?cw.serverUrl:null;cm.loginUserId=(cw)?cw.loginUserId:null;var cj=b0.extend(cm,ct,cs);p.loadDataOnline(LQ_Core,cj,cu,cp,cl,ck);}return false;};var ao=function(ci,cj){a0(ci,M.getFinalSelectId(ci),-1,cj==null?bO:cj);if(cj!=null){bl[ci]=true;}return false;};var aM=function(cn,cj,ci,cm,cl){var co=KS_Utils.currentTime();if(cl){a5[cj]=cm.globalCount;}var ck=bY(cn,cj).createOptionsHtmlFromArray(cn,cj,cm.items);a3(cn,cj,ci,ck,co);};var au=function(co,cj,ci,cm,cn){var cp=KS_Utils.currentTime();var cl="true"===cn.needGlobalCount;if(cl){cm=y(cj,cm);}var ck=J(co,cj,cm);a3(co,cj,ci,ck,cp);};var a3=function(cm,ck,cj,cl,cn){bi(ck);ar(ck);aY(ck,cl);M.log("Rendered in "+(KS_Utils.currentTime()-cn)+" ms.");K(ck,true);var ci=bY(cm,ck).isCursorSupported(ck);if(ci){U(ck);bG(cm,ck);O(ck);}if(b0.isFunction(cj)){cj(cm);}aP(cm,ck);};var bB=function(ck,cj){var ci=M.getFinalSelectId(ck);if(l(ck)){LQ_Core.disableSelect(ci);}else{LQ_Core.setLoadAction(ci,F(ck,ci));LQ_Core.setSelectAction(ci,bY(ck,ci).getFinalSelectListener(ck,cj,ci));LQ_Core.resetPager(ck,ci);LQ_Core.resetSelectedRow(ck,ci);if(bY(ck,ci).isCursorSupported(ci)){a1(LQ_Core,ck,ci);}LQ_Core.addSearchListener(ck,ci);M.log("Final listener is added for "+ci);}return false;};var F=function(cj,ci){return function(ck,cl){if(ck){K(ci,false);}else{if(aN(ci)){M.log("Data is not changed: return for "+ci);return;}}ao(cj,cl);return false;};};var aa=function(ck,ci){for(var cj=0;cj<cb.length;cj++){cb[cj](ck,ci);}};var b6=function(ci){cb.push(ci);};var aD=function(cl,ck,cj){var ci="lookupField_"+ck;if(l(cl)){ap(ci);}else{aF[ci]=function(cm,cn){if(cm){K(ci,false);}else{if(aN(ci)){M.log("Data is not changed: return for "+ci);return;}}a0(cl,ci,cj,cn);return false;};ch[ci]=function(cm,cp){var cn=cm.value;var co=cm.row;M.log("change [field "+cj+"]");M.log("Onchange: currently selected: "+H[ci]+", selected: "+cn);if(H[ci]==cn){M.log("Onchange: value is not changed. The end. "+ci);if(cp){cp();}return false;}H[ci]=(co==0)?null:cn;M.log("Onchange: value is changed for element "+ci);v(cl,ci);if(bl[cl]){M.log("Data List is already loaded, refresh it...");bY(cl,M.getFinalSelectId(cl)).resetFinalSelect(cl,cm);}else{M.log("Data List is not loaded. No update is required.");}bE(cm);if(cp){cp();}return false;};b9(cl,ci);bG(cl,ci);if(bY(cl,ci).isCursorSupported(ci)){a1(LQ_Core,cl,ci);}t(cl,ci);M.log("Field listener is added for "+ci);}return false;};var an={};var ak={};var bp=function(cl,ci,ck){var cj=cl.getSelectedRow(ci);b0("#"+ci+"_"+cj).removeClass("selectedItem");b0("#"+ci+"_"+ck).addClass("selectedItem");M.log("ACTIVATE: "+ci+"_"+ck);M.log("Remove/Add selection for "+ci+" rows "+cj+"/"+ck);an[ci]=am(ci).scrollTop();ak[ci]=an[ci]-aT(ci);M.log("Revalidated offset: scrollOffsetDown: "+an[ci]+", scrollOffsetUp: "+ak[ci]+", selectedRow="+cj);};var bT=function(ck,ci){var cj=ck.getSelectedRow(ci);b0("#"+ci+"_"+cj).removeClass("selectedItem");};var aT=function(ci){return b7.scrollSize-bH(ci);};var S=function(ci){var cj=Math.floor(b7.scrollSize/bH(ci));M.log("getScrollRowsCount="+cj);return cj;};var bH=function(ci){return b0("#"+ci+"_0").eq(0).height();};var U=function(ci){M.log("resetCursor: "+ci);ak[ci]=null;an[ci]=null;};var i=function(ci){var cl=b0("#"+ci+"_0").eq(0);var cj=cl.outerHeight()-cl.height();var ck=Math.ceil(cj/2);M.log("Padding = "+ck);return ck;};var ac=function(cn,cm,ck,ci,cl,cj){if(ci){cn.showSelect(cm,ck,null,true,function(){return az(cn,ck,ci,cl,cj);});return;}az(cn,ck,ci,cl,cj);};var bt=function(ci){b0("#"+ci+"_cursor").focus();M.log("Focus moved to cursor.");};var a1=function(cl,cj,ci){var ck=b0("#"+ci+"_input");ck.keydown(function(cm){if(cm.keyCode==40||cm.keyCode==38){bt(ci);ac(cl,cj,ci,cm.keyCode==40,1,false);return false;}});b0("#"+ci+"_cursor").keydown(function(cm){if(cm.keyCode==40||cm.keyCode==38){ac(cl,cj,ci,cm.keyCode==40,1,false);return false;}else{if(cm.keyCode==37){cl.changePage(cj,ci,2,null);return false;}else{if(cm.keyCode==39){cl.changePage(cj,ci,3,null);return false;}else{if(cm.keyCode==33){ac(cl,cj,ci,false,S(ci),false);return false;}else{if(cm.keyCode==34){ac(cl,cj,ci,true,S(ci),false);return false;}else{if(cm.keyCode==13){cl.doSelect(cj,ci,cl.getSelectedRow(ci));return false;}else{if(cm.keyCode==27){M.log("Escape: close select");cl.hideSelect(cj,null);return false;}else{if(cm.keyCode==8){return false;}}}}}}}}});};var az=function(cn,co,cp,cj,ck){M.log("---------------------------------------------------------------------------------------");M.log("Cursor pressed for: "+co);var cv=cn.getSelectedRow(co);var cs=cn.getPageSizes();var cr=am(co);if(cv!=null&&cv>=0){var cu=b0("#"+co+"_"+cv);M.log("Current row: "+cv+", pageSize: "+cs[co]+", currentRowExists?: "+(cu.length>0));cu.removeClass("selectedItem");var cl=ab(cu.position().top,co);if(!cl){M.log("Current row is not visible, move scroll to it...");cr.scrollTop(an[co]==null?0:an[co]);if(ck){M.log("RECURSE GUARD: Break execution!");return false;}else{return az(cn,co,cp,cj,true);}}if(cp){cv=cv+cj;if(cv>=cs[co]){cv=cs[co];}if(b0("#"+co+"_"+cv).length==0){M.log("There is no target row: "+cv);cv=b0("#"+co+"_table li").length-1;}}else{cv=cv-cj;}}else{cv=0;}if(cv<0){cv=0;}M.log("Target row: "+cv);b0("#"+co+"_"+cv).addClass("selectedItem");if(b0("#"+co+"_"+cv).position()){var cm=Math.floor(b0("#"+co+"_"+cv).position().top);var ct=an[co];var ci=ak[co];M.log(" >> offset: "+cm+", scrollOffsetDown: "+ct+", scrollOffsetUp: "+ci+", selectedRow="+cv);var cq=ab(cm,co);M.log("isVisible="+cq+", scrollsize="+aT(co));if(cp&&!cq){if(ct!=null&&ct>=0){cm=cm+ct;ak[co]=ct;}else{ak[co]=0;}an[co]=cm;M.log("scrolling down to "+cm+" ...");cr.scrollTop(cm);}else{if(!cp&&!cq){if(ci!=null){cm=cr.scrollTop()+cm;ak[co]=ci-aT(co);if(ak[co]<0){ak[co]=0;}an[co]=cm;M.log("scrolling up to "+cm+" ...");cr.scrollTop(cm);}}}cn.setSelectedRow(co,cv);M.log(" << offset: "+cm+", scrollOffsetDown: "+an[co]+", scrollOffsetUp: "+ak[co]+", selectedRow="+cv+", current="+cr.scrollTop());}};var O=function(ci){M.log("Select first row ...");az(LQ_Core,ci,true,1,false);};var ab=function(cj,ci){M.log("isRowVisible: offset="+cj+", scrollSize="+aT(ci));return cj>=0&&(cj+i(ci))<=aT(ci);};var aH=function(ci){return aE(ci,M.getFinalSelectId(ci));};var k=function(cj,ci){return ci!=null&&aE(cj,ci)&&M.isFinalSelect(ci);};var aQ=function(ck,ci){if(k(ck,ci)){return b7.txtSearch;}else{var cj=bk[ci];return b0.trim((cj)?cj.txtNotSelected:b7.txtNotSelected);}};var bY=function(cj,ci){if(k(cj,ci)){return W;}else{return E;}};var aX=function(co,ck,cj,cl,cn){var cm=b0("#"+cj+"_input");var ci=b0("meta[name='viewport']");bv=b0(window).scrollTop();M.log("Expand select to fullscreen. isFromFocus="+cl);aJ().css("visibility","hidden");if(aJ().is("#main_frame")){if(/iphone|ipod|ipad/i.test(navigator.userAgent.toLowerCase())){b0("body").addClass("ios iosSurvey");}aJ().css("height",b0(window).height()).css("width",b0(window).width()).css("overflow","hidden");}window.scrollTo(0,0);ck.parent().appendTo("body");ck.parent().addClass("isCurrentlySelected");cm.select();if(cn){setTimeout(cn,10);}};var bc=function(ck,cj){aJ().css("visibility","visible");var ci=b0("meta[name='viewport']");if(aJ().is("#main_frame")){aJ().removeAttr("style");}var cl="#LookupControl_"+M.getElementIdNum(cj);ck.parent().removeClass("isCurrentlySelected");ck.parent().appendTo(cl);if(bv){b0(window).scrollTop(bv);bv=null;}};var bq=function(cs,ci,ck,cn){var co=w(cs);var cl="";var cp=false;for(var cm=0;cm<co.length;cm++){var cr=co[cm].value;if(co[cm].isField){var ct=m(cs)[cr];var cj=cn?KS_ValueType.convertValue(b2(cs,cr),ck[ct]):KS_Utils.encodeForJS(ck[ct]);if(KS_Utils.isValueExistsAndNotEmpty(cj)){if(!cp){cp=true;}cl+=b0.trim(cj);}}else{cl+=cr;}}if(!cp){var cq=m(cs)[LQ_Core.getKeyFieldId(cs)];cl+="("+ck[cq]+")";}return cl;};var aI=function(ci){return(LQ_Core.getAnswerObjectViewId(ci))?true:false;};var n=function(ci){return b0("#QuestionAnswersTableId"+ci).length>0;};var o=function(ck,ci){var cj=b4[ck];if(!cj){cj=[];b4[ck]=cj;}cj.push(ci);};var s=function(cj,ck){M.log("Set selected row ["+cj+"] = "+ck);var ci=ae[cj];if(ci){if(ci==ck){return;}else{if(ci>0){b0("#"+cj+"_"+ci).removeClass("selectedItem");}}}if(ck>0){b0("#"+cj+"_"+ck).addClass("selectedItem");}ae[cj]=ck;return false;};var bM=function(ci){return bY(ci,M.getFinalSelectId(ci)).isSomethingSelected(ci);};var af=function(cj,ci){return bY(cj,M.getFinalSelectId(cj)).getResultAsText(cj,ci);};var g=function(ci,cj){bC(ci,bL,cj);};var bI=function(ci,cj){M.log("Fire lookup visibility listeners for "+ci+", isVisible: "+cj);a4(ci,bL,cj);};var bw=function(ci,cj){bC(ci,ax,cj);};var b5=function(ci){a4(ci,ax,null);};var bE=function(ci){M.log("Fire global lookup change event: "+ci.toString());b0("#"+ci.elementId).trigger("change",{view:ci.view,value:ci.value,row:ci.row,id:ci.elementId,qid:ci.qid,type:ci.type,ignoreListeners:ci.ignoreListeners});};var bC=function(cl,cj,ck){var ci=cj[cl];if(ci==null){ci=[];cj[cl]=ci;}ci.push(ck);};var a4=function(cm,ck,cl){var cj=ck[cm];if(cj!=null){for(var ci=0;ci<cj.length;ci++){cj[ci](cl);}}};var be=function(cj,ci){return q(cj).perPageCounts[ci];};var Q=function(cj,ci){return q(cj).layoutColumns[ci];};var aE=function(cj,ci){return q(cj).elementTypes[ci]==2;};var b2=function(ck,ci){var cj=q(ck).valueTypes[ci];if(cj){return new ValueType(cj.valType,cj.decimals,cj.decimalDivider,cj.thousendDivider,cj.format,cj.preffix,cj.suffix);}else{return null;}};var w=function(ci){return q(ci).nameParts;};var m=function(ci){return q(ci).fieldAnswerMapping;};var aA=function(ci){return q(ci).rowIds;};var X=function(ci){return q(ci).answerIds;};var aR=function(ci){return q(ci).keyFieldId;};var x=function(ci){return q(ci).keyFieldName;};var cc=function(ci){return q(ci).listId;};var c=function(ci){return q(ci).viewId;};var R=function(cj){var ci=q(cj);return(ci)?q(cj).answerObjectId:null;};var L=function(cj){var ci=q(cj);return(ci)?ci.answerObjectViewId:null;};var r=function(ci){return q(ci).expressions;};var b3=function(ci){return ae[ci];};var b1=function(){return A;};var aN=function(ci){return a9[ci]?true:false;};var K=function(ci,cj){M.log("setSelectorActual > elementId: "+ci+", value: "+cj);a9[ci]=cj;};var ca=function(ci,cj){aF[ci]=cj;};var ad=function(ci,cj){ch[ci]=cj;};var aw=function(ci,cj){H[ci]=cj;};var T=function(ci){return H[ci];};var bZ=function(cj,ci){a8[cj]=ci;};var bu=function(ci){bS=ci;};var bg=function(){return bS;};var u=function(ci,cj){bk[ci]=cj;};var b8=function(ci){return bk[ci];};var bX=function(ci){bU[ci]=true;};var l=function(ci){return bU[ci];};var f=function(ci){b0(".reset"+ci,".lookupControl").trigger("click");};var aZ=function(cn){var cj=LQ_Core.getExpressions(cn);for(var ci=0;ci<cj.length;ci++){var cm=cj[ci];var cl=vpGetQuestionModel(cm.humanValue);if(cl&&cl.isLookup()){LQ_Core.addPredefinedLookupFilterListener(cl.id,cn);}else{var ck=vpGetElements(cm.humanValue);if((!ck||ck==null)&&cm.humanValue.indexOf(".")>0){ck=vpGetElements(cm.humanValue.split(".")[0]);}if(ck instanceof Array&&!vpIsRbr()){LQ_Core.addPredefinedFilterListeners(cn,cm.tokens);}}}};var aW=function(cn){var ci=[];var ck=LQ_Core.getExpressions(cn);for(var cj=0;cj<ck.length;cj++){var cm=ck[cj];var cl=vpGetElements(cm.humanValue);if((!cl||cl==null)&&cm.humanValue.indexOf(".")>0){cl=vpGetElements(cm.humanValue.split(".")[0]);}if(cl instanceof Array){_.each(cm.tokens,function(co){ci.push(co);});}}return ci;};var B=function(ci){z.refreshQuestionDependency(ci);};return{renderLookup:aM,loadingSuccessEvent:au,hideProgressBar:aP,doSelect:D,doSelectCheckbox:bA,hideSelect:bV,showSelect:a7,changePage:by,populateResult:aC,showFinalSelectedResult:P,showFinalSelectedResultByContainer:j,addFieldSelectListener:aD,showFieldSelectedResult:bP,triggerSelect:bF,addPredefinedFilterListeners:bm,addPredefinedLookupFilterListener:aq,selectPageText:Z,getPageNumber:b,getPageDigits:br,backupSearch:aG,clearSelect:aK,clearFiltersGUI:aL,fireGlobalChangeEvent:bE,loadDataForFinalSelect:ao,resetPager:b9,resetSelect:bf,resetSelectedRow:bG,resetControl:G,getFinalLoadListener:F,addSearchListener:t,disableSelect:ap,addFinalListeners:bB,fireLookupResultsListeners:b5,addLookupVisibilityListener:g,addLookupResultsListener:bw,resetSearch:bn,resetActualityForElement:bK,clearSearch:aU,getInstance:bY,checkCheckbox:bJ,getComplexName:bq,isMultipleQuestion:aH,selectValueById:N,selectValueByKey:a2,isPresentOnVotingPage:aI,isPresentOnVisualPage:n,isOffline:aj,getLookupEnv:av,getLookupDTO:q,resetResults:bh,setBatchOperations:bu,isBatchOperations:bg,isSomethingSelected:bM,getResultAsText:af,getSelectedRow:b3,setSelectedRow:s,getPageSizes:b1,getExpressions:r,setValueIsObject:bZ,setLoadAction:ca,addQuestionElement:o,setSelectAction:ad,setDropdownValue:aw,getDropdownValue:T,getLayoutColumns:Q,getValueType:b2,getNameParts:w,getFieldAnswerMapping:m,getAnswerIds:X,getRowIds:aA,getKeyFieldId:aR,getKeyFieldName:x,getListId:cc,getViewId:c,getAnswerObjectId:R,getAnswerObjectViewId:L,setElementConfig:u,getEmptyText:aQ,setReadonly:bX,isReadonly:l,getRespondentResults:at,getVotingFilters:bb,controlExit:e,initPredefinedFilters:aZ,refreshQuestiondependency:B,onChangeHandler:aa,setChangedListener:b6,getTokensForFilters:aW,predefinedFilterChangedDropBox:ay,resetFields:f};})(jQuery,window.LQ_GuiConfig,window.LQ_Utils,window.LQ_Online,window.LQ_Offline,window.LQ_Single,window.LQ_Multiple,window.eventsModuleProvider,window.ksConfig,window.votingWaitModule);if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=LQ_Core;}