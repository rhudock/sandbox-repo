if(window.LQ_Single){throw"There is another instance of LQ_Single! Check JS includes.";}var LQ_Multiple=null;var LQ_Single=(function(g,n){var t=function(E,D,C){var H=LQ_Core.getLookupEnv().valueDelimiter;var G=LQ_Core.getLookupEnv().valueEquals;LQ_Utils.log("createOptionsHtml:["+E+", "+D+"], valueDelimiter: "+H+", valueEquals: "+G);var z=[];if(C!=null&&C.length>0){var A=C.split(H);for(var B=0;B<A.length;B++){var F=A[B];F=KS_Utils.encodeForJS(F);var y=F.split(G);z.push({id:y[0],value:y[1]});}}return p(E,D,z);};var p=function(D,B,z){var y=LQ_Core.getEmptyText(D,B);var E=LQ_Core.getLookupEnv().valueDelimiter;var A=j(D);var C='<li lang="'+y+E+y+'" class=" dropdownText selectItem" dir="auto"  id="'+B+"_0\"  onclick='LQ_Core.doSelect("+D+', "'+B+'", 0)\' title="'+y+'">'+y+"</li>";z.forEach(function(H,G){var F=A===H.id;if(F){LQ_Core.setSelectedRow(B,G+1);}C+='<li lang="'+H.id+E+H.value+'" class="dropdownText selectItem '+(F?"selectedItem":"")+'" dir="auto" id="'+B+"_"+(G+1)+"\" onclick='LQ_Core.doSelect("+D+', "'+B+'", '+(G+1)+")' title=\""+H.value+'">'+H.value+"</li>";});return C;};var l=function(z,y){LQ_Core.addFinalListeners(z,y);return false;};var c=function(A,z,y){LQ_Core.showFinalSelectedResult(A,z,y);return false;};var r=function(D){var C=LQ_Core.getAnswerObjectId(D);var A=LQ_Core.getAnswerObjectViewId(D);LQ_Utils.log("LQ showResultsOffline! qid="+D+", answerObjectId="+C+", answerObjectViewId="+A);var z=g(o(D,C));if(z.length<=0){LQ_Utils.log("LQ OFFLINE/NO ObjectID Input for: qid="+D+", answerId="+C);return false;}var B=z.val();if(B!=null&&B.length>0){LQ_Utils.log("Restore lookup result ["+D+"] in offline mode...");var y=g(o(D,A)).val();LQ_Utils.log("Found offline result: value="+B+", view="+y);LQ_Core.showFinalSelectedResult(D,B,y);}else{LQ_Utils.log("LQ OFFLINE/NO Result for: qid="+D+", answerId="+C);}return false;};var f=function(y){return !LQ_Core.isOffline()||(window.appRoot!=undefined&&_.isFunction(window.appRoot.getPlatform)&&window.appRoot.getPlatform()=="win7");};var a=function(E,B,A){var z=LQ_Utils.getFinalSelectId(E);if(B&&B.selected){if(B.clearAnyway==false){var D=LQ_Core.getAnswerObjectId(E);var y=i(E,D);if(y.length>0&&y.val().length>0){LQ_Core.selectValueById(E,y.val(),true,false);return false;}}LQ_Core.resetSelect(E,z);LQ_Core.populateResult(E,null,null);var C=LQ_Utils.getHiddenElements(E);if(C.length>0){C.val("");}}return false;};var m=function(z,y){LQ_Core.clearFiltersGUI(z,y);};var u=function(A,z,y){return function(C,E){var B=C.value;var D=C.row;LQ_Utils.log("change [final select] qid="+A+", row="+D+", dataObjectId="+B);if(LQ_Core.getDropdownValue(y)==B){LQ_Utils.log("Onchange: value is not changed. The end. "+y);if(E){E();}return false;}LQ_Core.setDropdownValue(y,(D==0)?null:B);if(n.isSelectorTag){LQ_Core.fireGlobalChangeEvent(C);if(E){E();}return false;}if(D==0||!B||B==0){LQ_Core.populateResult(A,null,null);LQ_Core.fireGlobalChangeEvent(C);if(E){E();}return false;}if(LQ_Core.isOffline()){return LQ_Offline.loadFinalResultsById(LQ_Core,A,B,E);}else{return LQ_Online.loadFinalResultsById(LQ_Core,A,B,z,E);}return false;};};var h=function(A,z){var y=g("input[type=hidden]#inputtextother"+A+"_"+z);if(y.length>0){return y;}return g("#hidden_inputtextother"+A+"_"+z);};var v=function(D,C,B){var A=LQ_Core.isPresentOnVisualPage(D);var y=A?o().substring(1):b(D,C).substring(1);var z="other"+D+"_"+C;g(document.theForm).append(g("<input/>",{type:"hidden",name:z,value:B,id:y}));};var d=function(E,y,z){var D=LQ_Core.getAnswerIds(E);var H=LQ_Core.isPresentOnVisualPage(E);for(var B=0;B<D.length;B++){var F=D[B];var G=(z==null)?"":z[F];var C=H?g(o(E,F)):h(E,F);if(C.length>0){C.val(G);}else{v(E,F,G);}}var A=LQ_Utils.getFinalSelectId(E);var I=s(E,y);LQ_Core.setSelectedRow(A,I);LQ_Core.onChangeHandler(E,z);LQ_Utils.log("Results are "+(z==null?"reset":"set")+" for QID: "+E+", ObjectID: "+y);LQ_Core.fireLookupResultsListeners(E);};var e=function(A){var z=LQ_Core.getAnswerObjectId(A);var y=i(A,z);return y.length>0&&y.val().length>0;};var q=function(B,A){if(!e(B)){return null;}var z=(A)?A:LQ_Core.getAnswerObjectViewId(B);var y=i(B,z);return y.val();};var j=function(B){var A=LQ_Core.getAnswerObjectId(B),y=q(B,A),z=parseInt(y);return isNaN(z)?null:z;};var i=function(A,z){var y=g(o(A,z));if(y.length==0){y=h(A,z);}return y;};var k=function(D,A,C){var y=w(A,C);if(y==null){LQ_Utils.log("There is no selected option for: "+A);return new LQ_Event(A,null,null,D,C,false);}var B=y[0];var z=y[1];LQ_Utils.log("doSelect: "+D+", "+A+", value="+B+", view="+z);return new LQ_Event(A,z,B,D,C,true,undefined);};var w=function(z,B){if(B==null){return null;}var A=g("#"+z+"_"+B);var y=A.attr("lang");if(y){y=KS_Utils.decodeFromJS(y);return y.split(LQ_Core.getLookupEnv().valueDelimiter);}else{return null;}};var x=function(z,B,A){if(A){var y=i(B,LQ_Core.getAnswerObjectViewId(B)).val();LQ_Core.showFinalSelectedResult(B,A,y);}};var o=function(z,y){return"#inputtextother"+z+"_"+y;};var b=function(z,y){return"#hidden_inputtextother"+z+"_"+y;};var s=function(B,z){var y=LQ_Utils.getFinalSelectId(B),C=g("#"+y).find("[lang^="+z+"]").attr("id");C=C?C.replace(y+"_",""):"0";var A=parseInt(C);return isNaN(A)?0:A;};return{createOptionsHtml:t,createOptionsHtmlFromArray:p,initFinalSelect:l,showResultsOnline:c,showResultsOffline:r,isCursorSupported:f,resetFinalSelect:a,getFinalSelectListener:u,populateResult:d,isSomethingSelected:e,getSelectionDropdownEvent:k,selectValue:x,resetFilters:m,getResultAsText:q};})(jQuery,LQ_GuiConfig);