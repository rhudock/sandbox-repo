if(window.LQ_Multiple){throw"There is another instance of LQ_Multiple! Check JS includes.";}var LQ_Multiple=(function(o,F){var K={};var n={};var i={};var v={};var g=function(S,R,Q){var O=LQ_Core.getLayoutColumns(S,R);LQ_Utils.log("createCheckHtml: "+S+", "+R+", "+O);var M=[];if(Q!=null&&Q.length>0){var N=Q.split(LQ_Core.getLookupEnv().valueDelimiter);for(var P=0;P<N.length;P++){var T=N[P];T=KS_Utils.encodeForJS(T);var L=T.split(LQ_Core.getLookupEnv().valueEquals);M.push({id:L[0],value:L[1]});}}return s(S,R,M);};var s=function(Q,O,L){var N=LQ_Core.getLayoutColumns(Q,O);LQ_Utils.log("createCheckHtml: "+Q+", "+O+", "+N);var P="<table cellpadding='0' cellspacing='10' border='0'>";var S=LQ_Utils.getFinalSelectId(Q);var R=parseInt(o("#"+S+"_input").attr("tabIndex"))+1;var T=0;var M=0;L.forEach(function(V){if(M==0){P+="<tr>";}var W=KS_Utils.encodeForJS(V.id);var U=KS_Utils.encodeForJS(V.value);var X=KS_Utils.escapeForJQuery(U);var Y=K[Q]&&K[Q][W];P+="<td "+(Y?'class="lookupCheckboxSelected"':"")+'><span class="lookupCheckbox" id="'+O+"_"+W+'_container"><input type="checkbox" id="'+O+"_"+W+'" tabIndex="'+R+"\" onclick='LQ_Core.doSelectCheckbox("+Q+', "'+O+'", "'+W+'", "'+X+'")\' title="'+X+'" '+(Y?"checked":"")+" /><label dir='auto' onclick='LQ_Core.checkCheckbox("+Q+', "'+O+'", "'+W+'", "'+X+"\")'>"+U+"</label></span></td>";M++;R++;if(M==N){P+="</tr>";T++;M=0;}});P+="</table>";return P;};var I=function(N,M){var L="lookupFinalSelect_"+N;if(!LQ_Core.isReadonly(N)){n[N]=function(O){LQ_Core.resetActualityForElement(N,L);u(N);};}LQ_Core.addFinalListeners(N,M);if(!LQ_Core.isReadonly(N)){u(N);}return false;};var u=function(L){LQ_Core.loadDataForFinalSelect(L,null);LQ_Core.resetPager(L,"lookupFinalSelect_"+L);};var l=function(Q){var P='<table class="selectedObjectView">';var R=K[Q];var S=false;if(R){var O=0;for(var L in R){O++;}var M=10000-1-O;for(var L in R){if(!R.hasOwnProperty(L)){continue;}var N=R[L];if(N){S=true;P+='<tr id="selectedObjectView_'+L+'" class="H3"><td dir="auto">';P+=LQ_Core.getComplexName(Q,L,N,false);P+="</td>";P+='<td class="selectedObjectView_remove_td"><span><a href="javascript:void(0);" tabIndex="'+M+'" onclick="LQ_Multiple.resetResult(\''+Q+"', '"+L+"');\">[x]</a></span>";P+="</td></tr>";}}}if(!S){P+='<tr><th class="H3 txtNoObjects">'+F.txtNoObjects+"</th></tr>";}P+="</table>";var T={headerText:"",messageText:P,afterShow:function(){window.ks.ui.messageDialog("refresh");},buttons:[{id:"okButton",text:"OK",handler:function(){window.ks.ui.messageDialog("close");o("#showSelectedLink_"+Q).focus();}}]};window.ks.ui.messageDialog(T);return false;};var d=function(L){return !LQ_Utils.isFinalSelect(L);};var E=function(M,L){if(L.ignoreListeners){LQ_Utils.log("Ignore reseters for QID="+M);return;}LQ_Utils.log("Reseter exists? -> "+(n[M]!=null));if(n[M]){n[M](L);}return false;};var A=function(M,L){LQ_Core.clearFiltersGUI(M,L);};var t=function(N,M,L){return function(P,R){LQ_Utils.log("change [final select] qid="+N);var O=P.value;var Q=P.selected;if(F.isSelectorTag){LQ_Core.fireGlobalChangeEvent(P);if(R){R();}return false;}if(Q){if(LQ_Core.isOffline()){LQ_Offline.loadFinalResultsById(LQ_Core,N,O,R);}else{LQ_Online.loadFinalResultsById(LQ_Core,N,O,M,R);}}else{y(N,O);if(R){R();}}return false;};};var x=function(O){if(!O){return 0;}var N=0;var M=K[O];if(M!=null){for(var L in M){if(L!=null&&L!="null"&&M.hasOwnProperty(L)&&M[L]){N++;}}}return N;};var r=function(M){var L=o("#mlqSelectedCount_"+M);L.empty();L.html(x(M));};var C=function(O,M,N){if(M==null){z(O);}else{if(N==null){y(O,M);}else{var L=q(O);L[M]=N;r(O);LQ_Core.onChangeHandler(O,q(O));B();LQ_Core.fireLookupResultsListeners(O);LQ_Utils.log("Multiple result is set for QID: "+O+", ObjectID: "+M);}}};var b=function(L,M){var P="#"+L+"_"+M;var N=o(P);if(N.length>0&&N.prop("checked")){N.prop("checked",false);o(P+"_container").parent().removeClass("lookupCheckboxSelected");}var O=o("#selectedObjectView_"+M);if(O.length>0){O.remove();}};var a=function(M){var L=o("input[name^=other"+M+"_]");if(L.length>0){L.remove();}L=o("input[name^=R"+M+"]");if(L.length>0){L.remove();}};var y=function(N,M){delete q(N)[M];var L=LQ_Utils.getFinalSelectId(N);a(N);b(L,M);r(N);LQ_Utils.log("Multiple result is reset for QID: "+N+", ObjectID: "+M);LQ_Core.onChangeHandler(N,q(N));LQ_Core.fireGlobalChangeEvent(new LQ_Event(L,null,null,N,0,false));return false;};var z=function(N){var L=LQ_Utils.getFinalSelectId(N);var M=LQ_Utils.getHiddenElements(N);if(M.length>0){M.val("");}a(N);_.each(K[N],function(P,O){b(L,O);});if(K[N]){LQ_Core.resetFields(N);}delete K[N];r(N);LQ_Utils.log("Multiple results are reset for QID: "+N);return false;};var q=function(M){var L=K[M];if(!L){L={};D(M,L);}return L;};var k=function(N){var M=LQ_Core.getAnswerObjectId(N);var L;if(LQ_Core.isPresentOnVisualPage(N)){if(K[N]){return x(N)>0;}L=o(h(N,M,0));}else{L=o("input[name="+J(N,M,0)+"]");}return L.length>0&&L.val().length>0;};var f=function(R,N){if(!k(R)){return null;}var U="";var T=(N)?N:LQ_Core.getAnswerObjectViewId(R);if(LQ_Core.isPresentOnVisualPage(R)&&K[R]){var P=K[R];for(var L in P){if(!P.hasOwnProperty(L)){continue;}if(L=="null"||L==null){continue;}var O=P[L];if(O){U+=(O[T]?O[T]:"")+", ";}}}else{var Q=0;while(true){var M=o("input[name="+J(R,T,Q)+"]");if(M.length>0){var S=M.val();if(S&&S.length>0){U+=S+", ";}Q++;}else{break;}}}if(U.length>0){U=U.substring(0,U.length-2);}return U;};var G=function(R,P){var U={};if(!k(R)){return U;}if(LQ_Core.isPresentOnVisualPage(R)&&K[R]){U=K[R];}else{var Q=0;while(true){var L=[];var M=0;for(var O=0;O<P.length;O++){var T=P[O];var N=o('input[name="'+J(R,T,Q)+'"]');if(N.length>0){var S=N.val();if(S&&S.length>0){L[T]=S;}}else{M++;}}if(M==P.length){return U;}U[Q]=L;Q++;}}return U;};var e=function(){for(var Q in K){if(!K.hasOwnProperty(Q)){continue;}var P=K[Q];if(P!=null){var N=x(Q);if(N>0){var O=i[Q];var L=v[Q];if(O&&N<O&&O>=0||L&&N>L&&L>=0){var M=window.survData.questionsMap[Q].name;alertMinMaxReq(Q,KS_Utils.removeTags(M),O<0?0:O,L<0?0:L);return false;}}}}return true;};var H=function(L){LQ_Utils.log("showResultsOnline("+L+", "+K[L]+")");r(L);return false;};var m=function(V){try{var Q=LQ_Core.getAnswerObjectId(V);var N=LQ_Core.getAnswerObjectViewId(V);LQ_Utils.log("MLQ showResultsOffline! qid="+V+", answerObjectId="+Q+", answerObjectViewId="+N);var M=null;D(V,{});var S=LQ_Core.getAnswerIds(V);var R=0;while(true){var T=o(h(V,Q,R));if(T.length<=0){LQ_Utils.log("MLQ OFFLINE/NO ObjectID Input for: qid="+V+", answerId="+Q+", objectIndex="+R);break;}if(T.val().length<=0){LQ_Utils.log("MLQ OFFLINE/NO Result for: qid="+V+", answerId="+Q+", objectIndex="+R);break;}var O={};for(var P=0;P<S.length;P++){var X=S[P];var L=o(h(V,X,R));var W=(L.length<=0)?"":L.val();O[X]=W;LQ_Utils.log("MLQ OFFLINE/Restore result: qid="+V+", answerId="+X+", objectIndex="+R+" --> "+W);if(Q==X){M=W;}}if(M!=null){K[V][M]=O;LQ_Utils.log("MLQ offline result is restored for qid="+V+", dataObjectId="+M);}R++;}r(V);return false;}catch(U){LQ_Utils.log("[ERROR] showResultsOffline -> cant restore MLQ results: "+U);throw U;}};var c=function(M){var L=0;_.each(o("[id^=hidden_inputtextother"+M+"]"),function(O){var Q=o(O).attr("id");var P=Q.lastIndexOf("_");if(P>-1){P++;var N=parseInt(Q.substring(P),10);if(N>-1&&N==L){L=N+1;}}});return L;};var B=function(){try{for(var S in K){if(!K.hasOwnProperty(S)){continue;}var Q=0;LQ_Utils.log("MLQ add result: > QID: "+S);if(!LQ_Core.isPresentOnVisualPage(S)){Q=c(S);}else{o("[id^=inputtextother"+S+"]").remove();}var N=K[S];if(N!=null){for(var L in N){if(!N.hasOwnProperty(L)){continue;}LQ_Utils.log("MLQ add result: > dataObjectId: "+L);if(L!=null&&L!="null"&&N[L]){var M=N[L];if(M){for(var T in M){if(!M.hasOwnProperty(T)){continue;}var U=M[T];if(T==LQ_Core.getAnswerObjectViewId(S)){U=LQ_Core.getComplexName(S,L,M,false);}U=KS_Utils.encodeForJS(U);var V=h(S,T,Q).substring(1);var P=o("#"+V);if(P.length>0){P.val(U);}else{var O=J(S,T,Q);var W='<input type="hidden" name="'+O+'" id="'+V+'" value="'+U+'"/>';o(document.theForm).append(W);}LQ_Utils.log("MLQ add result: qid="+S+", answerId="+T+", objectIndex="+Q+" --> "+U);}}}Q++;}}if(Q==0){o("[id^=inputtextother"+S+"]").remove();}LQ_Utils.log("MLQ add result: completed for QID: "+S);}return true;}catch(R){LQ_Utils.log("[ERROR] appendResultsToForm -> cant add MLQ results: "+R);throw R;}};var p=function(N,M,L){i[N]=M;v[N]=L;};var w=function(L,P,N){var M=q(P);var O=M[N];if(O){o("#"+L+"_"+N).prop("checked",true);}else{LQ_Utils.log("[ ERROR ] Cant find object data for dataObjectId: "+N);}};var D=function(M,L){K[M]=L;};var h=function(N,L,M){return"#inputtextother"+N+"_"+L+"_"+M;};var j=function(N,L,M){return"#hidden_inputtextother"+N+"_"+L+"_"+M;};var J=function(N,L,M){return"other"+N+"_"+L+"_"+M;};return{createOptionsHtml:g,createOptionsHtmlFromArray:s,initFinalSelect:I,showResultsOnline:H,showResultsOffline:m,isCursorSupported:d,resetFinalSelect:E,getFinalSelectListener:t,populateResult:C,isSomethingSelected:k,resetResults:z,resetResult:y,showResultsDialog:l,validateMustCheck:e,appendResultsToForm:B,setMustCheckCount:p,getSelectedCount:x,selectValue:w,resetFilters:A,getResultAsText:f,getResult:G,setSelectedObjects:D};})(jQuery,LQ_GuiConfig);